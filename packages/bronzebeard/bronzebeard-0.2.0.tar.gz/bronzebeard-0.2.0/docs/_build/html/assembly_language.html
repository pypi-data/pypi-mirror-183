<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Assembly Language &mdash; bronzebeard 0.1.17 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Instruction Reference" href="instruction_reference.html" />
    <link rel="prev" title="Bronzebeard" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> bronzebeard
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Bronzebeard Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Assembly Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#instructions">Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#registers">Registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constants">Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#labels">Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="#include">Include</a></li>
<li class="toctree-l2"><a class="reference internal" href="#include-bytes">Include Bytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#string-literals">String Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#numeric-sequence-literals">Numeric Sequence Literals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#integer-sequences">Integer Sequences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#packed-values">Packed Values</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#shorthand-syntax">Shorthand Syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alignment">Alignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifiers">Modifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#error">Error</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="instruction_reference.html">Instruction Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="dfu_setup.html">DFU Setup</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bronzebeard</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Assembly Language</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/assembly_language.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="assembly-language">
<h1>Assembly Language<a class="headerlink" href="#assembly-language" title="Permalink to this heading">¶</a></h1>
<p>RISC-V assembly programs are written as plain text files.
The file extension is mostly arbitrary but <code class="code docutils literal notranslate"><span class="pre">.asm</span></code> and <code class="code docutils literal notranslate"><span class="pre">.S</span></code> are quite common.
An assembly program is a linear sequence of “items”.
Items can be many things: labels, instructions, literal bytes and strings, etc.</p>
<p>The Bronzebeard assembly syntax also supports basic comments.
Single-line comments can be intermixed with the source code by using the <code class="code docutils literal notranslate"><span class="pre">#</span></code> character.
Multi-line comments are not supported at this point in time.
However, you can always emulate multi-line comments by using multiple single-line comments to construct larger blocks.</p>
<section id="instructions">
<h2>Instructions<a class="headerlink" href="#instructions" title="Permalink to this heading">¶</a></h2>
<p>Instructions instruct the CPU to do something with a given set of registers and/or immediate values.
Registers are named 32-bit “slots” that the CPU can use to store information at runtime.
Immediate values are typically integers of varying sizes (depending on the specific instruction at hand).</p>
<p>An instruction is written as a name followed by its arguments.
The arguments can be separated by a comma for readability but this isn’t a requirement (commas are treated as whitespace).
Here is an example of using the <code class="code docutils literal notranslate"><span class="pre">addi</span></code> instruction to the value <code class="code docutils literal notranslate"><span class="pre">12</span></code> into register <code class="code docutils literal notranslate"><span class="pre">x1</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># x1 = 0 + 12</span>
<span class="n">addi</span> <span class="n">x1</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="mi">12</span>
</pre></div>
</div>
</section>
<section id="registers">
<h2>Registers<a class="headerlink" href="#registers" title="Permalink to this heading">¶</a></h2>
<p>The RISC-V ISA specifies 32 general purpose registers.
Each register is cable of a holding a single 32-bit value (or 64 bits on a 64-bit system).
Register 0 is the only special case: it always holds the value zero no matter what gets written to it.
There also exists the “program counter” which is a register that holds the location of the current program’s execution.
This <code class="code docutils literal notranslate"><span class="pre">pc</span></code> register can’t be accessed directly but is utilized by certain instructions.</p>
<p>A given register can be referenced in multiple ways: by number, by name, or by its alias.
The alias and suggested usage of each register can be ignored when writing simple assembly programs.
They are given more meaning when dealing with more complex <a class="reference external" href="https://en.wikipedia.org/wiki/Application_binary_interface">ABIs</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Calling_convention">calling conventions</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 17%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Number</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Alias</p></th>
<th class="head"><p>Suggested Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x0</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">zero</span></code></p></td>
<td><p>Hard-wired zero</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x1</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">ra</span></code></p></td>
<td><p>Return address</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x2</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">sp</span></code></p></td>
<td><p>Stack pointer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x3</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">gp</span></code></p></td>
<td><p>Global pointer</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">4</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x4</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">tp</span></code></p></td>
<td><p>Thread pointer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">5-7</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x5-7</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">t0-2</span></code></p></td>
<td><p>Temporary registers</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">8</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x8</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">s0/fp</span></code></p></td>
<td><p>Saved register / frame pointer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">9</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x9</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">s1</span></code></p></td>
<td><p>Saved register</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">10-11</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x10-11</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">a0-1</span></code></p></td>
<td><p>Function arguments / return values</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">12-17</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x12-17</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">a2-7</span></code></p></td>
<td><p>Function arguments</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">18-27</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x18-27</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">s2-11</span></code></p></td>
<td><p>Saved registers</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">28-31</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">x28-31</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">t3-6</span></code></p></td>
<td><p>Temporary registers</p></td>
</tr>
</tbody>
</table>
</section>
<section id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Permalink to this heading">¶</a></h2>
<p>A constant in Bronzebeard is the named result of an integer expression.
Floating point numbers or any other non-integer expression results aren’t supported at this time.
Numbers can be represented as decimal, binary, or hex.
Character literals can also be used if surrounded by single-quotes.
Simple math operations such as addition, multiplication, shifting, and binary ops all work as one would expect.
The actual precedence rules and evaluation of arithmetic expressions is handled by the Python lauguage itself (via the <a class="reference external" href="https://docs.python.org/3/library/functions.html#eval">eval</a> builtin).</p>
<p>Here are a few examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RCU_BASE_ADDR</span> <span class="o">=</span> <span class="mh">0x40021000</span>
<span class="n">RCU_APB2EN_OFFSET</span> <span class="o">=</span> <span class="mh">0x18</span>

<span class="n">GPIO_BASE_ADDR_C</span> <span class="o">=</span> <span class="mh">0x40011000</span>
<span class="n">GPIO_CTL1_OFFSET</span> <span class="o">=</span> <span class="mh">0x04</span>
<span class="n">GPIO_MODE_OUT_50MHZ</span> <span class="o">=</span> <span class="mb">0b11</span>
<span class="n">GPIO_CTL_OUT_PUSH_PULL</span> <span class="o">=</span> <span class="mb">0b00</span>

<span class="n">FOO</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">BAR</span> <span class="o">=</span> <span class="n">FOO</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">BAZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">BAR</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mb">0b11111</span>

<span class="n">QMARK</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
<span class="n">SPACE</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
</pre></div>
</div>
</section>
<section id="labels">
<h2>Labels<a class="headerlink" href="#labels" title="Permalink to this heading">¶</a></h2>
<p>Labels are single-token items that end with a colon such as <code class="code docutils literal notranslate"><span class="pre">foo:</span></code> or <code class="code docutils literal notranslate"><span class="pre">bar:</span></code>.
They effectively mark a location in the assembly program with a human-readable name.
Labels have two primary use cases: being targets for jump / branch offsets and marking the position of data.</p>
<p>Here is an example that utilizes a label in order to create an infinite loop:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span><span class="p">:</span>
    <span class="n">j</span> <span class="n">loop</span>
</pre></div>
</div>
<p>Notice how the label ends with a colon when it is defined but not when it is referenced.
This is necessary to distinguish label definitions from other keywords.</p>
</section>
<section id="include">
<h2>Include<a class="headerlink" href="#include" title="Permalink to this heading">¶</a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">include</span></code> keyword can be used to include other assembly source files into the current program.
At the moment, files are searched relative to the file containing the <code class="code docutils literal notranslate"><span class="pre">include</span></code> keyword.
Additional include directories can be specified on the command via the <code class="code docutils literal notranslate"><span class="pre">-i</span></code> (or <code class="code docutils literal notranslate"><span class="pre">--include</span></code>) flag.</p>
<p>Here is a basic example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span> <span class="n">gd32vf103</span><span class="o">.</span><span class="n">asm</span>
</pre></div>
</div>
<p>You can find another example of this in the <a class="reference external" href="https://github.com/theandrew168/bronzebeard/blob/master/examples/longan_nano_led.asm">Longan Nano LED example</a>.</p>
</section>
<section id="include-bytes">
<h2>Include Bytes<a class="headerlink" href="#include-bytes" title="Permalink to this heading">¶</a></h2>
<p>Similar to <code class="code docutils literal notranslate"><span class="pre">include</span></code>, <code class="code docutils literal notranslate"><span class="pre">include_bytes</span></code> can be used to embed binary files into the output binary.
Regardless of the file’s type, it will be simply be baked into the binary as raw bytes.</p>
<p>Here are some example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include_bytes</span> <span class="n">cat</span><span class="o">.</span><span class="n">jpg</span>
<span class="n">include_bytes</span> <span class="n">prelude</span><span class="o">.</span><span class="n">forth</span>
<span class="n">include_bytes</span> <span class="n">my_random_file</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
</section>
<section id="string-literals">
<h2>String Literals<a class="headerlink" href="#string-literals" title="Permalink to this heading">¶</a></h2>
<p>String literals allow you to embed UTF-8 strings into your binary.
They start with the <code class="code docutils literal notranslate"><span class="pre">string</span></code> keyword (then a single space) and are followed by any number of characters (til end of line).
This item is lexed in a special way such that the literal string content remains unchanged.
This means that spaces, newlines, quotes, and comments are all preserved within the literal string value.</p>
<p>The regex used for lexing these items is roughly: <code class="code docutils literal notranslate"><span class="pre">string</span> <span class="pre">(.*)</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># note that any comments after these lines would be included in the string</span>
<span class="n">string</span> <span class="n">hello</span>
<span class="n">string</span> <span class="s2">&quot;world&quot;</span>
<span class="n">string</span> <span class="s2">&quot;hello world&quot;</span>
<span class="n">string</span> <span class="n">hello</span>  <span class="c1">##  world</span>
<span class="n">string</span> <span class="n">hello</span>\<span class="n">nworld</span>
<span class="n">string</span>   <span class="n">hello</span>\\<span class="n">nworld</span>
</pre></div>
</div>
</section>
<section id="numeric-sequence-literals">
<h2>Numeric Sequence Literals<a class="headerlink" href="#numeric-sequence-literals" title="Permalink to this heading">¶</a></h2>
<p>Numeric sequence literals allow you to embed homogeneous sequences of numbers into your binary.</p>
<section id="integer-sequences">
<h3>Integer Sequences<a class="headerlink" href="#integer-sequences" title="Permalink to this heading">¶</a></h3>
<p>Integers can be positive or negative and expressed in decimal, binary, or hex.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Bytes per Number</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">bytes</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">shorts</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">ints</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">longs</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">longlongs</span></code></p></td>
<td><p>8</p></td>
</tr>
</tbody>
</table>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h3>
<p>Here are a few examples of the various numeric sequences:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bytes</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mh">0x03</span> <span class="mb">0b100</span> <span class="mi">5</span> <span class="mh">0x06</span> <span class="mb">0b111</span> <span class="mi">8</span>
<span class="nb">bytes</span> <span class="o">-</span><span class="mi">1</span> <span class="mh">0xff</span>  <span class="c1"># same value once encoded as 2&#39;s comp integers</span>
<span class="n">shorts</span> <span class="mh">0x1234</span> <span class="mh">0x5678</span>
<span class="n">ints</span>  <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
<span class="n">longs</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>  <span class="c1"># same as above (both 4 bytes each)</span>
</pre></div>
</div>
</section>
</section>
<section id="packed-values">
<h2>Packed Values<a class="headerlink" href="#packed-values" title="Permalink to this heading">¶</a></h2>
<p>Packed values allow you embed packed numeric literals, expressions, or references into your binary.
They start with the <code class="code docutils literal notranslate"><span class="pre">pack</span></code> keyword and are followed by a format specifier and a value.
The format specifier is a subset of the format outlined in Python’s builtin <a class="reference external" href="https://docs.python.org/3/library/struct.html#format-characters">struct module</a>.</p>
<p>The pack format is composed of two characters: the first specifies endianness and the second details the numeric size and type:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 56%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Character</p></th>
<th class="head"><p>Meaning</p></th>
<th class="head"><p>Bytes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">&lt;</span></code></p></td>
<td><p>Little endian</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">&gt;</span></code></p></td>
<td><p>Big endian</p></td>
<td><p>N/A</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">b</span></code></p></td>
<td><p>Signed char</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">B</span></code></p></td>
<td><p>Unsigned char</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">h</span></code></p></td>
<td><p>Signed short</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">H</span></code></p></td>
<td><p>Unsigned short</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">i</span></code></p></td>
<td><p>Signed int</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">I</span></code></p></td>
<td><p>Unsigned int</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">l</span></code></p></td>
<td><p>Signed long</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">L</span></code></p></td>
<td><p>Unsigned long</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">q</span></code></p></td>
<td><p>Signed long long</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">Q</span></code></p></td>
<td><p>Unsigned long long</p></td>
<td><p>8</p></td>
</tr>
</tbody>
</table>
<p>Here are a few examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pack</span> <span class="o">&lt;</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">pack</span> <span class="o">&lt;</span><span class="n">B</span><span class="p">,</span> <span class="mi">255</span>
<span class="n">pack</span> <span class="o">&lt;</span><span class="n">h</span><span class="p">,</span> <span class="o">-</span><span class="mi">1234</span>
<span class="n">pack</span> <span class="o">&lt;</span><span class="n">I</span> <span class="n">ADDR</span>
<span class="n">pack</span> <span class="o">&lt;</span><span class="n">I</span> <span class="o">%</span><span class="n">position</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">ADDR</span><span class="p">)</span>
</pre></div>
</div>
<section id="shorthand-syntax">
<h3>Shorthand Syntax<a class="headerlink" href="#shorthand-syntax" title="Permalink to this heading">¶</a></h3>
<p>In addition to the above <code class="code docutils literal notranslate"><span class="pre">pack</span></code> keyword, a small set of shorthand keywords (loosely based on NASM syntax) are available for embedding integers of specific widths.
The specific endianness and signedness will be inferred by the assembler’s configuration and resolved integer value, respectively.
Internally, these are implemented as AST transformations to the more general <code class="code docutils literal notranslate"><span class="pre">pack</span></code> syntax.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 67%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Bytes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">db</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">dh</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">dw</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">dd</span></code></p></td>
<td><p>8</p></td>
</tr>
</tbody>
</table>
<p>Here are some examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1-byte integers</span>
<span class="n">db</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># 2&#39;s complement will end up as 0xff</span>
<span class="n">db</span> <span class="mh">0xff</span>
<span class="n">db</span> <span class="mh">0x20</span>

<span class="c1"># 2-byte integers</span>
<span class="n">dh</span> <span class="mh">0x2000</span>

<span class="c1"># 4-byte integers</span>
<span class="n">dw</span> <span class="mh">0x20000000</span>
<span class="n">dw</span> <span class="n">some_label</span>
<span class="n">dw</span> <span class="n">RAM_ADDR</span>

<span class="c1"># 8-byte integers</span>
<span class="n">dd</span> <span class="mh">0x2000000000000000</span>
</pre></div>
</div>
</section>
</section>
<section id="alignment">
<h2>Alignment<a class="headerlink" href="#alignment" title="Permalink to this heading">¶</a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">align</span></code> keyword tells the assembler to enforce alignment to a certain byte boundary.
This alignment is achieved by padding the binary with <code class="code docutils literal notranslate"><span class="pre">0x00</span></code> bytes until it aligns with the boundary.
In pseudo-code, the assembler adds zeroes until: <code class="code docutils literal notranslate"><span class="pre">len(binary)</span> <span class="pre">%</span> <span class="pre">alignment</span> <span class="pre">==</span> <span class="pre">0</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># align the current location in the binary to 4 bytes</span>
<span class="n">align</span> <span class="mi">4</span>
</pre></div>
</div>
<p>Alignment is important when mixing instructions and data into the same binary (which happens quite often).
According to the RISC-V spec, instructions MUST be aligned to a 32-bit (4 byte) boundary unless the CPU supports the “C” Standard Extension for Compressed Instructions (in which case the alignment requirement is relaxed to a 16-bit (2 byte) boundary).</p>
<p>For example, the following code may be invalid because the instruction is not on a 32-bit boundary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bytes</span> <span class="mh">0x42</span>      <span class="c1"># occupies 1 byte</span>
<span class="n">addi</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># misaligned :(</span>
</pre></div>
</div>
<p>To fix this, we need to tell the assembler to ensure that the binary is aligned to 32 bits (4 bytes) before proceeding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bytes</span> <span class="mh">0x42</span>      <span class="c1"># occupies 1 byte</span>
<span class="n">align</span> <span class="mi">4</span>         <span class="c1"># will pad the binary with 3 0x00 bytes</span>
<span class="n">addi</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span>  <span class="c1"># aligned :)</span>
</pre></div>
</div>
</section>
<section id="modifiers">
<h2>Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this heading">¶</a></h2>
<p>In addition to basic arithmetic operations, Bronzebeard assembly supports a small number of “modifiers”.
Note that the <code class="code docutils literal notranslate"><span class="pre">%offset</span></code> and <code class="code docutils literal notranslate"><span class="pre">%position</span></code> modifiers are NOT permitted within the value of a constant.</p>
<p>You can think of these like simple, builtin functions:</p>
<ul class="simple">
<li><p><strong>%hi(value)</strong> - Calculate the sign-adjusted top 20 bits of a value</p></li>
<li><p><strong>%lo(value)</strong> - Calculate the sign-adjusted bottom 12 bits of a value</p></li>
<li><p><strong>%offset(label)</strong> - Calculate the offset of a label relative to the current item’s address</p></li>
<li><p><strong>%position(label, addr)</strong> - Calculate the position of a label based on a given absolute address</p></li>
</ul>
</section>
<section id="error">
<h2>Error<a class="headerlink" href="#error" title="Permalink to this heading">¶</a></h2>
<p>The keyword <code class="code docutils literal notranslate"><span class="pre">error</span></code> can be used to abort the assembler in a human-understandable fashion.
For example, if a given board doesn’t support visual displays but the program requires it, an <code class="code docutils literal notranslate"><span class="pre">error</span></code> directive can be used to explicity inform the user of the problem as soon as possible.
This is much better user-experience than waiting for the assembler to drop a cryptic “symbol not found” type of error sometime later.</p>
<p>This keyword captures a simple message based on the regex: <code class="code docutils literal notranslate"><span class="pre">error</span> <span class="pre">(.*)</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span> <span class="n">This</span> <span class="n">device</span> <span class="n">doesn</span><span class="s1">&#39;t support displays</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Bronzebeard" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="instruction_reference.html" class="btn btn-neutral float-right" title="Instruction Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Andrew Dailey.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>