0010        NAM  OURPII
0020        DEF  RUNTIM
0030        DEF  ASCIIS
0040        DEF  PARSE 
0050        DEF  ERMSG 
0060        DEF  INIT  
0070 RUNTIM BSZ  2
0080        DEF  MENON.
0090        DEF  MENOF.
0100        DEF  ONLAB.
0110        DEF  HELP. 
0120        DEF  HELP+.
0130        DEF  KEYON.
0140        DEF  KEYOF.
0150        DEF  ALPA. 
0160        DEF  AREAD.
0170        DEF  PUSH. 
0180        DEF  DECUR.
0190        DEF  POPH. 
0200        DEF  REV.  
0210 PARSE  BSZ  2
0220        DEF  MENPAR
0230        DEF  MENPAR
0240        DEF  ONLABP
0250        DEF  HELPPP
0260        DEF  HELPPP
0270        DEF  KONPRS
0280        DEF  KOFPRS
0290        DEF  ALPARS
0300        DEF  AREADP
0310        DEF  PUPARS
0320        DEF  MENPAR
0330        BYT  377,377
0340 !  ************************
0350 ASCIIS ASP  "MENU ON"
0360        ASP  "MENU OFF"
0370        ASP  "ON KEY LABEL"
0380        ASP  "HELP #"
0390        ASP  "HELP+ #"
0400        ASP  "ON KYBD"
0410        ASP  "OFF KYBD"
0420        ASP  "ALPHA"
0430        ASP  "AREAD"
0440        ASP  "PUSH HISTORY"
0450        ASP  "OFF CURSOR"
0460        ASP  "POP HISTORY"
0470        ASP  "REV"
0480        BYT  377
0490 !  ************************
0500 ERMSG  BYT  200
0510        BYT  200,200,200,200
0520        BYT  200,200,200,200
0530        ASP  "TOO MANY NESTED HISTORIES"
0540        ASP  "BAD COL ADDRESS"
0550        BYT  377
0560 !  ************************
0570 INIT   BIN  
0580        LDBD R34,=ROMFL 
0590        CMB  R34,=1
0600        JNZ  LBIN? 
0610 TAKHOK LDMD R14,=BINTAB
0620        LDM  R36,=KEYS  
0630        ADM  R36,R14
0640        STM  R36,R45
0650        LDB  R47,=236
0660        LDB  R44,=316
0670        STMD R44,=CHIDLE
0680        JMP  INIFLG
0690 LBIN?  CMB  R#,=3
0700        JZR  TAKHOK
0710        CMB  R#,=2
0720        JNZ  LOAD? 
0730 FREHOK LDM  R45,=236,236,236
0740        STMD R45,=CHIDLE
0750        RTN  
0760 LOAD?  CMB  R#,=5
0770        JZR  FREHOK
0780        CMB  R#,=4
0790        JZR  INIFLG
0800        CMB  R#,=7
0810        JNZ  INIRTN
0820 INIFLG LDMD R14,=BINTAB
0830        CLM  R42
0840        STBD R42,X14,MENFLG
0850        STMD R42,X14,LABTAB
0860        STBD R42,X14,HISCNT
0870        STMD R41,X14,HLPCNT
0880        LDM  R46,=HISTRY
0890        ADM  R46,R14
0900        STMD R46,X14,HISPTR
0910        JSB  X14,OFF   
0920 INIRTN RTN  
0930 !  ************************
0940 MENPAR LDB  R42,=371
0950        STBI R42,=PTR2- 
0960        STBI R42,=PTR2- 
0970        STBI R43,=PTR2- 
0980        JSB  =SCAN  
0990        RTN  
1000 !  ************************
1010 HELPPP PUBD R43,+R6
1020        JSB  =SCAN  
1030        CMB  R#,=32
1040        JNZ  ERR89 
1050        CLB  R47
1060        TSM  R44
1070        JZR  ERR89 
1080        CMB  R44,=8D
1090        JCY  ERR89 
1100        TSM  R45
1110        JNZ  ERR89 
1120        JSB  =PUSH32
1130        CMB  R14,=54
1140        JNZ  ERR89 
1150        JSB  =STREX+
1160        JEN  OK1   
1170 ERR89  POBD R20,-R6
1180        JSB  =ERROR+
1190        BYT  89D
1200 OK1    LDB  R57,=371
1210        POBD R55,-R6
1220        STMI R55,=PTR2- 
1230        RTN  
1240 !  ************************
1250 ONLABP LDB  R42,=371
1260        STBI R42,=PTR2- 
1270        STBI R42,=PTR2- 
1280        STBI R43,=PTR2- 
1290        JSB  =SCAN  
1300        CMB  R47,=210
1310        JZR  OK2   
1320 ERR88  JSB  =ERROR+
1330        BYT  88D
1340 OK2    JSB  =GOTOSU
1350        CMB  R47,=210
1360        JNZ  ERR88 
1370        JSB  =GOTOSU
1380        RTN  
1390 !  ***********************
1400        BYT  241
1410 DECUR. BIN  
1420        JSB  =DECUR2
1430        RTN  
1440 !  ***********************
1450        BYT  241
1460 MENON. JSB  =ALPHA 
1470        JSB  =DECUR2
1480        LDMD R24,=LLN-2 
1490        ADM  R24,=80D,0
1500        LDMD R34,=CRTRAM
1510        STMD R34,=CRTBYT
1520        JSB  =MOVCRS
1530        LDM  R26,=LEGEN2
1540        LDB  R36,=80D
1550        LDMD R14,=BINTAB
1560        LDBD R77,X14,MENFLG
1570        JNZ  MENUP 
1580        STMD R34,X14,MENADR
1590        LDB  R77,=80D
1600        STBD R77,X14,MENFLG
1610        LDM  R46,=MENSAV
1630 MEN1   JSB  =INCHR 
1640        PUBD R32,+R46
1650        DCB  R77
1660        JNZ  MEN1  
1670 MENUP  LDMD R34,X14,MENADR
1680        JSB  =BYTCR!
1690        LDM  R26,=LEGEN2
1700        LDM  R36,=80D,200
1710 MEN2   POBD R32,+R26
1720        JSB  =CHKSTS
1730        STBD R32,=CRTDAT
1740        DCB  R36
1750        JNZ  MEN2  
1760        JSB  =HMCURS
1770        JSB  =CURS  
1780 MENDON RTN  
1790 !  ***********************
1800        BYT  241
1810 MENOF. JSB  =ALPHA 
1820        LDMD R14,=BINTAB
1830        LDBD R34,X14,MENFLG
1840        JZR  MENDON
1850        JSB  =DECUR2
1860        LDMD R34,X14,MENADR
1870        JSB  =BYTCR!
1880        LDM  R26,=MENSAV
1900        LDM  R36,=80D,0
1910        STBD R37,X14,MENFLG
1920        JMP  MEN2  
1930 !  ***********************
1940        BYT  241
1950 ONLAB. LDMD R14,=BINTAB
1960        LDMD R65,=PTR1  
1970        STMD R65,X14,LABTAB
1980        BIN  
1990        LDMI R74,=PTR1- 
2000        CMB  R77,=262
2010        JNC  SKPLB 
2020        JSB  =SKPNAM
2030 SKPLB  LDMD R65,=PTR1  
2040        STMD R65,X14,LABTA2
2050        LDMI R74,=PTR1- 
2060        CMB  R77,=262
2070        JNC  SKPLB2
2080        JSB  =SKPNAM
2090 SKPLB2 RTN  
2100 !  ***********************
2110        BYT  241
2120 HELP.  BSZ  0
2130        LDMD R14,=BINTAB
2140        JSB  X14,HELSUB
2150        CLB  R36
2160        ICB  R36
2170        STBD R36,X34,HLPCNT
2180 GOTHEL POMD R53,-R12
2190        STMD R53,X46,HELP  
2200        RTN  
2210 ! ************************
2220 HELSUB POMD R43,-R12
2230        POMD R50,-R12
2240        PUMD R43,+R12
2250        PUMD R50,+R12
2260        JSB  =ONEB  
2270        TSM  R46
2280        JNZ  OK-HEP
2290 HEPERR POMD R36,-R6
2300        JSB  =ERROR+
2310        BYT  88D
2320 OK-HEP CMM  R46,=10,0
2330        JCY  HEPERR
2340        DCB  R46
2350        STM  R46,R34
2360        STB  R46,R47
2370        CLB  R46
2380        LRM  R47
2390        ADM  R46,R14
2400        ADM  R34,R14
2410        RTN  
2420 ! ************************
2430        BYT  241
2440 HELP+. LDMD R14,=BINTAB
2450        JSB  X14,HELSUB
2460        LDBD R36,X34,HLPCNT
2470        ICB  R36
2480        CMB  R36,=23D
2490        JCY  HEPER2
2500        STBD R36,X34,HLPCNT
2510 H+     DCB  R36
2520        JZR  GOTHEL
2530        ADM  R46,=5,0
2540        JMP  H+    
2550 HEPER2 JSB  =ERROR+
2560        BYT  67D
2570 HELP   BSZ  1600
2580 !  ***********************
2590 KEYRT) LDM  R20,=KEYCHK
2600        ADM  R20,R14
2610        PUMD R20,+R6
2620 KEYRTN RTN  
2630 KEYS   BIN  
2640        LDMD R14,=BINTAB
2650        CMB  R16,=2
2660        JNZ  KEYRTN
2670        LDBD R34,=KEYHIT
2680        LDM  R36,=KEYLST
2690        ADM  R36,R14
2700 KEYS1  POMD R32,+R36
2710        CMB  R32,=377
2720        JZR  KEYRT)
2730        CMB  R32,R34
2740        JNZ  KEYS1 
2750        CLM  R36
2760        LDB  R36,R33
2770        CMB  R36,=96D
2780        JZR  LABOF 
2790        CMB  R36,=150D
2800        JNZ  SOFT  
2810        JSB  =SETTR1
2820        LDMD R55,X14,LABTAB
2830 LACOM  JZR  KOUT  
2840        LDMD R45,=ONFLAG
2850        JNZ  KOUT  
2860        LDMD R45,=PTR1  
2870        STMD R45,=ONFLAG
2880        STMD R55,=PTR1  
2890        LDB  R16,=7
2900        JSB  =EOJ2  
2910        POMD R30,-R6
2920 KOUT   POMD R30,-R6
2930        CLE  
2940        BIN  
2950        RTN  
2960 LABOF  JSB  =SETTR1
2970        LDMD R55,X14,LABTA2
2980        JMP  LACOM 
2990 SOFT   CMB  R36,=7
3000        JCY  HELPK 
3010        CMB  R36,=6
3020        JNZ  PUSHIS
3030        LDBD R36,X14,HISCNT
3040        DCB  R36
3050        JPS  HIS-OK
3060        JMP  HIS-R 
3070 HISERR JSB  =ERROR+
3080        BYT  366
3090 HIS-OK STBD R36,X14,HISCNT
3100        LDMD R36,X14,HISPTR
3110        LDB  R42,=40
3120        LDM  R43,R42
3130        PUMD R43,-R36
3140        PUMD R42,-R36
3150        STMD R36,X14,HISPTR
3160 HIS-R  RTN  
3170 PUSHIS STM  R36,R34
3180        LDBD R36,X14,HISCNT
3190        ICB  R36
3200        CMB  R36,=10
3210        JCY  HISERR
3220        STBD R36,X14,HISCNT
3230        LDM  R36,R34
3240        LLM  R36
3250        LLM  R36
3260        LLM  R36
3270        ADM  R36,R34
3280        ADM  R36,R34
3290        ADM  R36,R34
3300        ICM  R36
3310        ICM  R36
3320        ADM  R36,=LEGEN2
3330 HISSSS LDMD R34,X14,HISPTR
3340        POMD R40,+R36
3350        PUMD R40,+R34
3360        POMD R45,+R36
3370        PUMD R45,+R34
3380        STMD R34,X14,HISPTR
3390        RTN  
3400 HELPK  LDMD R34,=CRTBYT
3410        STMD R34,X14,SAVCRB
3420        LDMD R34,=CRTRAM
3430        JSB  =BYTCR!
3440        LDM  R76,=SCRSIZ
3450        LDM  R66,=SCREEN
3460        ADMD R66,=BINTAB
3470 HLOP1  JSB  =INCHR 
3480        PUBD R32,+R66
3490        DCM  R76
3500        JNZ  HLOP1 
3510        SBB  R36,=7
3520        STMD R36,X14,KEY#  
3530        STB  R36,R37
3540        CLB  R36
3550        LDMD R34,=CRTRAM
3560        JSB  =BYTCR!
3570        LRM  R37
3580        ADM  R36,R14
3590        ADM  R36,=HELP  
3600        LDB  R30,=23D
3610        LDBD R33,=CRTSTS
3620        ANM  R33,=10
3630        JNZ  HLOK  
3640        LDB  R30,=15D
3650 HLOK   LDMD R32,X14,KEY#  
3660        ADM  R32,R14
3670        LDBD R32,X32,HLPCNT
3680        JZR  BLNKFL
3690 HLOP2  POMD R43,+R36
3700        LDM  R50,R30
3710        PUMD R50,+R6
3720        JSB  X14,TURN  
3730        LDM  R26,=INPBUF
3740        LDM  R36,R45
3750        SBM  R36,R26
3760        JSB  =OUTST+
3770        POMD R50,-R6
3780        STM  R50,R30
3790        DCB  R30
3800        JZR  HOUT  
3810        DCB  R32
3820        JNZ  HLOP2 
3830        TSB  R30
3840        JZR  HOUT  
3850 BLNKFL LDM  R50,R30
3860        PUMD R50,+R6
3870        LDM  R36,=1,0
3880        LDM  R26,=BLANK 
3890        ADM  R26,R14
3900        JSB  =OUTST+
3910        POMD R50,-R6
3920        STM  R50,R30
3930        DCB  R30
3940        JNZ  BLNKFL
3950 HOUT   JSB  =DECUR2
3960        LDBD R30,=MENFLG
3970        PUBD R30,+R6
3980        JSB  X14,MENON.
3985        JSB  =DECUR2
3990        POBD R30,-R6
4000        STBD R30,=MENFLG
4010        LDMD R34,=CRTRAM
4020        ADM  R34,=65D,0
4030        STMD R34,=CRTBYT
4040        JSB  =CHKSTS
4050        STMD R34,=CRTBAD
4060        JSB  X14,OUTHED
4070        LDM  R26,=HISTRY
4080        ADM  R26,R14
4090        LDBD R47,X14,HISCNT
4100        JZR  KEYLOO
4110 HISLO3 LDMD R34,=CRTBYT
4120        ADM  R34,=65D,0
4130        JSB  =CHKSTS
4140        STMD R34,=CRTBAD
4150        ADM  R34,=12D,0
4160        STMD R34,=CRTBYT
4170        LDB  R46,=11D
4180        LDM  R32,=34,40
4190        JSB  =CHKSTS
4200        STBD R32,=CRTDAT
4210        JSB  =CHKSTS
4220        STBD R33,=CRTDAT
4230        CLE  
4240 HISLO4 POBD R33,+R26
4250        ANM  R33,=177
4260        JEN  HIS-DO
4270        CMB  R33,=40
4280        JZR  SKPBLN
4290 HIS-DO JSB  =CHKSTS
4300        STBD R33,=CRTDAT
4310        ICE  
4320 SKPBLN DCB  R46
4330        JNZ  HISLO4
4340        PUMD R26,+R6
4350        LDM  R26,=TAIL  
4360        ADM  R26,R14
4370        LDM  R36,=2,0
4380        JSB  =OUTST+
4390        POMD R26,-R6
4400        DCB  R47
4410        JNZ  HISLO3
4420        LDMD R34,=CRTBYT
4430        ADM  R34,=65D,0
4440        STMD R34,=CRTBYT
4450        JSB  =CHKSTS
4460        STMD R34,=CRTBAD
4470        JSB  X14,OUTFOT
4480        LDBD R77,=KEYHIT
4490        JSB  =EOJ2  
4500 KEYLOO LDBD R36,=SVCWRD
4510        JEV  KEYLOO
4520        STBD R77,=KEYHIT
4530        LDMD R34,=CRTRAM
4540        JSB  =BYTCR!
4550        LDM  R76,=SCRSIZ
4560        LDM  R66,=SCREEN
4570        ADMD R66,=BINTAB
4580 HLOP7  POBD R32,+R66
4590        JSB  =CHKSTS
4600        STBD R32,=CRTDAT
4610        DCM  R76
4620        JNZ  HLOP7 
4630        LDMD R34,X14,SAVCRB
4640        STMD R34,=CRTBYT
4650        JSB  =BYTCR!
4660        CLE  
4670        RTN  
4680 BLANK  BYT  40
4690 SAVCRB BSZ  2
4700 OUTFOT LDM  R26,=FOOT  
4710        JMP  OUTCOM
4720 OUTHED LDM  R26,=HEAD  
4730        JMP  OUTCOM
4740 OUTLIN LDM  R26,=LINE  
4750 OUTCOM ADM  R26,R14
4760        LDM  R36,=14D,0
4770        JSB  =OUTST+
4780        RTN  
4790 LINE   ASC  "           "
4800 TAIL   ASC  " "
4810 HEAD   ASC  "  ÈÉÓÔÏÒÙº  "
4820 FOOT   ASC  "            "
4830 ! ************************
4840 SCRSIZ EQU  1920D
4850 SCREEN BSZ  1920D
4860 KEY#   BSZ  2
4870 KEYSTS DAD  177402
4880 KEYLST BYT  96D,96D
4890        BYT  150D,150D
4900        BYT  200,0
4910        BYT  201,1
4920        BYT  202,2
4930        BYT  203,3
4940        BYT  161D,4
4950        BYT  162D,5
4960        BYT  156D,6
4970        BYT  132D,7
4980        BYT  133D,10
4990        BYT  134D,11
5000        BYT  135D,12
5010        BYT  165D,13
5020        BYT  172D,14
5030        BYT  147D,15
5040        BYT  377
5050 ! 
5060 !  ***********************
5070 MENFLG BSZ  1
5080 MENADR BSZ  2
5090 MENSAV DAD  102264
5100 LABTAB BSZ  3
5110 LABTA2 BSZ  3
5120 HISCNT BSZ  1
5130 HISPTR BSZ  2
5140 HISTRY BSZ  100D
5150 !  ***********************
5160 PUSH32 DAD  24746
5170 GOTOSU DAD  30315
5180 ALPHA  DAD  12321
5190 DECUR2 DAD  13253
5200 MOVCRS DAD  13555
5210 INCHR  DAD  14045
5220 BYTCR! DAD  13567
5230 CHKSTS DAD  12763
5240 HMCURS DAD  13445
5250 CURS   DAD  13614
5260 SKPNAM DAD  32213
5270 ROMFL  DAD  104065
5280 BINTAB DAD  104070
5290 CHIDLE DAD  103670
5300 PTR2-  DAD  177715
5310 SCAN   DAD  21110
5320 STREX+ DAD  23701
5330 ERROR+ DAD  10007
5340 LLN-2  DAD  104233
5350 CRTRAM DAD  100210
5360 CRTBYT DAD  100206
5370 LEGEN2 DAD  101265
5380 CRTDAT DAD  177703
5390 PTR1   DAD  177710
5400 PTR1-  DAD  177711
5410 KEYHIT DAD  101142
5420 SETTR1 DAD  2534
5430 ONFLAG DAD  100065
5440 EOJ2   DAD  14311
5450 OUTST+ DAD  13637
5460 HLPCNT BSZ  7
5470 ONEB   DAD  56676
5480 ROMJSB DAD  6060
5490 INPBUF DAD  100236
5500 CRTBAD DAD  177701
5510 ASIZE  DAD  104744
5520 CRTSTS DAD  177702
5530        LNK  PIIS2.asm
