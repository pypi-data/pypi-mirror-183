0010        NAM  VESUV 
0020        DEF  RUNTIM
0030        DEF  TOKS  
0040        DEF  PARSE 
0050        DEF  ERMSG 
0060        DEF  INIT  
0070 RUNTIM BYT  0,0
0080        DEF  SETCH.
0090        DEF  VESUV.
0100 PARSE  BYT  0,0
0110        DEF  SETPAR
0120        DEF  VESPAR
0130        BYT  377,377
0140 TOKS   ASP  "SET CHARS"
0150        ASP  "VESUVIUS"
0160        BYT  377
0170 INIT   RTN  
0180 ERMSG  BYT  200
0190        BYT  200,200,200,200
0200        BYT  200,200,200,200
0210        ASP  "MUST BE ONE DIMENSIONAL ARRAY"
0220        ASP  "MUST BE AN INTEGER ARRAY"
0230        BYT  377
0240 ! ************************
0250 SETPAR PUBD R43,+R6
0260        JSB  =SCAN  
0270        JSB  =FORMAR
0280 ERR    POBD R57,-R6
0290        JEN  OK    
0300        JSB  =ERROR+
0310        BYT  88D
0320 OK     LDB  R55,=371
0330        PUMD R55,+R12
0340        RTN  
0350 ! ************************
0360 VESPAR PUBD R43,+R6
0370        JSB  =SCAN  
0380        JSB  =STRREF
0390        JEZ  ERR   
0400        CMB  R14,=54
0410        CLE  
0420        JNZ  ERR   
0430        JSB  =STREX+
0440        JEZ  ERR   
0450        POBD R57,-R6
0460        JMP  OK    
0470 ! ************************
0480        BYT  241
0490 VESUV. BIN  
0491 ! 
0492 ! 
0500 !  THE R12 STACK WILL HAVE
0501 ! 
0502 !    2 BYTES   ADDR. B
0510 !    2 BYTES   LENGTH TO ST
0520 !    2 BYTES   ADDR. 1st CH
0530 !    2 BYTES   LENGTH P
0540 !    2 BYTES   ADDR. P
0550 !  R12-----
0560 ! 
0570 !  THE SYNTAX FOR VESUVIUS
0580 ! 
0590 !   VESUVIUS B$,P
0600 ! 
0610 !  WHERE B$ HAS TO BE 
0620 !  STRING VARIABLE AND I
0630 !  THE I/O BUFFER, AND P
0640 !  IS A STRING EXPRESSIO
0650 !  AND IS THE STRING TO B
0660 !  PRINTED
0670 ! 
0680 ! 
0690        POMD R26,-R12
0700        POMD R36,-R12
0710        JNZ  #NULL$
0720        POMD R44,-R12
0730        RTN  
0740 #NULL$ POMD R20,-R12
0750        POMD R22,-R12
0751        POMD R66,-R12
0752        JSB  =FETSVA
0760        POMD R32,+R34
0770        POMD R32,+R34
0780        LDM  R20,R36
0790        BCD  
0800        LLM  R20
0810        BIN  
0820        LLM  R20
0830        CMM  R20,R32
0840        JNC  OK3   
0850        JZR  OK3   
0860        JSB  =ERROR 
0870        BYT  56D
0880        LDM  R22,R32
0890        LRM  R23
0900        BCD  
0910        LRM  R23
0920        BIN  
0930        STM  R22,R36
0940        LDM  R20,R32
0950 OK3    PUMD R20,+R34
0970 LOOP   POBD R32,+R26
0980        ANM  R32,=177,0
0990        LLM  R32
1000        BCD  
1010        LLM  R32
1020        BIN  
1030        ADM  R32,=CHARS 
1040        ADMD R32,=BINTAB
1050        POMD R40,+R32
1060        PUMD R40,+R34
1070        POMD R40,+R32
1080        PUMD R40,+R34
1090        POMD R40,+R32
1100        PUMD R40,+R34
1110        POMD R40,+R32
1120        PUMD R40,+R34
1130        DCM  R36
1140        JNZ  LOOP  
1150        RTN  
1160 ! ************************
1170        BYT  241
1180 SETCH. BIN  
1190        POMD R46,-R12
1200        BCD  
1210        LRB  R46
1220        ANM  R46,=3,0
1230        BIN  
1240        DCM  R46
1250        JZR  OK4   
1260        JSB  =ERROR+
1270        BYT  365
1280 OK4    POMD R34,-R12
1290        POMD R20,+R34
1300        POMD R36,+R34
1310        POMD R32,+R34
1320        ICM  R32
1330        TSM  R32
1340        JZR  OK5   
1350        JSB  =ERROR+
1360        BYT  366
1370 OK5    STM  R34,R24
1380        STM  R36,R26
1390        LDM  R22,=CHARS 
1400        ADMD R22,=BINTAB
1410 LOOP2  LDB  R44,=377
1420        POMD R45,+R24
1430        PUMD R40,+R12
1440        JSB  =ONEB  
1450        PUBD R46,+R22
1460        DCM  R26
1470        JNZ  LOOP2 
1480        RTN  
1490 CHARS  BSZ  4200D
1500 BINTAB DAD  101233
1510 ONEB   DAD  56113
1520 SCAN   DAD  11262
1530 STRREF DAD  13753
1540 STREX+ DAD  13623
1550 ERROR  DAD  6615
1560 ERROR+ DAD  6611
1570 FETSVA DAD  44556
1580 FORMAR DAD  16317
1590        FIN  
