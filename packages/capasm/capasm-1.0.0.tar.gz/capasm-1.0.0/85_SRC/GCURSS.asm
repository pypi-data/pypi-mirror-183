0010        NAM  GCURS 
0020        DEF  RUNTIM
0030        DEF  TOKS  
0040        DEF  PARSES
0050        DEF  ERMSG 
0060        DEF  INIT  
0070 RUNTIM BSZ  2
0080        DEF  GCOFF.
0090        DEF  GCURX.
0100        DEF  GCURY.
0110        DEF  GCURS.
0120        DEF  .   
0130 PARSES BSZ  2
0140        DEF  GCOFFP
0150        DEF  GCPAR 
0160        DEF  GCPAR 
0170        DEF  GCPAR 
0180 ERMSG  BYT  377,377
0190 TOKS   ASP  "GCURSOR OFF"
0200        ASP  "GCURSOR X"
0210        ASP  "GCURSOR Y"
0220        ASP  "GCURSOR"
0230        ASP  ""
0240        BYT  377
0250 INIT   BIN  
0260        LDMD R32,=BINTAB
0270        LDBD R34,=ROMFL 
0280        CMB  R34,=1
0290        JNZ  SCRAT?
0300 RESET  LDB  R36,=KYRPT1
0310        STBD R36,X32,KEYCON
0320        LDM  R36,=KEY   
0330        ADM  R36,R32
0340        STM  R36,R45
0350        LDB  R47,=236
0360        LDB  R44,=316
0370 STO    STMD R#,=CHIDLE
0380        RTN  
0390 SCRAT? CMB  R#,=2
0400        JNZ  LODBN?
0410 SCRAT! LDM  R44,=236,236,236,236
0420        JMP  STO   
0430 LODBN? CMB  R#,=5
0440        JZR  SCRAT!
0450 RTN    RTN  
0460 ! *************************
0470 LEFT   LDMD R40,X14,STEP  
0480        JMP  COMLEF
0490 RIGHT  LDMD R40,X14,STEP  
0500        JMP  COMRIT
0510 KEY    LDMD R14,=BINTAB
0520        BIN  
0530        CMB  R16,=2
0540        JNZ  RTN   
0550        LDMD R22,=KEYHIT
0560        CMB  R22,=211
0570        JZR  FRIGHT
0580        CMB  R22,=223
0590        JZR  FLEFT 
0600        CMB  R22,=245
0610        JZR  FUP   
0620        CMB  R22,=242
0630        JZR  DOWN  
0640        CMB  R22,=234
0650        JZR  LEFT  
0660        CMB  R22,=235
0670        JZR  RIGHT 
0680        CMB  R22,=241
0690        JZR  UP    
0700        CMB  R22,=254
0710        JZR  FDOWN 
0720        RTN  
0730 DOWN   LDMD R40,X14,STEP  
0740        JMP  COMDOW
0750 UP     LDMD R40,X14,STEP  
0760        JMP  COMUP 
0770 FRIGHT LDMD R40,X14,FSTEP 
0780 COMRIT JSB  X14,PUSH  
0790        LDMD R50,X14,CURS-X
0800        JSB  =ADD10 
0810        LDMD R50,=CRXMAX
0820        JSB  X14,CHECK 
0830        POMD R#,-R#
0840        JEN  COMKEY
0850        STMD R#,X14,CURS-X
0860        JMP  COMKEY
0870 FLEFT  LDMD R40,X14,FSTEP 
0880 COMLEF JSB  X14,PUSH  
0890        LDMD R50,X14,CURS-X
0900        JSB  =SUB10 
0910        LDM  R50,R40
0920        LDMD R40,=CRXMIN
0930        JSB  X14,CHECK 
0940        POMD R#,-R#
0950        JEN  COMKEY
0960        STMD R#,X14,CURS-X
0970        JMP  COMKEY
0980 FUP    LDMD R40,X14,FSTEP 
0990 COMUP  JSB  X14,PUSH  
1000        LDMD R50,X14,CURS-Y
1010        JSB  =ADD10 
1020        LDMD R50,=CRYMAX
1030        JSB  X14,CHECK 
1040        POMD R#,-R#
1050        JEN  COMKEY
1060        STMD R#,X14,CURS-Y
1070        JMP  COMKEY
1080 FDOWN  LDMD R40,X14,FSTEP 
1090 COMDOW JSB  X14,PUSH  
1100        LDMD R50,X14,CURS-Y
1110        JSB  =SUB10 
1120        LDM  R50,R40
1130        LDMD R40,=CRYMIN
1140        JSB  X14,CHECK 
1150        POMD R#,-R#
1160        JEN  COMKEY
1170        STMD R#,X14,CURS-Y
1180 COMKEY JSB  =MOVE. 
1190        JSB  X14,PLOT+ 
1200        JSB  X14,PLOT  
1210        CLE  
1220        JSB  =EOJ2  
1230        LDBD R31,X14,KEYCON
1240 LOOPKE LDBD R30,=KEYSTS
1250        LRB  R30
1260        JEV  EOJ   
1270        LDBD R30,=CRTSTS
1280        LRB  R30
1290        JEV  LOOPKE
1300 LOOPK2 LDBD R30,=KEYSTS
1310        LRB  R30
1320        JEV  EOJ   
1330        LDBD R30,=SVCWRD
1340        JOD  EOJ   
1350        LDBD R30,=CRTSTS
1360        LRB  R30
1370        JOD  LOOPK2
1380        DCB  R31
1390        JNZ  LOOPKE
1400        LDB  R31,=KYRPT2
1410        STBD R31,X14,KEYCON
1420        LDM  R20,=KEY   
1430        ADM  R20,R14
1440        DCM  R20
1450        LDM  R4,R20
1460 EOJ    LDB  R31,=KYRPT1
1470        STBD R31,X14,KEYCON
1480        POMD R42,-R6
1490        CLE  
1500        RTN  
1510 ! ************************
1520 CHECK  JSB  =SUB10 
1530        POMD R#,-R#
1540        LRB  R41
1550        CLB  R41
1560        ELB  R41
1570        CLE  
1580        TSB  R41
1590        JZR  CHECK+
1600        ICE  
1610 CHECK+ DRP  R40
1620        ARP  R12
1630        BIN  
1640        RTN  
1650 ! ************************
1660 PUSH   LDMD R60,X14,CURS-X
1670        PUMD R60,+R12
1680        LDMD R60,X14,CURS-Y
1690        PUMD R60,+R12
1700        BCD  
1710        RTN  
1720 ! ************************
1730 GCPAR  PUBD R43,+R6
1740        JSB  =NUMVA+
1750        JEN  OK    
1760 ERR    JSB  =ERROR+
1770        BYT  81D
1780 OK     JSB  =GETCMA
1790        JSB  =NUMVAL
1800        JEZ  ERR   
1810        CMB  R14,=54
1820        JNZ  DONE  
1830        JSB  =NUMVA+
1840        JEZ  ERR   
1850        CMB  R14,=54
1860        JNZ  DONE  
1870        JSB  =NUMVA+
1880        JEZ  ERR   
1890 DONE   POBD R47,-R6
1900        LDB  R45,=371
1910        PUMD R45,+R12
1920        RTN  
1930 ! ************************
1940 GCOFFP PUBD R43,+R6
1945        JSB  =SCAN  
1950        JMP  DONE  
1960 ! ************************
1970        BYT  241
1980 GCOFF. LDM  R44,=236,236,236,236
1990        STMD R44,=CHIDLE
1994        LDMD R14,=BINTAB
1996        JSB  X14,PLOT  
2000        RTN  
2010 ! ************************
2020        BYT  0,55
2030 GCURX. LDMD R14,=BINTAB
2040        LDMD R50,X14,CURS-X
2050        LDMD R40,=XFACT 
2060        JSB  =DIV10 
2070        POMD R50,-R#
2080        CLM  R40
2090        LDB  R47,=20C
2100        JSB  =SUB10 
2110        POMD R40,-R12
2120        LDMD R50,=XFACT 
2130        JSB  =MPY10 
2140        RTN  
2150 ! ************************
2160        BYT  0,55
2170 GCURY. LDMD R14,=BINTAB
2180        LDMD R50,X14,CURS-Y
2190        LDMD R40,=YFACT 
2200        JSB  =DIV10 
2210        POMD R#,-R#
2220        CLM  R50
2230        LDB  R57,=20C
2240        JSB  =ADD10 
2250        POMD R#,-R#
2260        LDMD R50,=YFACT 
2270        JSB  =MPY10 
2280        RTN  
2290 ! ************************
2300        BYT  241
2310 GCURS. STMD R6,=SAVER6
2320        JSB  =ONER  
2330        PUMD R#,+R6
2340        JSB  =ONER  
2350        CMMD R12,=TOS   
2360        JZR  DOEM  
2370        PUMD R40,+R6
2380        JSB  =ONER  
2390        CMMD R12,=TOS   
2400        JZR  DOEM  
2410        PUMD R40,+R6
2420        JSB  =ONER  
2430 DOEM   PUMD R40,+R12
2440 DOEM+  POMD R40,-R6
2450        PUMD R40,+R12
2460        CMMD R6,=SAVER6
2470        JNZ  DOEM+ 
2480        POMD R50,-R12
2490        POMD R40,-R12
2500        BIN  
2510        CLM  R60
2520        LDB  R67,=10C
2530        CLM  R70
2540        LDB  R77,=40C
2550        CMMD R12,=TOS   
2560        JZR  GOTEM 
2570        STM  R50,R60
2580        STM  R40,R50
2590        POMD R40,-R12
2600        CMMD R12,=TOS   
2610        JZR  GOTEM 
2620        STM  R60,R70
2630        STM  R50,R60
2640        STM  R40,R50
2650        POMD R40,-R12
2660 GOTEM  LDMD R14,=BINTAB
2670        STMD R40,X14,CURS-X
2680        STMD R60,X14,STEP  
2690        STMD R70,X14,FSTEP 
2700        LDMD R40,=YFACT 
2710        JSB  =DIV10 
2720        POMD R50,-R#
2730        CLM  R40
2740        LDB  R47,=20C
2750        JSB  =SUB10 
2760        POMD R#,-R#
2770        LDMD R50,=YFACT 
2780        JSB  =MPY10 
2790        POMD R#,-R#
2800        STMD R#,X14,CURS-Y
2810        LDMD R50,X14,CURS-X
2820        LDMD R40,=XFACT 
2830        JSB  =DIV10 
2840        POMD R#,-R#
2850        CLM  R50
2860        LDB  R57,=20C
2870        JSB  =ADD10 
2880        POMD R#,-R#
2890        LDMD R50,=XFACT 
2900        JSB  =MPY10 
2910        POMD R#,-R#
2920        STMD R#,X14,CURS-X
2930        LDMD R50,=CRXMAX
2940        JSB  =COMFLT
2950        JEN  NOT-1 
2960        LDMD R50,=CRXMAX
2970        STMD R50,X14,CURS-X
2980 NOT-1  LDMD R40,X14,CURS-Y
2990        LDMD R50,=CRYMAX
3000        JSB  =COMFLT
3010        JEN  NOT-2 
3020        LDMD R50,=CRYMAX
3030        STMD R50,X14,CURS-Y
3040 NOT-2  LDMD R50,X14,CURS-Y
3050        LDMD R40,=CRYMIN
3060        JSB  =COMFLT
3070        JEN  NOT-3 
3080        LDMD R50,=CRYMIN
3090        STMD R50,X14,CURS-Y
3100 NOT-3  LDMD R50,X14,CURS-X
3110        LDMD R40,=CRXMIN
3120        JSB  =COMFLT
3130        JEN  NOT-4 
3140        LDMD R50,=CRXMIN
3150        STMD R50,X14,CURS-X
3160 NOT-4  JSB  X14,PLOT  
3170        LDM  R46,=KEY   
3180        ADM  R46,R14
3190        STM  R46,R45
3200        LDB  R47,=236
3210        LDB  R44,=316
3220        STMD R44,=CHIDLE
3230        RTN  
3240 ! ************************
3250 PLOT   JSB  X14,PUSH  
3260        JSB  =MOVE. 
3270 PLOT+  LDM  R20,=CURSES
3280        ADM  R20,R14
3290        LDBD R22,=XMAP  
3300        ANM  R22,=3,0
3310        LDM  R34,R22
3320        LLM  R34
3330        LLM  R34
3340        ADM  R34,R22
3350        ADM  R34,R20
3360        LDM  R22,=5,0
3370        LDM  R44,=1,0,1,0
3380        JSB  =BPLOT+
3390        RTN  
3400 ! ************************
3410 CURSES BYT  40,40,370,40,40
3420        BYT  20,20,174,20,20
3430        BYT  10,10,76,10,10
3440        BYT  4,4,37,4,4
3450 KEYCON BSZ  1
3460 CURS-X BSZ  10
3470 CURS-Y BSZ  10
3480 FSTEP  BSZ  10
3490 STEP   BSZ  10
3500 ! ************************
3510        BYT  0,56
3520 .    BIN  
3530        LDM  R44,=11D,0
3540        DEF  DATE  
3550        ADMD R46,=BINTAB
3560        PUMD R44,+R12
3570        RTN  
3580 DATE   ASC  "JUNE 6,1980"
3590 ! ************************
3600 CRTGBA DAD  101104
3610 BPLOT+ DAD  34405
3620 MOVE.  DAD  31703
3630 KYRPT2 EQU  1
3640 KYRPT1 EQU  30
3650 CRTSTS DAD  177406
3660 KEYSTS DAD  177402
3670 CHIDLE DAD  102416
3680 ROMFL  DAD  101231
3690 KEYHIT DAD  100671
3700 EOJ2   DAD  34772
3710 ADD10  DAD  52233
3720 SUB10  DAD  52137
3730 MPY10  DAD  52562
3740 DIV10  DAD  51644
3750 BINTAB DAD  101233
3760 NUMVAL DAD  12412
3770 NUMVA+ DAD  12407
3775 SCAN   DAD  11262
3780 GETCMA DAD  13414
3790 SVCWRD DAD  100151
3800 TOS    DAD  101132
3810 ERROR+ DAD  6611
3820 CRXMAX DAD  100202
3830 CRYMAX DAD  100212
3840 CRXMIN DAD  100222
3850 CRYMIN DAD  100232
3860 ONER   DAD  56215
3870 XMAP   DAD  100262
3880 XFACT  DAD  100242
3890 YFACT  DAD  100252
3900 COMFLT DAD  32621
3910 SAVER6 DAD  101174
3920        FIN  
