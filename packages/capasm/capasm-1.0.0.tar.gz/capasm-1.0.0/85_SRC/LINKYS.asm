0010        NAM  LINKEY
0020        DEF  RUNTIM
0030        DEF  ASCIIS
0040        DEF  PARSE 
0050        DEF  ERMSG 
0060        DEF  INIT  
0070 RUNTIM OCT  0,0
0080        DEF  KEYON.
0090        DEF  KEYOF.
0100        DEF  LINPT.
0110        DEF  MOVCR.
0120        DEF  UNLOD.
0130        DEF  .   
0140        OCT  0,0
0150        DEF  LIN$. 
0160 PARSE  OCT  0,0
0170        DEF  KONPRS
0180        DEF  KOFPRS
0190        DEF  LINPRS
0200        DEF  CURPRS
0210        DEF  UNLODP
0220        OCT  377,377
0230 ASCIIS ASP  "KEY ON"
0240        ASP  "KEY OFF"
0250        ASP  "LINPUT"
0260        ASP  "MOVE CURSOR"
0270        ASP  "UNLOAD"
0280        ASP  ""
0290        OCT  377
0300        OCT  240
0310 ERMSG  OCT  200
0320        OCT  200,200,200,200
0330        OCT  200,200,200,200
0340        ASP  "BAD 'KEY ON' FORMAT"
0350        ASP  "SYSTEM HOOK IN USE"
0360        OCT  377
0370 INIT   BIN  
0380        LDMD R22,=BINTAB
0390        LDBD R36,=ROMFL 
0400        DCB  R36
0410        JNZ  SCRAT?
0420 RESET  LDBD R46,=CHIDLE
0430        CMB  R46,=236
0440        JZR  RSET  
0450        JSB  =ERROR+
0460        OCT  365
0470 RSET   LDM  R24,=KEYCHK
0480        ADM  R24,R22
0490        STM  R24,R45
0500        LDB  R47,=236
0510        LDB  R44,=316
0520        STMD R44,=CHIDLE
0530        LDMD R51,=KYIDLE
0540        STMD R51,X22,BANKKY
0550        LDM  R46,R22
0560        ADM  R46,=KEYBIN
0570        LDB  R45,=316
0580        STMD R45,=KYIDLE
0590        RTN  
0600 SCRAT? DCB  R#
0610        JNZ  LODBIN
0620 SCRAT  LDM  R44,=236
0630        RTN  
0640        RTN  
0650        RTN  
0660        STMD R44,=CHIDLE
0670        LDMD R41,X22,BANKKY
0680        STMD R41,=KYIDLE
0690        RTN  
0700 LODBIN DCB  R#
0710        JZR  RESET 
0720        DCB  R#
0730 RUNINI JNZ  LOAD  
0740 RUNIN  JSB  X22,OFF   
0750        RTN  
0760 LOAD   DCB  R#
0770        JZR  SCRAT 
0780        DCB  R#
0790        DCB  R#
0800        JZR  RUNIN 
0810        RTN  
0820 KEYBIN STBD R#,=GINTDS
0830        BIN  
0840        DCM  R6
0850        DCM  R6
0860        STBD R#,=GINTEN
0870 BANKKY BSZ  10
0880 KEYCHK JSB  =SETTR1
0890        BIN  
0900        TSB  R16
0910        JOD  KOUT  
0920        JZR  KOUT  
0930        CMB  R16,=4
0940        JZR  KOUT  
0950        LDMD R22,=BINTAB
0960        LDMD R30,X22,KYTAB 
0970        JZR  KOUT  
0980        LDMD R36,=ONFLAG
0990        JNZ  KOUT  
1000        LDBD R32,=KEYHIT
1010        STB  R32,R34
1020        ANM  R32,=37,0
1030        ADM  R32,R22
1040        LDBD R26,X32,STORE 
1050        CLB  R27
1060        ICB  R27
1070        BCD  
1080        LRB  R34
1090        BIN  
1100        LRB  R34
1110        JZR  DONNE 
1120 TEST   LLB  R27
1130        DCB  R34
1140        JNZ  TEST  
1150 DONNE  ANM  R27,R26
1160        JZR  KOUT  
1170        STMD R10,=ONFLAG
1180        LDM  R10,R30
1190        CLB  R37
1200        LDBD R36,=KEYHIT
1210        JSB  =CONBIN
1220        LDMD R34,X22,ADRESS
1230        PUMD R34,+R12
1240        LDMD R34,X22,NAME  
1250        PUMD R34,+R12
1260        PUMD R40,+R12
1270        JSB  =STOSV 
1280        LDB  R16,=7
1290        JSB  =EOJ2  
1300        POMD R#,-R6
1310 KOUT   POMD R30,-R6
1320        CLE  
1330        BIN  
1340        RTN  
1350 KONPRS PUBD R43,+R6
1360        JSB  =SCAN  
1370        CLE  
1380        JSB  =REFNUM
1390        CMB  R14,=COMMA 
1400        JNZ  NO-$  
1410        JSB  =STREX+
1420        JEZ  ERR82 
1430 NO-$   POBD R57,-R6
1440        LDB  R55,=371
1450        PUMD R55,+R12
1460        CMB  R47,=210
1470        JNZ  ERR89 
1480        JSB  =GOTOSU
1490        RTN  
1500 KOFPRS PUBD R43,+R6
1510        JSB  =STREX+
1520        POBD R57,-R6
1530        LDB  R55,=371
1540        PUMD R55,+R12
1550        RTN  
1560 ERR82  POBD R57,-R6
1570        JSB  =ERROR+
1580        OCT  366
1590 ERR89  JSB  =ERROR+
1600        OCT  131
1610 LINPRS LDM  R65,=371,0,3
1620        PUMD R65,+R12
1630        JSB  =SCAN  
1640        JSB  =STRREF
1650        JEZ  ERR89 
1660        LDM  R65,=371,0,10
1670        PUMD R65,+R12
1680        RTN  
1690 UNLODP LDB  R47,R43
1700        LDB  R45,=371
1710        PUMD R45,+R12
1720        JSB  =SCAN  
1730        RTN  
1740 CURPRS JSB  =GET2N 
1750        POBD R47,-R12
1760        LDB  R45,=371
1770        PUMD R45,+R12
1780        RTN  
1790 KEYON. BIN  
1800        CLM  R26
1810        LDMD R22,=BINTAB
1820        LDMD R34,=TOS   
1830        ADM  R34,=4,0
1840        SBM  R34,R12
1850        JZR  KYON1 
1860        POMD R24,-R12
1870        POMD R26,-R12
1880 KYON1  STMD R10,X22,KYTAB 
1890        ADM  R10,=3,0
1900        POMD R66,-R12
1910        STMD R66,X22,NAME  
1920        POMD R66,-R12
1930        STMD R66,X22,ADRESS
1940        TSM  R26
1950        JZR  RRTN  
1960 AGAIN  JSB  X22,POPEE 
1970        ORB  R36,R37
1980        STBD R36,X30,STORE 
1990        DCM  R26
2000        JNZ  AGAIN 
2010 RRTN   RTN  
2020 POPEE  POBD R30,+R24
2030        STB  R30,R34
2040        ANM  R30,=37,0
2050        ADM  R30,R22
2060        LDBD R36,X30,STORE 
2070        CLB  R37
2080        ICB  R37
2090        BCD  
2100        LRB  R34
2110        BIN  
2120        LRB  R34
2130        JZR  DUNN  
2140 TST    LLB  R37
2150        DCB  R34
2160        JNZ  TST   
2170 DUNN   RTN  
2180        OCT  241
2190 KEYOF. BIN  
2200        LDMD R22,=BINTAB
2210        LDMD R34,=TOS   
2220        SBM  R34,R12
2230        JNZ  KYOFF1
2240 OFF    LDB  R27,=4
2250        CLM  R60
2260 STM    STMD R60,X22,STORE 
2270        ADM  R22,=10,0
2280        DCB  R27
2290        JNZ  STM   
2300        STMD R62,X22,STORE 
2310        RTN  
2320 KYOFF1 POMD R24,-R12
2330        POMD R26,-R12
2340        JZR  RRTN  
2350 AGIN   JSB  X22,POPEE 
2360        NCB  R37
2370        ANM  R37,R36
2380        STBD R37,X30,STORE 
2390        DCM  R26
2400        JNZ  AGIN  
2410        RTN  
2420 STORE  BSZ  40
2430 ADRESS BSZ  2
2440 NAME   BSZ  2
2450 KYTAB  BSZ  2
2460        OCT  241
2470 LINPT. JSB  =INPUT.
2480        RTN  
2490        OCT  44
2500 LIN$.  BIN  
2510        LDMD R32,=INPTR 
2520        STM  R32,R14
2530        CLM  R36
2540 CHRCNT POBD R35,+R32
2550        CMB  R35,=15
2560        JZR  ENDOF$
2570        ICM  R36
2580        JMP  CHRCNT
2590 ENDOF$ TSM  R36
2600        JZR  DONE  
2610        POBD R25,-R32
2620 POPBLK POBD R25,-R32
2630        CMB  R25,=40
2640        JNZ  DONE  
2650        DCM  R36
2660        JNZ  POPBLK
2670 DONE   PUMD R36,+R12
2680        PUMD R14,+R12
2690        JSB  =STOST 
2700        RTN  
2710        OCT  241
2720 MOVCR. JSB  =ALPHA.
2730        JSB  =DECUR2
2740        JSB  =HMCURS
2750        JSB  =TWOB  
2760 GET-Y  DCM  R46
2770        JNG  GET-X 
2780        JZR  GET-X 
2790        JSB  =DNCUR.
2800        JMP  GET-Y 
2810 GET-X  DCM  R56
2820        JNG  DONE1 
2830        JZR  DONE1 
2840        JSB  =RTCUR.
2850        JMP  GET-X 
2860 DONE1  JSB  =CURS  
2870        RTN  
2880        OCT  241
2890 UNLOD. STBD R#,=GINTDS
2900        LDMD R24,=BINTAB
2910        STM  R24,R22
2920        JSB  X22,SCRAT 
2930        DCM  R24
2940        LDMD R26,=LWAMEM
2950        STM  R26,R22
2960        SBM  R22,R24
2970        LDB  R20,=4
2980        LDM  R32,=LAVAIL
2990 UNLD1  LDMD R36,R32
3000        ADM  R36,R22
3010        PUMD R36,+R32
3020        DCB  R20
3030        JNZ  UNLD1 
3040        LDMD R36,R32
3050        CMMD R36,=LWAMEM
3060        JZR  UNLD2 
3070        ADM  R36,R22
3080        STMD R36,R32
3090 UNLD2  CLM  R#
3100        STMD R#,=BINTAB
3110        LDM  R#,R12
3120        LDM  R41,=316
3130        DEF  MOVDN 
3140        STBD R#,=GINTEN
3150        RTN  
3160        STMD R41,R36
3170        DCM  R36
3180        LDM  R4,R36
3190        OCT  0,56
3200 .    LDM  R44,=8D,0
3210        DEF  DATE  
3220        ADMD R46,=BINTAB
3230        PUMD R44,+R12
3240        RTN  
3250 DATE   ASC  "04/18/80"
3260 STRREF DAD  13753
3270 STOST  DAD  45603
3280 INPTR  DAD  100672
3290 INPUT. DAD  57107
3300 ERROR+ DAD  6611
3310 SCAN   DAD  11262
3320 ROMFL  DAD  101231
3330 CHIDLE DAD  102416
3340 KEYHIT DAD  100671
3350 ONFLAG DAD  100040
3360 EOJ2   DAD  34772
3370 SETTR1 DAD  2323
3380 BINTAB DAD  101233
3390 STREX+ DAD  13623
3400 CONBIN DAD  3572
3410 STOSV  DAD  45254
3420 GOTOSU DAD  17435
3430 KYIDLE DAD  102425
3440 COMMA  EQU  54
3450 TOS    DAD  101132
3460 REFNUM DAD  17025
3470 GINTEN DAD  177400
3480 GINTDS DAD  177401
3490 MOVDN  DAD  37324
3500 LWAMEM DAD  100022
3510 LAVAIL DAD  100010
3520 ALPHA. DAD  36105
3530 HMCURS DAD  35527
3540 DNCUR. DAD  35306
3550 DECUR2 DAD  35547
3560 RTCUR. DAD  35351
3570 CURS   DAD  35055
3580 TWOB   DAD  56176
3590 GET2N  DAD  14407
3600        FIN  
