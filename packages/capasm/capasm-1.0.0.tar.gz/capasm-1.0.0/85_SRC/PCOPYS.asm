0010        GLO  GLOBAL
0020 ! DUMP GRAPHIC
0030 ! 
0040        NAM  DGRAPH
0050        DEF  RUNTIM
0060        DEF  ASCIIS
0070        DEF  PARSE 
0080        DEF  ERMSG 
0090        DEF  INIT  
0100 PARSE  BYT  0,0
0110        DEF  DGRPAR
0120        DEF  GRDPAR
0130        DEF  RDMPAR
0140 RUNTIM BYT  0,0
0150        DEF  PCOPY.
0160        DEF  GREAD.
0170        DEF  RDUMP.
0180        BYT  377,377
0190 ASCIIS BSZ  0
0200        ASP  "PCOPY"
0210        ASP  "GREAD"
0220        ASP  "RDUMP"
0230 ERMSG  BYT  377
0240 INIT   RTN  
0250 ! *************************
0260 ! * PARSE EPSON W/ 1 PARAM 
0270 ! *************************
0280 DGRPAR PUBD R43,+R6
0290        JSB  =GETPA?
0300        POBD R57,-R12
0310        POBD R57,-R6
0320        CMB  R34,=4
0330        JCY  PARER 
0340 ONESOK CMB  R34,=1
0350        JCY  GOTNUM
0360 PARER  JSB  =ERROR+
0370        BYT  81D
0380 GOTNUM LDB  R55,=371
0390        PUMD R55,+R12
0400 OOPS   RTN  
0410 GRDPAR PUBD R43,+R6
0420        JSB  =SCAN  
0430        JSB  =STRREF
0440        POBD R43,-R6
0450        CMB  R14,=COMMA 
0460        JNZ  PARER 
0470        PUBD R43,+R6
0480        JSB  =NUMVA+
0490        POBD R57,-R6
0500        JEZ  PARER 
0510        JMP  GOTNUM
0520 RDMPAR PUBD R43,+R6
0530        JSB  =GETPA?
0540        POBD R57,-R12
0550        POBD R57,-R6
0560        CMB  R34,=3
0570        JCY  PARER 
0580        JMP  ONESOK
0590 ! *************************
0600 ! * EPSON RUNTIME          
0610 ! *************************
0620 THREE  JSB  =ONEB  
0630        STBD R#,=ROTATE
0640 TWO    JSB  =ONEB  
0650        JMP  ONE   
0660        BYT  241
0670 PCOPY. BIN  
0680        CLB  R26
0690        STBD R26,=ROTATE
0700        LDM  R26,R12
0710        SBMD R26,=TOS   
0720        CMB  R26,=30
0730        JZR  THREE 
0740        CMB  R26,=20
0750        JZR  TWO   
0760        LDB  R26,=22
0770 ONE    STBD R#,=OFFSET
0780        JSB  =ONER  
0790        STMD R#,=SCTEMP
0800        LDM  R36,=3,0
0810        STMD R36,=DATLEN
0820        LDM  R45,=33,101,10
0830        STMD R45,=INPBUF
0840        LDM  R26,=INPBUF
0850        STMD R26,=RESDAT
0860        JSB  =ROMJSB
0870        DEF  LDSC++
0880        BYT  360
0890        CMB  R17,=300
0900        JCY  OOPS  
0910        JMP  OVERSB
0920 ! ************************
0930 !  SUBROUTIN
0940 ! ************************
0950 CRTFLT LDMD R14,=AGLBAS
0960        LDMD R22,X14,SAVE22
0970        LDM  R34,R22
0980        ICM  R34
0990        LDM  R46,=220,1
1000        JSB  =ROMJSB
1010        DEF  CONTR+
1020        BYT  360
1030        LDM  R46,=221,15
1040        JSB  =ROMJSB
1050        DEF  CONTR+
1060        BYT  360
1070        LDM  R46,=222,12
1080        JSB  =ROMJSB
1090        DEF  CONTR+
1100        BYT  360
1110        JSB  =GRAPH.
1120        LDM  R34,=0,20
1130        STMD R34,=CRTBAD
1140        RTN  
1150 OVERSB LDMD R14,=BINTAB
1160        JSB  X14,CRTFLT
1170        LDM  R34,=276,77
1180        STMD R34,=ROTPOS
1190        LDB  R65,=30          ! ROW COUNTER
1200        LDBD R76,=ROTATE
1210        JZR  OUTLUP
1220        LDB  R65,=40
1230 OUTLUP LDM  R76,=BSZM2 
1240        ADMD R76,=BINTAB
1250        LDB  R75,=40
1260        LDBD R34,=OFFSET
1270        JZR  NOOFF 
1280        CMB  R34,=65D
1290        JCY  NOOFF 
1300 OFFPU  PUBD R75,+R76
1310        DCB  R34
1320        JNZ  OFFPU 
1330 NOOFF  LDM  R54,=33,113,0,1
1340        PUMD R54,+R76
1350 ! *************************
1360 !   FETCH ONE LIN
1370 ! *************************
1380        LDBD R34,=ROTATE
1390        JNZ  ROTAT 
1400        LDM  R56,=RECBUF
1410 LOOP   JSB  =INCHR 
1420        PUBD R#,+R56
1430        DCB  R34
1440        JNZ  LOOP  
1450 ! *************************
1460 !  PROCESS ONE LIN
1470 ! *************************
1480        CLM  R66
1490 NOTYET LDB  R0,=50
1500 LOOP2  LDBD R*,X66,RECBUF
1510        ICB  R0
1520        CMB  R0,=60
1530        JZR  PROCES
1540        ADM  R66,=40,0
1550        JMP  LOOP2 
1560 OUTJM2 JMP  OUTLUP
1570 ! 
1580 PROCES LDB  R34,=10
1590        TSM  R50
1600        JNZ  NXT   
1610        PUMD R50,+R76
1620        JMP  ADDRE 
1630 NXT    LDB  R0,=50
1640        CLB  R35
1650 TSB    LLB  R35
1660        TSB  R*
1670        JPS  SHIFT 
1680        ICB  R35
1690 SHIFT  ICB  R0
1700        CMB  R0,=60
1710        JNZ  TSB   
1720        LLM  R50
1730        PUBD R35,+R76
1740        DCB  R34
1750        JNZ  NXT   
1760 ADDRE  ADM  R66,=041,377
1770        DCB  R75
1780        JNZ  NOTYET
1790        JMP  SENDIT
1800 OUTJMP JMP  OUTJM2
1810 !   ROTATE FETCH COD
1820 ! ************************
1830 ROTAT  POMD R#,-R76
1840        LDM  R#,=300,0
1850        PUMD R#,+R76
1860        LDMD R#,=ROTPOS
1870        ICM  R#
1880        ICM  R#
1890        STMD R#,=ROTPOS
1900        STMD R#,=ROTPO2
1910        LDB  R36,=300
1920        JMP  LOOP2X
1930 LOOPR  LDMD R34,=ROTPO2
1940        SBM  R34,=100,0
1950        STMD R34,=ROTPO2
1960 LOOP2X JSB  =CHKSTS
1970        STMD R34,=CRTBAD
1980        JSB  =INCHR 
1990        PUBD R#,+R76
2000        DCB  R36
2010        JNZ  LOOPR 
2020 ! *************************
2030 !  NOW SEND THE LIN
2040 ! *************************
2050 SENDIT LDMD R14,=BINTAB
2060        JSB  X14,SEND  
2070        JNZ  OUTJMP
2080        LDM  R36,=2,0
2090        STMD R36,=DATLEN
2100        LDM  R46,=33,62
2110        STMD R46,=INPBUF
2120        JSB  =ROMJSB
2130        DEF  LDSC++
2140        BYT  360
2150 QUIT   RTN  
2160 !  ***********************
2170 !    GREAD RUNTIM
2180 !  ***********************
2190        BYT  241
2200 GREAD. JSB  =GRAPH.
2210        JSB  =ONEB  
2220        STM  R#,R44
2230        POMD R34,-R12
2240        POMD R22,-R12
2250        JZR  QUIT  
2260        POMD R56,-R12
2270        TSB  R16
2280        JOD  HEADER
2290        ADMD R56,=FWCURR
2300 HEADER POMD R60,+R56
2310        JPS  LENSET
2320        ICM  R66
2330 LENSET LDM  R20,R34
2340        SBM  R20,R56
2350        ADM  R20,R22
2360        CMM  R20,R66
2370        JNC  LENOK 
2380 LENOK  PUMD R20,-R56
2390        LDMD R76,=XMAP  
2400        STMD R76,=ROTATE
2410        STMD R76,=ROTPOS
2420        CMM  R76,=374,277
2430        JCY  FILL$J
2440 NXTP-  LDB  R0,=60
2450        CLM  R60
2460 NXTP   CMM  R76,=374,277
2470        JCY  FLOPIT
2480        JSB  =DRAW1 
2490        JSB  =INCHR 
2500        STB  R#,R*
2510        CMB  R0,=67
2520        JZR  FLOPIT
2530        ICB  R0
2540        LDMD R76,=ROTATE
2550        ADM  R76,=0,1
2560        STMD R76,=ROTATE
2570        JMP  NXTP  
2580 FLOPIT LDB  R36,=10
2590        TSM  R60
2600        JZR  PUSH$ 
2610 NXTF   LDB  R0,=50
2620        CLB  R37
2630 TSBF   LLB  R37
2640        TSB  R*
2650        JPS  SHIFTF
2660        ICB  R37
2670 SHIFTF ICB  R0
2680        CMB  R0,=70
2690        JNZ  TSBF  
2700        LLM  R60
2710        PUBD R37,+R12
2720        DCB  R36
2730        JNZ  NXTF  
2740        POMD R60,-R12
2750 PUSH$  LDB  R0,=60
2760 PUSH$L PUBD R*,+R34
2770        DCM  R22
2780        JZR  STXMAP
2790        DCM  R46
2800        JZR  NXTCOL
2810        ICB  R0
2820        CMB  R0,=70
2830        JNZ  PUSH$L
2840        LDMD R76,=ROTPOS
2850        ADM  R76,=10,0
2860 ALMOS- STMD R76,=ROTPOS
2870        STMD R76,=ROTATE
2880 ALMOST CMM  R76,=374,277
2890        JNC  NXTP- 
2900        JMP  STXMAP
2910 FILL$J JMP  FILL$ 
2920 NXTCOL LDM  R46,R44
2930        LDMD R76,=XMAP  
2940        ADM  R76,=0,10
2950        CMM  R76,=374,277
2960        JCY  STXMAP
2970        STMD R76,=XMAP  
2980        JMP  ALMOS-
2990 STXMAP LDMD R76,=XMAP  
3000        ADM  R76,=0,10
3010        CMM  R76,=0,300
3020        JCY  FILL$ 
3030        STMD R76,=XMAP  
3040 FILL$  TSM  R22
3050        JZR  RDEX  
3060        LDB  R32,=BLANK 
3070 EXLOP  PUBD R32,+R34
3080        DCM  R22
3090        JNZ  EXLOP 
3100 RDEX   RTN  
3110 ! ************************
3120 !   RASTER DUM
3130 ! ************************
3140        BYT  241
3150 RDUMP. BIN  
3160        CLM  R40
3170        LDM  R26,R12
3180        SBMD R26,=TOS   
3190        CMB  R26,=20
3200        JNZ  SCONLY
3210        JSB  =ONER  
3220 SCONLY STMD R40,=RECBUF
3230        JSB  =ONER  
3240        STMD R#,=SCTEMP
3250        LDM  R36,=4,0
3260        STMD R36,=DATLEN
3270        LDM  R44,=33,52,162,101
3280        STMD R44,=INPBUF
3290        LDM  R26,=INPBUF
3300        STMD R26,=RESDAT
3310        JSB  =ROMJSB
3320        DEF  LDSC++
3330        BYT  360
3340        CMB  R17,=300
3350        JCY  RDEX  
3360        LDMD R14,=BINTAB
3370        JSB  X14,CRTFLT
3380        LDMD R40,=RECBUF
3390        JZR  NOOFST
3400        LDM  R30,=INPBUF
3410        STMD R30,=RESDAT
3420        LDM  R55,=33,52,162
3430        PUMD R55,+R30
3440        CLM  R54
3450        BIN  
3460        JSB  =CVNUM 
3470        BIN  
3480        LDB  R57,=130
3490        PUBD R57,+R30
3500        SBM  R30,=INPBUF
3510        STMD R30,=DATLEN
3520        JSB  =ROMJSB
3530        DEF  LDSC++
3540        BYT  360
3550 NOOFST LDB  R65,=300
3560 OUTL   LDM  R76,=BSZM2 
3570        ADMD R76,=BINTAB
3580        LDM  R42,=33,52,142,63,62,127
3590        PUMD R42,+R76
3600        LDB  R34,=40
3610 GETCRT JSB  =INCHR 
3620        PUBD R#,+R76
3630        DCB  R34
3640        JNZ  GETCRT
3650        LDMD R14,=BINTAB
3660        JSB  X14,SEND  
3670        JNZ  OUTL  
3680        LDM  R36,=4,0
3690        STMD R36,=DATLEN
3700        LDM  R44,=33,52,162,102
3710        STMD R44,=INPBUF
3720        JSB  =ROMJSB
3730        DEF  LDSC++
3740        BYT  360
3750        RTN  
3760 ! ************************
3770 SEND   LDB  R26,=12
3780        PUBD R26,+R76
3790        SBMD R76,=BINTAB
3800        SBM  R76,=BSZM2 
3810        LDM  R36,R76
3820        STMD R36,=DATLEN
3830        LDM  R26,=BSZM2 
3840        ADMD R26,=BINTAB
3850        STMD R26,=RESDAT
3860        PUBD R65,+R6
3870        JSB  =ROMJSB
3880        DEF  LDSC++
3890        BYT  360
3900        POBD R65,-R6
3910        DCB  R65
3920        JNZ  SNDEX 
3930        LDMD R14,=AGLBAS
3940        LDMD R22,X14,SAVE22
3950        LDM  R34,R22
3960        ICM  R34
3961        LDM  R46,=220,2
3970        JSB  =ROMJSB
3980        DEF  CONTR+
3990        BYT  360
4000        LDM  R26,=INPBUF
4010        STMD R26,=RESDAT
4020        CLM  R26
4030 SNDEX  RTN  
4040 !  ***********************
4050 BSZM2  BSZ  324D
4060 LDSC++ DAD  76076
4070 RECBUF DAD  102000
4080 DATLEN DAD  101223
4090 RESDAT DAD  101225
4100 SAVE22 EQU  327
4110 CONTR+ DAD  61417
4120 SETSC- DAD  76752
4130 ROTATE DAD  101010
4140 OFFSET DAD  101011
4150 ROTPOS DAD  101012
4160 ROTPO2 DAD  101014
4170 COMMA  EQU  54
4180 DRAW1  DAD  31757
4190        FIN  
