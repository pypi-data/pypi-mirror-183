0010        NAM  FORMSB
0020 !  FORMSB BINARY PROGRA
0030 !  SOURCE FILE - FORMS
0040 !  VERSION 27 FEB 8
0050        DEF  RUNTIM
0060        DEF  TOKS  
0070        DEF  BASIC 
0080        DEF  ERMSG 
0090        DEF  INIT  
0100 RUNTIM BYT  0,0
0110        DEF  READC.
0120        DEF  WRITC.
0130        DEF  HOME. 
0140        DEF  PAGE. 
0150        DEF  XPOS. 
0160        DEF  YPOS. 
0170        DEF  CURSOR
0180        DEF  KEY1  
0190        DEF  KEY2  
0200        DEF  KEY3  
0210        DEF  SETKEY
0220        DEF  ENDKEY
0230 BASIC  BYT  0,0
0240        DEF  NOPARS
0250        DEF  WRPARS
0260        DEF  HOMPRS
0270        DEF  PARSIT
0280        DEF  NOPARS
0290        DEF  NOPARS
0300        DEF  CURPRS
0310        DEF  NOPARS
0320        DEF  NOPARS
0330        DEF  NOPARS
0340        DEF  HOMPRS
0350        DEF  HOMPRS
0360        BYT  377,377
0370 TOKS   ASC  7,READCHAR
0380        BYT  322
0390        ASC  10,WRITECHAR
0400        BYT  322
0410        ASC  3,HOME
0420        BYT  305
0430        ASC  3,PAGE
0440        BYT  305
0450        ASC  3,XPOS
0460        BYT  323
0470        ASC  3,YPOS
0480        BYT  323
0490        ASC  5,CURSOR
0500        BYT  322
0510        ASC  3,KEY1
0520        BYT  261
0530        ASC  3,KEY2
0540        BYT  262
0550        ASC  3,KEY3
0560        BYT  263
0570        ASC  5,SETKEY
0580        BYT  331
0590        ASC  5,ENDKEY
0600        BYT  331
0610        BYT  377
0620        BYT  377
0630 ERMSG  BYT  260
0640        BYT  377
0650 INIT   LDMD R56,=BINTAB
0660        STMD R56,=FWBIN 
0670 NOPARS RTN  
0680 SCAN   EQU  11262
0690 ERROR  EQU  6615
0700 BINTAB EQU  101233
0710 FWBIN  EQU  100020
0720 NO.CRS EQU  10130
0730 CURS   EQU  35055
0740 COUNTK EQU  34664
0750 INCHR  EQU  35244
0760 RSMEM- EQU  37453
0770 DECUR2 EQU  35547
0780 OUTCHR EQU  35114
0790 GET1$  EQU  14455
0800 GET1N  EQU  14337
0810 HMCURS EQU  35527
0820 UPCUR. EQU  35264
0830 RTCUR. EQU  35404
0840 ONEB   EQU  56113
0850 ONEI   EQU  56154
0860 TWOB   EQU  56176
0870 BYTCR! EQU  35422
0880 CRTWRS EQU  101016
0890 CRTSTS EQU  177406
0900 CHKSTS EQU  36335
0910 SAD1   EQU  35641
0920 CRTUNW EQU  36067
0930 CONBIN EQU  3572
0940 CRTBYT EQU  100176
0950 GETPAR EQU  14342
0960 GINTDS EQU  177401
0970 GINTEN EQU  177400
0980 KEYCOD EQU  177403
0990 KEYIDL EQU  102425
1000 BINFLG EQU  101176
1010 BINWRD EQU  101177
1020 KRPET1 EQU  100121
1030 KEYCNT EQU  100120
1040 PUINTG EQU  3176
1050 ! 
1060 !  WRITE STMT PARS
1070 WRPARS LDB  R14,=371
1080        PUMD R40,+R6
1090        JSB  =GET1$ 
1100 PUSHBP POMD R70,-R6
1110        PUBD R73,+R12
1120        PUBD R73,+R12
1130        RTN  
1140 ! 
1150 !  UP, RIGHT PARS
1160 PARSIT LDB  R14,=371
1170        PUMD R40,+R6
1180        JSB  =GET1N 
1190        JMP  PUSHBP
1200 HOMPRS LDB  R14,=371
1210        PUBD R14,+R12
1220        PUBD R43,+R12
1230        PUBD R43,+R12
1240        JSB  =SCAN  
1250        RTN  
1260 ! 
1270 !  CURSOR PARS
1280 CURPRS LDB  R14,=371
1290        PUMD R40,+R6
1300        LDB  R35,=3
1310        JSB  =GETPAR
1320        JMP  PUSHBP
1330 ! 
1340 !  READC. RUNTIM
1350        BYT  0
1360        BYT  56
1370 READC. JSB  =DECUR2
1380        JSB  =INCHR 
1390 !  DATA IS NOW IN R3
1400 !  NOW PREPARE CHARACTE
1410 !  FOR OUTPUT (LIKE CHR$
1420        JSB  =RTCUR.
1430        STB  R32,R36
1440        CLM  R56
1450        ICM  R56
1460        JSB  =RSMEM-
1470        PUMD R56,+R12
1480        PUMD R26,+R12
1490        STBD R36,R26
1500        JSB  =CURS  
1510        RTN  
1520 ! 
1530 !  WRITEC. RUNTIM
1540        BYT  241
1550 WRITC. JSB  =DECUR2
1560        POMD R74,-R12
1570        CLM  R32
1580        LDBD R32,R76
1590        CLM  R76
1600        TSM  R74
1610        JNZ  NOTNUL
1620        LDB  R32,=40
1630 !  CHANGE TO BLANK IF NUL
1640 NOTNUL JSB  =NO.CRS
1650        JSB  =OUTCHR
1660        RTN  
1670        BYT  241
1680 HOME.  JSB  =DECUR2
1690        JSB  =HMCURS
1700 EXIT   JSB  =CURS  
1710        RTN  
1720        BYT  241
1730 UPCURS JSB  X36,GETPRM
1740 LOOP1  DCM  R46
1750        JNC  EXIT  
1760        JSB  =UPCUR.
1770        JMP  LOOP1 
1780        BYT  241
1790 RIGHT  JSB  X36,GETPRM
1800 LOOP3  DCM  R46
1810        JNC  EXIT  
1820        JSB  =RTCUR.
1830        JMP  LOOP3 
1840 GETPRM JSB  =DECUR2
1850        JSB  =ONEB  
1860        CLB  R47
1870        RTN  
1880 ! 
1890 !  PAGE RUNTIM
1900        BYT  241
1910 PAGE.  JSB  =DECUR2
1920        JSB  =ONEI  
1930        ANM  R45,=3
1940        BYT  0
1950        BYT  0
1960        CMB  R45,=2
1970        JOD  ODDS  
1980        DRP  R34
1990        JZR  TWO   
2000        CLM  R#
2010 CRTBL+ LDB  R36,=2
2020        STBD R36,=CRTWRS
2030        STBD R36,=CRTSTS
2040        JSB  =CHKSTS
2050        JSB  =SAD1  
2060        JSB  =BYTCR!
2070        JSB  =CRTUNW
2080        RTN  
2090 TWO    LDM  R#,=0
2100        BYT  10
2110        JMP  CRTBL+
2120 ODDS   DRP  R34
2130        JCY  THREE 
2140        LDM  R#,=0
2150        BYT  4
2160        JMP  CRTBL+
2170 THREE  LDM  R#,=0
2180        BYT  14
2190        JMP  CRTBL+
2200 ! 
2210 !  XPOS. & YPOS
2220        BYT  0
2230        BYT  55
2240 XPOS.  LDMD R36,=CRTBYT
2250        BIN  
2260        ANM  R36,=76
2270        BYT  0
2280        JMP  XYPOS 
2290        BYT  0
2300        BYT  55
2310 YPOS.  LDMD R36,=CRTBYT
2320        BIN  
2330        LRM  R37              !   /2
2340        LRM  R37              !   /4
2350        LRM  R37              !   /8
2360        LRM  R37              !   /16
2370        LRM  R37              !   /32
2380 XYPOS  LRM  R37
2390        ANM  R36,=77
2400        BYT  0
2410        ICB  R36
2420        JSB  =CONBIN
2430        PUMD R40,+R12
2440        RTN  
2450 !  CURSOR RUNTIM
2460        BYT  241
2470 CURSOR JSB  =DECUR2
2480        JSB  =ONEB  
2490        LDB  R20,R46
2500        JSB  =TWOB  
2510 ! X=R26=R46; Y=R4
2520 ! ADDR=[(X-1)*2+(Y-1)*64
2530        DCM  R56
2540        ANM  R56,=77
2550        BYT  0
2560        DCM  R26
2570        LLM  R26              ! *2
2580        LLM  R26              ! *4
2590        LLM  R26              ! *8
2600        LLM  R26              ! *16
2610        LLM  R26              ! *32
2620        LLM  R26              ! *64
2630        ADM  R26,R56
2640        ADM  R26,R56
2650        ANM  R26,=377
2660        BYT  17
2670        STM  R26,R34
2680        JSB  =BYTCR!
2690        TSB  R20
2700        JEV  DONT  
2710        JSB  =CURS  
2720 DONT   RTN  
2730 !  KEYBOARD SERVIC
2740 !  (KEYSRV DOES A SAD
2750 KEYINT STBD R32,=GINTDS
2760        PUMD R32,+R6
2770        LDBD R32,=KEYCOD
2780        BIN  
2790        CMB  R32,=213
2800        JZR  RESETK
2810        CMB  R32,=216
2820        JNZ  NORSET
2830        STBD R32,=BINFLG
2840 RESETK LDB  R32,=236
2850        STBD R32,=KEYIDL
2860        POMD R32,-R6
2870        RTN  
2880 !  BACK TO KEYSR
2890 ! 
2900 NORSET LDBD R33,=BINFLG
2910        DRP  R32
2920        JOD  HAVE1 
2930        ICB  R33
2940        STBD R33,=BINFLG
2950        STBD R32,=BINWRD
2960 HAVE1  LDBD R#,=KRPET1
2970        STBD R#,=KEYCNT
2980        LDB  R#,=1
2990        STBD R#,=KEYCOD
3000        POMD R32,-R6
3010        SBM  R6,=4,0
3020        STBD R#,=GINTEN
3030        PAD  
3040        RTN  
3050 ! 
3060 !  SET UP KEY INTERCEP
3070        BYT  241
3080 SETKEY BIN  
3090        LDM  R44,=316,0,0,236
3100        ADM  R36,=KEYINT
3110        STM  R36,R45
3120        CLM  R36
3130        STMD R36,=BINFLG
3140 !  INITIALIZE FLA
3150        STMD R44,=KEYIDL
3160        RTN  
3170 ! 
3180 !  KEY1 RUNTIM
3190        BYT  0,55
3200 KEY1   JSB  X36,SETKEY
3210 !  SET UP KEY INTERCEP
3220 KEY1+  LDMD R36,=BINFLG
3230        TSB  R36
3240        JZR  KEY1+ 
3250 !  NOW KEY IS IN R3
3260        STB  R37,R30
3270        STB  R37,R36
3280        CLB  R37
3290        JSB  =PUINTG
3300 !  CONBIN + PUSH R1
3310 KILLIT LDB  R36,=236
3320        STBD R36,=KEYIDL
3330        RTN  
3340 ! 
3350 !  KEY2 RUNTIM
3360        BYT  0,55
3370 KEY2   JSB  X36,SETKEY
3380 !  SET UP KEY INTERCEP
3390 KEY2+  LDMD R36,=BINFLG
3400        TSB  R36
3410        JZR  KEY2+ 
3420 !  NOW KEY IS IN R3
3430        STB  R37,R30
3440        STB  R37,R36
3450        CLB  R37
3460        JSB  =PUINTG
3470 !  CONBIN + PUSH R1
3480        LDB  R32,R30
3490        JSB  =OUTCHR
3500        JMP  KILLIT
3510 ! 
3520 !  KEY3 RUNTIM
3530        BYT  0,55
3540 KEY3   STBD R36,=GINTDS
3550        LDMD R36,=BINFLG
3560 !  NOW KEY IS IN R3
3570 !  WE MUST CLEAR THE KE
3580        CLM  R30
3590        STMD R30,=BINFLG
3600        STBD R30,=GINTEN
3610        STB  R37,R30
3620        STB  R37,R36
3630        CLB  R37
3640        JSB  =PUINTG
3650 !  CONBIN + PUSH R1
3660        RTN  
3670 ! 
3680 !  ENDKEY ROUTIN
3690        BYT  241
3700 ENDKEY JMP  KILLIT
3710        FIN  
