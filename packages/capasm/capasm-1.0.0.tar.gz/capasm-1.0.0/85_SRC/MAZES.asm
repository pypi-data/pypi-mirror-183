0010        NAM  MAZE  
0020        DEF  RUNTIM
0030        DEF  TOKS  
0040        DEF  PARSES
0050        DEF  ERMSG 
0060        DEF  INIT  
0070 RUNTIM BYT  0,0
0080        DEF  MAZE. 
0090        DEF  REV.  
0100 PARSES BYT  0,0
0110        DEF  MAZE, 
0120        BYT  377,377
0130 TOKS   ASP  "MAZE"
0140        ASP  ""
0150        BYT  377
0160 ERMSG  BYT  200
0170        BYT  200,200,200,200
0180        BYT  200,200,200,200
0190        ASP  "MAZE TOO LARGE FOR MEMORY"
0200        ASP  "must be:             MAZE <num. value>,<num. value>"
0210        ASP  "ILLEGAL MAZE SIZE"
0220        BYT  377
0230 INIT   RTN  
0240 ! ************************
0250        BYT  0,56
0260 REV.   BIN  
0270        LDM  R44,=11D,0
0280        DEF  DATE  
0290        ADMD R46,=BINTAB
0300        PUMD R44,+R12
0310        RTN  
0320 DATE   ASC  "JAN 31,1981"
0330 ! ************************
0340 MAZE,  PUBD R43,+R6
0350        JSB  =NUMVA+
0360        JEN  OK    
0370 ERR    POBD R57,-R6
0380        JSB  =ERROR+
0390        BYT  365
0400 OK     JSB  =GETCMA
0410        JSB  =NUMVAL
0420        JEZ  ERR   
0430        POBD R57,-R6
0440        LDB  R55,=371
0450        PUMD R55,+R12
0460        RTN  
0470 ! ************************
0480        BYT  241
0490 MAZE.  POMD R50,-R12
0500        POMD R60,-R12
0510        PUMD R60,+R12
0520        PUMD R50,+R12
0530        PUMD R60,+R12
0540        PUMD R50,+R12
0550        LDMD R14,=BINTAB
0560        BIN  
0565        JSB  X14,ROM?  
0570        LDM  R36,R12
0580        ADM  R36,=100,0
0590        STMD R36,X14,W-BASE
0600        JSB  =TWOB  
0610        STM  R46,R66
0620        STM  R56,R76
0630        JSB  =INTMUL
0640        TSM  R56
0650        JNZ  LAVERR
0660        TSB  R55
0670        JNG  LAVERR
0680        CLM  R40
0690        LDMD R36,X14,W-BASE
0700        STM  R36,R44
0710        ADM  R44,R54
0720        STMD R44,X14,V-BASE
0730        LDM  R20,R54
0740        ICM  R20
0750        STMD R20,X14,H*V+1 
0760        ADM  R54,R44
0770        LDMD R64,=LAVAIL
0780        CLM  R66
0790        CMM  R54,R64
0800        JNC  SIZ-OK
0810 LAVERR JSB  =ERROR+
0820        BYT  366
0830 SIZ-OK LDMD R56,X14,H*V+1 
0840        DCM  R56
0850        LLM  R56
0860        CLB  R23
0870        LDMD R36,X14,W-BASE
0880        JSB  =ZROMEM
0890        JSB  =TWOB  
0900        CMM  R56,=4,0
0910        JCY  H-OK  
0920 SIZERR JSB  =ERROR+
0930        BYT  364
0940 H-OK   CMM  R46,=4,0
0950        JNC  SIZERR
0960        STMD R46,X14,ROWSIZ
0970        CLM  R70
0980        DCM  R46
0990        STB  R46,R73
1000        STMD R46,X14,V     
1010        DCM  R56
1020        STB  R56,R72
1030        STMD R56,X14,H     
1040        ICM  R56
1050        STM  R56,R36
1060        JSB  X14,RANDOM
1070 ! 
1080 !  R20-1 = (R,S) INDE
1090 !  R70   = 
1100 !  R71   = 
1110 !  R72   = 
1120 !  R73   = 
1130 !  R74   = 
1140 !  R75   = 
1150 !  R76-7 = 
1160 ! 
1170        STMD R46,X14,X0    
1180        DCM  R46
1190        LDB  R74,R46
1200        ICM  R76
1210        JSB  X14,SETIND
1220        STBD R76,R20
1230        ICM  R76
1240        JMP  LN1490
1250 ! ------------------------
1260 LN1400 CMB  R74,R72
1270        JNC  LN1470
1280        CMB  R75,R73
1290        JNC  LN1440
1300        CLB  R74
1310        CLB  R75
1320        JMP  LN1480
1330 ! -----------------------
1340 LN1440 CLB  R74
1350        ICB  R75
1360        JMP  LN1480
1370 ! -----------------------
1380 LN1470 ICB  R74
1390 LN1480 JSB  X14,SETIND
1400        LDBD R22,R20
1410        JZR  LN1400
1420 LN1490 TSB  R74
1430        JZR  JMP-5 
1440        LDM  R22,R20
1450        SBM  R22,R26
1460        LDBD R22,R22
1470        JNZ  JMP-5 
1480        TSB  R75
1490        JZR  LN1660
1500        LDM  R22,R20
1510        DCM  R22
1520        LDBD R22,R22
1530        JNZ  LN1660
1540        CMB  R74,R72
1550        JCY  LN1570
1560        LDM  R22,R20
1570        ADM  R22,R26
1580        LDBD R22,R22
1590        JNZ  LN1570
1600        LDM  R36,=3,0
1610        JSB  X14,RANDOM
1620        DCB  R46
1630        JZR  JZ-33 
1640        DCB  R46
1650        JZR  JZ-2  
1660        CLB  R46
1670        JMP  J32370
1680 ! -----------------------
1690 LN1570 CMB  R75,R73
1700        JNC  LN1610
1710        TSB  R71
1720        JNZ  LN1640
1730        ICB  R70
1740        JMP  LN1620
1750 ! -----------------------
1760 LN1610 LDM  R22,R20
1770        ICM  R22
1780        LDBD R22,R22
1790        JNZ  LN1640
1800 LN1620 LDM  R36,=3,0
1810 COM1   JSB  X14,RANDOM
1820        DCB  R46
1830        JZR  JZ-33 
1840        DCB  R46
1850 JZ-2   JZR  JZ1JMP
1860        JMP  J24703
1870 JMP-5  JMP  LN1850
1880 ! ----------------------
1890 LN1640 LDM  R36,=2,0
1900        JMP  COM1  
1910 ! ----------------------
1920 LN1660 CMB  R74,R72
1930        JCY  LN1770
1940        LDM  R22,R20
1950        ADM  R22,R26
1960        LDBD R22,R22
1970        JNZ  LN1770
1980        CMB  R75,R73
1990        JNC  LN1720
2000        TSB  R71
2010        JNZ  LN1750
2020        ICB  R70
2030        JMP  LN1730
2040 ! -----------------------
2050 LN1720 LDM  R22,R20
2060        ICM  R22
2070        LDBD R22,R22
2080        JNZ  LN1750
2090 LN1730 LDM  R36,=3,0
2100 COM2   JSB  X14,RANDOM
2110        DCB  R46
2120 JZ-33  JZR  JZ-3  
2130        DCB  R46
2140 J32370 JZR  J22370
2150        JMP  J24703
2160 ! -----------------------
2170 LN1750 LDM  R36,=2,0
2180        JMP  COM2  
2190 ! -----------------------
2200 LN1770 CMB  R75,R73
2210        JNC  LN1810
2220        TSB  R71
2230        JNZ  JMP-3 
2240        ICB  R70
2250        JMP  LN1820
2260 JZ1JMP JMP  JZ23-1
2270 ! -----------------------
2280 LN1810 LDM  R22,R20
2290        ICM  R22
2300        LDBD R22,R22
2310        JNZ  JMP-3 
2320 LN1820 LDM  R36,=2,0
2330        JSB  X14,RANDOM
2340        DCB  R46
2350 JZ-3   JZR  JMP-3 
2360 J24703 JMP  J24702
2370 ! ----------------------
2380 LN1850 TSB  R75
2390        JZR  LN2060
2400        LDM  R22,R20
2410        DCM  R22
2420        LDBD R22,R22
2430        JNZ  LN2060
2440        CMB  R74,R72
2450        JCY  LN1980
2460        LDM  R22,R20
2470        ADM  R22,R26
2480        LDBD R22,R22
2490        JNZ  LN1980
2500        CMB  R75,R73
2510        JNC  LN1930
2520        TSB  R71
2530        JNZ  LN1960
2540        ICB  R70
2550        JMP  LN1940
2560 ! -----------------------
2570 LN1930 LDM  R22,R20
2580        ICM  R22
2590        LDBD R22,R22
2600        JNZ  LN1960
2610 LN1940 LDM  R36,=3,0
2620 COM3   JSB  X14,RANDOM
2630        DCB  R46
2640 JZ23-1 JZR  JZ2300
2650        DCB  R46
2660 J22370 JZR  JZ2370
2670        JMP  J24702
2680 ! -----------------------
2690 LN1960 LDM  R36,=2,0
2700        JMP  COM3  
2710 ! -----------------------
2720 LN1980 CMB  R75,R73
2730        JNC  LN2020
2740        TSB  R71
2750        JNZ  JN2300
2760        ICB  R70
2770        JMP  LN2030
2780 JMP-3  JMP  LN2230
2790 ! -----------------------
2800 LN2020 LDM  R22,R20
2810        ICM  R22
2820        LDBD R22,R22
2830 JN2300 JNZ  LN2300
2840 LN2030 LDM  R36,=2,0
2850        JSB  X14,RANDOM
2860        DCB  R46
2870 JZ2300 JZR  LN2300
2880 J24702 JMP  J24701
2890 LN2060 CMB  R74,R72
2900        JCY  LN2160
2910        LDM  R22,R20
2920        ADM  R22,R26
2930        LDBD R22,R22
2940        JNZ  LN2160
2950        CMB  R75,R73
2960        JNC  LN2120
2970        TSB  R71
2980        JNZ  LN2370
2990        ICB  R70
3000        JMP  LN2130
3010 ! -----------------------
3020 LN2120 LDM  R22,R20
3030        ICM  R22
3040        LDBD R22,R22
3050        JNZ  LN2370
3060 LN2130 LDM  R36,=2,0
3070        JSB  X14,RANDOM
3080        DCB  R46
3090 JZ2370 JZR  LN2370
3100        JMP  J24701
3110 ! -----------------------
3120 LN2160 CMB  R75,R73
3130        JNC  LN2200
3140        TSB  R71
3150        JNZ  JM1401
3160        ICB  R70
3170 J24701 JMP  LN2470
3180 ! ----------------------
3190 LN2200 LDM  R22,R20
3200        ICM  R22
3210        LDBD R22,R22
3220 JM1401 JNZ  EK    
3230        JMP  LN2470
3240 ! ----------------------
3250 LN2230 DCB  R74
3260        JSB  X14,SETIND
3270        LDB  R24,=2
3280 MOV1   STBD R24,R20
3290        STBD R24,R22
3300        ICM  R76
3310        LDMD R22,X14,H*V+1 
3320        CMM  R76,R22
3330        JCY  JZ2670
3340        CLB  R70
3350        JMP  JM1490
3360 ! ----------------------
3370 LN2300 DCB  R75
3380        JSB  X14,SETIND
3390        LDB  R24,=1
3400        JMP  MOV1  
3410 ! ----------------------
3420 LN2370 JSB  X14,SETIND
3430        PUMD R22,+R6
3440        ICB  R74
3450        JSB  X14,SETIND
3460        POMD R22,-R6
3470        LDB  R24,=3
3480        STBD R24,R20
3490        LDBD R30,R22
3500        JNZ  LN2430
3510        DCB  R24
3520 LN2430 STBD R24,R22
3530        JSB  X14,SETIND
3540        ICM  R76
3550        LDMD R22,X14,H*V+1 
3560        CMM  R76,R22
3570 JZ2670 JCY  LN2670
3580        CLB  R70
3590        LDM  R24,=LN1850
3600        JMP  COMJMP
3610 ! -----------------------
3620 EK     JMP  JM1400
3630 LN2470 TSB  R70
3640        JNZ  LN2570
3650        JSB  X14,SETIND
3660        LDB  R24,=3
3670        ICM  R20
3680        STBD R24,R20
3690        DCM  R20
3700        LDBD R30,R22
3710        JNZ  LN2530
3720        LDB  R24,=1
3730 LN2530 STBD R24,R22
3740        ICB  R75
3750        ICM  R20
3760        ICM  R76
3770        LDMD R22,X14,H*V+1 
3780        CMM  R76,R22
3790        JCY  LN2670
3800 JM1490 LDM  R24,=LN1490
3810        JMP  COMJMP
3820 ! ----------------------
3830 LN2570 ICB  R71
3840        JSB  X14,SETIND
3850        LDBD R24,R22
3860        JZR  LN2620
3870        LDB  R24,=3
3880        STBD R24,R22
3890        CLB  R70
3900 JM1400 LDM  R24,=LN1400
3910        JMP  COMJMP
3920 ! ---------------------
3930 LN2620 LDB  R24,=1
3940        JSB  X14,SETIND
3950        STBD R24,R22
3960        CLB  R70
3970        CLB  R74
3980        CLB  R75
3990        LDM  R24,=LN1480
4000 COMJMP ADM  R24,R14
4010        DCM  R24
4020        STM  R24,R4
4030 ! ----------------------
4040 LN2670 CLM  R40
4050        PUMD R40,+R12
4060        PUMD R40,+R12
4070        PUMD R40,+R12
4080        JSB  X14,MOVE  
4090        LDMD R14,=BINTAB
4100        LDMD R36,X14,X0    
4110        DCM  R36
4120        JSB  =CONBIN
4130        PUMD R40,+R12
4140        JSB  X14,DRAW  
4150        CLM  R40
4160        PUMD R40,+R12
4170        PUMD R40,+R12
4180        LDMD R14,=BINTAB
4190        LDMD R36,X14,X0    
4200        JSB  =CONBIN
4210        PUMD R40,+R12
4220        JSB  X14,MOVE  
4230        LDMD R14,=BINTAB
4240        LDMD R36,X14,H     
4250        ICM  R36
4260        JSB  =CONBIN
4270        PUMD R40,+R12
4280        JSB  X14,DRAW  
4290        LDMD R14,=BINTAB
4300        CLM  R26
4310        STMD R26,X14,J     
4320 FORJ   LDMD R36,X14,J     
4330        JSB  =CONBIN
4340        PUMD R40,+R12
4350        CLM  R40
4360        PUMD R40,+R12
4370        JSB  X14,MOVE  
4380        LDMD R14,=BINTAB
4390        LDMD R36,X14,J     
4400        ICM  R36
4410        JSB  =CONBIN
4420        PUMD R40,+R12
4430        CLM  R40
4440        PUMD R40,+R12
4450        JSB  X14,DRAW  
4460        LDMD R14,=BINTAB
4470        CLM  R36
4480        STMD R36,X14,I     
4490 FORI   LDBD R74,X14,I     
4500        LDBD R75,X14,J     
4510        JSB  X14,SETIND
4520        LDBD R22,R22
4530        CMB  R22,=2
4540        JCY  TRY   
4550        PUBD R22,+R6
4560        LDMD R36,X14,J     
4570        JSB  =CONBIN
4580        PUMD R40,+R12
4590        LDMD R36,X14,I     
4600        BIN  
4610        ICM  R36
4620        JSB  =CONBIN
4630        PUMD R40,+R12
4640        JSB  X14,MOVE  
4650        LDMD R14,=BINTAB
4660        LDMD R36,X14,J     
4670        ICM  R36
4680        JSB  =CONBIN
4690        PUMD R40,+R12
4700        LDMD R36,X14,I     
4710        BIN  
4720        ICM  R36
4730        JSB  =CONBIN
4740        PUMD R40,+R12
4750        JSB  X14,DRAW  
4760        LDMD R14,=BINTAB
4770        POBD R22,-R6
4780 TRY    CMB  R22,=2
4790        JZR  DO-IT 
4800        TSB  R22
4810        JNZ  NEXTI 
4820 DO-IT  LDMD R36,X14,J     
4830        ICM  R36
4840        JSB  =CONBIN
4850        PUMD R40,+R12
4860        PUMD R40,+R12
4870        LDMD R36,X14,I     
4880        JSB  =CONBIN
4890        PUMD R40,+R12
4900        JSB  X14,MOVE  
4910        LDMD R14,=BINTAB
4920        LDMD R36,X14,I     
4930        ICM  R36
4940        JSB  =CONBIN
4950        PUMD R40,+R12
4960        JSB  X14,DRAW  
4970        LDMD R14,=BINTAB
4980 NEXTI  LDMD R36,X14,I     
4990        ICM  R36
5000        STMD R36,X14,I     
5010        LDMD R26,X14,H     
5020        CMM  R26,R36
5030        JNC  DONE-I
5040        LDM  R36,=FORI  
5050        ADM  R36,R14
5060        DCM  R36
5070        STM  R36,R4
5080 DONE-I LDMD R36,X14,J     
5090        ICM  R36
5100        STMD R36,X14,J     
5110        LDMD R26,X14,V     
5120        CMM  R26,R36
5130        JNC  DONE  
5140        LDM  R26,=FORJ  
5150        ADM  R26,R14
5160        DCM  R26
5170        STM  R26,R4
5180 DONE   RTN  
5190 ! ***********************
5200 RANDOM PUMD R70,+R6
5210        JSB  =CONBIN
5220        PUMD R40,+R12
5230        BCD  
5240        JSB  =RND10 
5250        JSB  =MPYROI
5260        JSB  =IP5   
5270        JSB  =ONEB  
5280        ICM  R46
5290        POMD R70,-R6
5300 ! ***********************
5310 SETIND LDMD R66,X14,ROWSIZ
5320        PUMD R76,+R6
5330        CLM  R76
5340        LDB  R76,R74
5350        JSB  =INTMUL
5360        POMD R#,-R6
5370        CLM  R26
5380        LDB  R26,R75
5390        ADM  R26,R54
5400        LDMD R22,X14,V-BASE
5410        ADM  R22,R26
5420        LDMD R20,X14,W-BASE
5430        ADM  R20,R26
5440        LDMD R26,X14,ROWSIZ
5450        RTN  
5460 ! ************************
5461 MOVE   LDBD R50,X14,P/PFLG
5462        JZR  SYSMOV
5463        JSB  =ROMJSB
5464        DEF  RMOVE.
5465        BYT  360
5466        RTN  
5467 SYSMOV JSB  =MOVE. 
5468        RTN  
5469 ! ************************
5470 DRAW   LDBD R50,X14,P/PFLG
5471        JZR  SYSDRW
5472        JSB  =ROMJSB
5473        DEF  RDRAW.
5474        BYT  360
5475        RTN  
5476 SYSDRW JSB  =DRAW. 
5477        RTN  
5480 ! ***********************
5490 ROM?   LDM  R20,=ROMTAB
5492        CLM  R26
5494 NXTROM POMD R24,+R20
5496        CMB  R24,=377
5498        JZR  SYSTEM
5500        CMB  R24,=360
5502        JNZ  NXTROM
5504        ICM  R26
5506 SYSTEM STMD R26,X14,P/PFLG
5508        RTN  
5550 ! ***********************
5560 W-BASE BSZ  2
5570 V-BASE BSZ  4
5580 ROWSIZ BSZ  2
5590 I      BSZ  2
5600 J      BSZ  2
5610 X0     BSZ  2
5620 H      BSZ  2
5630 V      BSZ  2
5640 P/PFLG BSZ  2
5650 H*V+1  BSZ  2
5660 ! ***********************
5670 SET240 DAD  11243
5680 LAVAIL DAD  100010
5690 ASIZE  EQU  20000
5700 ZROMEM DAD  44066
5710 BINTAB DAD  101233
5715 ROMTAB DAD  101235
5720 INTMUL DAD  53076
5730 KYIDLE DAD  102425
5740 TWOB   DAD  56176
5750 RND10  DAD  53144
5760 CONBIN DAD  3572
5770 MPYROI DAD  52722
5780 ONEB   DAD  56113
5790 MOVE.  DAD  31703
5800 DRAW.  DAD  33015
5802 RMOVE. DAD  64400
5804 RDRAW. DAD  64435
5806 ROMJSB DAD  4776
5810 NUMVA+ DAD  12407
5820 NUMVAL DAD  12412
5830 GETCMA DAD  13414
5840 IP5    DAD  54174
5850 ERROR+ DAD  6611
5860        FIN  
