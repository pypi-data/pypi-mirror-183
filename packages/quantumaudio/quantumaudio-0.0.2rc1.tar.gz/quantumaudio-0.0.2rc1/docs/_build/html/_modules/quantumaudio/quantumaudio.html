<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>quantumaudio.quantumaudio &mdash; quantumaudio 0.0.2 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> quantumaudio
          </a>
              <div class="version">
                0.0.2rc1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">quantumaudio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">quantumaudio</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">quantumaudio.quantumaudio</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for quantumaudio.quantumaudio</h1><div class="highlight"><pre>
<span></span><span class="c1"># ==============================================================================</span>
<span class="c1">#                                  quantumaudio</span>
<span class="c1">#</span>
<span class="c1"># A Python class implementation for Quantum Representations of Audio in Qiskit</span>
<span class="c1">#</span>
<span class="c1"># Paulo Vitor Itabora√≠ (2022-2023)</span>
<span class="c1">#</span>
<span class="c1"># Itaborala @ QuTune Project, ICCMR Quantum - University of Plymotuh</span>
<span class="c1">#</span>
<span class="c1"># https://github.com/iccmr-quantum/quantumaudio (repo)</span>
<span class="c1"># https://iccmr-quantum.github.io/ (qutune website)</span>
<span class="c1"># ==============================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.typing</span> <span class="k">as</span> <span class="nn">npt</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">QuantumRegister</span><span class="p">,</span> <span class="n">ClassicalRegister</span><span class="p">,</span> <span class="n">execute</span>
<span class="kn">from</span> <span class="nn">qiskit_aer</span> <span class="kn">import</span> <span class="n">AerProvider</span>
<span class="kn">from</span> <span class="nn">qiskit.result</span> <span class="kn">import</span> <span class="n">Counts</span>
<span class="kn">from</span> <span class="nn">qiskit.tools</span> <span class="kn">import</span> <span class="n">job_monitor</span>
<span class="kn">from</span> <span class="nn">qiskit.compiler</span> <span class="kn">import</span> <span class="n">transpile</span>
<span class="kn">from</span> <span class="nn">qiskit.visualization</span> <span class="kn">import</span> <span class="n">plot_histogram</span>
<span class="kn">from</span> <span class="nn">bitstring</span> <span class="kn">import</span> <span class="n">BitArray</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Audio</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span>



<span class="c1"># ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span>
<span class="c1"># =================================== QPAM =====================================</span>
<span class="c1"># ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span>

<div class="viewcode-block" id="QPAM"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QPAM">[docs]</a><span class="k">class</span> <span class="nc">QPAM</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="mf">1.</span>
        
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    
<div class="viewcode-block" id="QPAM.convert"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QPAM.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_audio</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Converts the digital audio into an array of probability amplitudes.</span>

<span class="sd">        The audio signal is normalized. The normalized samples can then be</span>
<span class="sd">        interpreted as probability amplitudes. In other words, by squaring every</span>
<span class="sd">        sample, their total sum is now 1.</span>

<span class="sd">        Args:</span>
<span class="sd">            original_audio: Numpy Array containing audio information.  </span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">            A Numpy Array containing normalized probability amplitudes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prepared</span> <span class="o">=</span> <span class="p">(</span><span class="n">original_audio</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">prepared</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">prepared</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span></div>
    
<div class="viewcode-block" id="QPAM.prepare"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QPAM.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audio_amplitudes</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">regsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">regnames</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prepares a QPAM quantum circuit.</span>

<span class="sd">        Creates a qiskit QuantumCircuit that prepares a Quantum Audio state </span>
<span class="sd">        using QPAM (Quantum Probability Amplitude Modulation) representation.</span>
<span class="sd">        The quantum circuits used for audio representations typically contain </span>
<span class="sd">        two qubit registers, namely, &#39;treg&#39; (which encodes time/index information) </span>
<span class="sd">        and &#39;areg&#39; (which encodes amplitude information).</span>

<span class="sd">        Note: In QPAM, the &#39;areg&#39; (amplitude) register is NOT used as the amplitude </span>
<span class="sd">        information is encoded in the probability amplitudes of the &#39;treg&#39; (time) </span>
<span class="sd">        register.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            audio_amplitudes: Array with propbability amplitudes</span>
<span class="sd">            regsize: The size of both qubit registers in a tuple (treg_size, areg_size). </span>
<span class="sd">                &#39;treg_size&#39; qubits for &#39;treg&#39;; &#39;areg_size&#39; qubits for &#39;areg&#39;. </span>
<span class="sd">                For QPAM, &#39;areg_size&#39; is ALWAYS 0</span>
<span class="sd">            regnames: Label names for &#39;treg&#39; and &#39;areg&#39;, passed as a tuple. For </span>
<span class="sd">                visualization purposes only.</span>
<span class="sd">            print_state: Toggles a simple print of the prepared quantum state to the</span>
<span class="sd">                console, for visualization purposes only.</span>

<span class="sd">        Returns: </span>
<span class="sd">            A qiskit QuantumCircuit with specific QPAM preparation instructions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># QPAM only needs the time register&#39;s size .</span>
        <span class="c1"># It doesn&#39;t have an amplitude register, so areg_size is necessarily 0</span>
        <span class="n">treg_size</span><span class="o">=</span><span class="n">regsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Creates a Quantum Circuit</span>
        <span class="n">treg</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="n">treg_size</span><span class="p">,</span> <span class="n">regnames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">qpam</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">treg</span><span class="p">)</span>
        
        <span class="c1"># Value Setting Operation</span>
        <span class="n">qpam</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">audio_amplitudes</span><span class="p">),</span> <span class="n">treg</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">print_state</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">amps</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">audio_amplitudes</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">amps</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">audio_amplitudes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">qpam</span></div>
    
<div class="viewcode-block" id="QPAM.measure"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QPAM.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="p">:</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">,</span> <span class="n">treg_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Appends Measurements to a QPAM audio circuit</span>
<span class="sd">        </span>
<span class="sd">        From a quantum circuit with a register containing a QPAM </span>
<span class="sd">        representation of quantum audio, creates a classical register with </span>
<span class="sd">        compatible size and adds isntructions for measuring the QPAM register.</span>

<span class="sd">        Args:</span>
<span class="sd">            qc: A qiskit quantum circuit containing at least 1 quantum register.</span>
<span class="sd">            treg_pos: Index of the QPAM (&#39;treg&#39;) register in the circuit. </span>
<span class="sd">                Default is 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Accesses the QuantumRegister containing the time information</span>
        <span class="n">treg</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">qregs</span><span class="p">[</span><span class="n">treg_pos</span><span class="p">]</span>
        
        <span class="n">ctreg</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="n">treg</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;ct&#39;</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">ctreg</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span> <span class="n">ctreg</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="QPAM.reconstruct"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QPAM.reconstruct">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">treg_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">shots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Builds a digital Audio from qiskit histogram data.</span>

<span class="sd">        Considering the QPAM encoding scheme, it uses the histogram data stored </span>
<span class="sd">        in a Counts object (qiskit.result.Counts) to reconstruct an audio</span>
<span class="sd">        signal. It renormalizes the histogram counts and remaps the signal back </span>
<span class="sd">        to the [-1 to 1] range.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            treg_size: Size of the &#39;treg&#39; (time) register.</span>
<span class="sd">            counts: Histogram from a qiskit job result (result.get_counts())</span>
<span class="sd">            shots: Amount of identical experiments ran by the qiskit job.</span>
<span class="sd">            g: Gain factor. This is a renormalization factor.</span>
<span class="sd">                (When bypassing audio signals through quantum circuits, this</span>
<span class="sd">                factor is usually proportional to the origal audio&#39;s norm).</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Digital Audio as a Numpy Array. The signal is in float format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">g</span>
        
        <span class="c1"># Builds a zeroed ndarray</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">treg_size</span><span class="p">)</span>
        
        <span class="c1"># Assigns the respective probabilities to the array</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">])</span>
        <span class="n">da</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Renormalization, rescaling, and shifting</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">da</span><span class="o">/</span><span class="n">shots</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span></div></div>


<span class="c1"># ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span>
<span class="c1"># =================================== SQPAM ====================================</span>
<span class="c1"># ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span>

<div class="viewcode-block" id="SQPAM"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.SQPAM">[docs]</a><span class="k">class</span> <span class="nc">SQPAM</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    
<div class="viewcode-block" id="SQPAM.treg_index_X"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.SQPAM.treg_index_X">[docs]</a>    <span class="k">def</span> <span class="nf">treg_index_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qa</span><span class="p">:</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">treg</span><span class="p">:</span> <span class="s1">&#39;QuantumRegister&#39;</span><span class="p">,</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Auxilary function for matching control conditions with time indexes.</span>
<span class="sd">        </span>
<span class="sd">        Applies X gates on qubits of the time register whenever the respective </span>
<span class="sd">        bit of the current time index (in binary representation) is 0. As a </span>
<span class="sd">        result, the qubit will be flipped to \|1&gt; and succesfully trigger </span>
<span class="sd">        necessary control conditions of the circuit for this time index.</span>

<span class="sd">        Args:</span>
<span class="sd">            qa: The quantum circuit to be maniputated</span>
<span class="sd">            t: Time index that will be converted to binary form for comparison.</span>
<span class="sd">            treg: Quantum register of the time indexes.</span>
<span class="sd">            print_state: Toggles a simple print of the prepared quantum state to the</span>
<span class="sd">                console, for visualization purposes only. To be used together </span>
<span class="sd">                with all other SQPAM methods with a &#39;print_state&#39; kwarg.</span>

<span class="sd">        Examples:</span>
<span class="sd">            treg_index_X(qa, 6, treg)</span>
<span class="sd">            (a time register &#39;treg&#39; with, say, 5 qubits in &#39;qa&#39; at instant 6)</span>

<span class="sd">            &#39;t&#39; = 6 == &#39;00110&#39;. *treg_index_X()* applies X gates to qubits 0, 3 and 4</span>
<span class="sd">                (right to left) of register &#39;treg&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t_bitstring</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treg_qubit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">treg</span><span class="p">):</span>
            <span class="n">t_bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">t_bitstring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_bit</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t_bit</span><span class="p">:</span>
                <span class="n">qa</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">treg_qubit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_state</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">t_bitstring</span><span class="p">):</span>    
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="SQPAM.mc_Ry_2theta_t"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.SQPAM.mc_Ry_2theta_t">[docs]</a>    <span class="k">def</span> <span class="nf">mc_Ry_2theta_t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qa</span><span class="p">:</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">treg</span><span class="p">:</span> <span class="s1">&#39;QuantumRegister&#39;</span><span class="p">,</span> <span class="n">areg</span><span class="p">:</span> <span class="s1">&#39;QuantumRegister&#39;</span><span class="p">,</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; SQPAM Value-Setting operation.</span>

<span class="sd">        Applies a controlled Ry(2*theta) gate to the amplitude register, </span>
<span class="sd">        controlled by the time register at the respective time index</span>
<span class="sd">        state. In other words. At index &#39;t&#39;, it rotates the aplitude qubit</span>
<span class="sd">        by the angle mapped from the audio sample at the same index. </span>
<span class="sd">        In quantum computing terms, this translates to a multi-controlled</span>
<span class="sd">        rotation gate.</span>

<span class="sd">        Args:</span>
<span class="sd">            qa: The quantum circuit to be manipulated.</span>
<span class="sd">            t: Time index that will be encoded.</span>
<span class="sd">            a: Angle of rotation.</span>
<span class="sd">            treg: Time register, &#39;treg&#39;.</span>
<span class="sd">            areg: Amplitude Register, &#39;areg&#39;.</span>
<span class="sd">            print_state: Toggles a simple print of the prepared quantum state to the</span>
<span class="sd">                console, for visualization purposes only. To be used together </span>
<span class="sd">                with all other SQPAM methods with a &#39;print_state&#39; kwarg.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Applies the necessary X gates at index t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treg_index_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">treg</span><span class="p">)</span>

        <span class="c1"># Creates an auxiliary circuit for the respective multi-controlled gates</span>
        <span class="n">mc_ry</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">()</span>
        <span class="n">mc_ry</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">areg</span><span class="p">)</span>
        <span class="n">mc_ry</span><span class="o">.</span><span class="n">ry</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mc_ry</span> <span class="o">=</span> <span class="n">mc_ry</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">treg</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="c1"># Appends the circuit to qa</span>
        <span class="n">qa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mc_ry</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">treg</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">areg</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>

        <span class="c1"># Prints the state</span>
        <span class="k">if</span> <span class="n">print_state</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[cos(</span><span class="si">{</span><span class="n">a</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)|0&gt; + sin(</span><span class="si">{</span><span class="n">a</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)|1&gt;]&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>       

        <span class="c1"># Applies the X gates again, &#39;resetting&#39; the time register</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treg_index_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">treg</span><span class="p">,</span> <span class="n">print_state</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="SQPAM.convert"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.SQPAM.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_audio</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Converts digital audio into an array of probability amplitudes.</span>

<span class="sd">        The audio signal is mapped to an array of angles. The angles can then </span>
<span class="sd">        be interpreted as real-valued parameters for a trigonometric </span>
<span class="sd">        representation subspace of a qubit. In other words, the angles are used </span>
<span class="sd">        to rotate a qubit - originally in the \|0&gt; state - to the following </span>
<span class="sd">        state: ( cos(angle)\|0&gt; + sin(angle)\|1&gt; ). Notice that this preserves </span>
<span class="sd">        probabilities, as cos^2 + sin^2 = 1.</span>

<span class="sd">        Note: By convention, we are using the *np.arcsin* function to calculate </span>
<span class="sd">        the angles. This means that the *SQPAM.reconstruct()* method will use </span>
<span class="sd">        the even (sine) bins of the histogram to retrieve the signal.</span>

<span class="sd">        Args:</span>
<span class="sd">            original_audio: Numpy Array containing audio information.  </span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">            A Numpy Array containing angles between 0 and pi/2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">original_audio</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="SQPAM.prepare"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.SQPAM.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angles</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">regsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">regnames</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prepares an SQPAM quantum circuit.</span>

<span class="sd">        Creates a qiskit QuantumCircuit that prepares a Quantum Audio state </span>
<span class="sd">        using SQPAM (Single-Qubit Probability Amplitude Modulation).</span>
<span class="sd">        The quantum circuits used for audio representations typically contain </span>
<span class="sd">        two qubit registers, namely, &#39;treg&#39; (which encodes time/index information) </span>
<span class="sd">        and &#39;areg&#39; (which encodes amplitude information).</span>

<span class="sd">        Note: In SQPAM (as hinted by its name), the &#39;areg&#39; (amplitude) register </span>
<span class="sd">        contains a single qubit. The audio samples are mapped into angles that</span>
<span class="sd">        parametrize single qubit rotations of &#39;areg&#39; - which are then correlated </span>
<span class="sd">        to index states of the &#39;treg&#39; register. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            angles: Array with propbability amplitudes</span>
<span class="sd">            regsize: The size of both qubit registers in a tuple (treg_size, areg_size). </span>
<span class="sd">                &#39;treg_size&#39; qubits for &#39;treg&#39;; &#39;areg_size&#39; qubits for &#39;areg&#39;. </span>
<span class="sd">                For SQPAM, &#39;areg_size&#39; is ALWAYS 1</span>
<span class="sd">            regnames: Label names for &#39;treg&#39; and &#39;areg&#39;, passed as a tuple. For </span>
<span class="sd">                visualization purposes only.</span>
<span class="sd">            print_state: Toggles a simple print of the prepared quantum state to the</span>
<span class="sd">                console, for visualization purposes only.</span>

<span class="sd">        Returns: </span>
<span class="sd">            A qiskit quantum circuit containing specific SQPAM preparation</span>
<span class="sd">            instructions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># SQPAM has a single-qubit amplitude register,</span>
        <span class="c1"># so &#39;areg_size&#39; is necessarily 1</span>
        <span class="n">treg_size</span> <span class="o">=</span> <span class="n">regsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Time register</span>
        <span class="n">treg</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="n">treg_size</span><span class="p">,</span> <span class="n">regnames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Amplitude register</span>
        <span class="n">areg</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">regnames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Init quantum circuit</span>
        <span class="n">sq_pam</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">()</span>
        <span class="n">sq_pam</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">areg</span><span class="p">)</span>
        <span class="n">sq_pam</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">treg</span><span class="p">)</span>
        
        <span class="c1"># Hadamard Gate in the Time Register</span>
        <span class="n">sq_pam</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">treg</span><span class="p">)</span> 
        
        <span class="c1"># Value setting operations</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">theta</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>        
            <span class="bp">self</span><span class="o">.</span><span class="n">mc_Ry_2theta_t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sq_pam</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">treg</span><span class="p">,</span> <span class="n">areg</span><span class="p">,</span> <span class="n">print_state</span><span class="p">)</span>
            <span class="k">if</span>  <span class="n">print_state</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_state</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>  
        <span class="k">return</span> <span class="n">sq_pam</span></div>
    
<div class="viewcode-block" id="SQPAM.measure"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.SQPAM.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="p">:</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">,</span> <span class="n">treg_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">areg_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Appends Measurements to an SQPAM audio circuit</span>
<span class="sd">        </span>
<span class="sd">        From a quantum circuit with registers containing an SQPAM </span>
<span class="sd">        representation of quantum audio, creates two classical registers with </span>
<span class="sd">        compatible sizes and adds instructions for measuring them.</span>

<span class="sd">        Args:</span>
<span class="sd">            qc: A quantum circuit containing at least 2 quantum registers.</span>
<span class="sd">            treg_pos: Index of the SQPAM (&#39;treg&#39;) register in the circuit. </span>
<span class="sd">                Default is 1</span>
<span class="sd">            areg_pos: Index of the SQPAM (&#39;areg&#39;) register in the circuit. </span>
<span class="sd">                Default is 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Creates classical registers for measurement</span>
        <span class="n">treg</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">qregs</span><span class="p">[</span><span class="n">treg_pos</span><span class="p">]</span>
        <span class="n">areg</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">qregs</span><span class="p">[</span><span class="n">areg_pos</span><span class="p">]</span>
        
        <span class="n">ctreg</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="n">treg</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;ct&#39;</span><span class="p">)</span>
        <span class="n">careg</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="n">areg</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;ca&#39;</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">careg</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">ctreg</span><span class="p">)</span>

        <span class="c1"># Measures the respective quantum registers</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span> <span class="n">ctreg</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">areg</span><span class="p">,</span> <span class="n">careg</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="SQPAM.reconstruct"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.SQPAM.reconstruct">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">treg_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="n">shots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inverted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">both</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Builds a digital Audio from qiskit histogram data.</span>

<span class="sd">        Considering the SQPAM encoding scheme, it uses the histogram data stored </span>
<span class="sd">        in a Counts object (qiskit.result.Counts) to reconstruct an audio</span>
<span class="sd">        signal. It separates the even bins (sine coefficients) from the odd </span>
<span class="sd">        bins (cosine coefficients) of the histogram. Since the *SQPAM.convert()*</span>
<span class="sd">        method used the *np.arcsin()* function to prepare the state, the even </span>
<span class="sd">        bins should be used for reconstructing the signal.</span>

<span class="sd">        However, the relations between sine and cosine means that a </span>
<span class="sd">        reconstruction with the cosine terms will build a perfectly inverted </span>
<span class="sd">        version of the signal. The user is able to choose between retrieving </span>
<span class="sd">        original or phase-inverted (or both) signals.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            treg_size: Size of the &#39;treg&#39; (time) register, leading to the full</span>
<span class="sd">                audio size.</span>
<span class="sd">            counts: Histogram from a qiskit job result (result.get_counts())</span>
<span class="sd">            shots: Amount of identical experiments ran by the qiskit job.</span>
<span class="sd">            inverted: Retrieves the cosine amplitudes instead (leading to a </span>
<span class="sd">                phase-inverted version of the signal).</span>
<span class="sd">            both: Retrieves both Sine and Cosine amplitudes in a tuple. </span>
<span class="sd">                Overwrites the &#39;inverted&#39; argument.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Digital Audio as a Numpy Array, or a Tuple with two signals. </span>
<span class="sd">            The signals are in float format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">treg_size</span>
        
        <span class="n">cosine_amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">sine_amps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="p">(</span><span class="n">t_bits</span><span class="p">,</span> <span class="n">a_bit</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t_bits</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">state</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">a_bit</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">):</span>
                <span class="n">cosine_amps</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">a_bit</span> <span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">):</span>
                <span class="n">sine_amps</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>


        <span class="k">if</span> <span class="n">both</span><span class="p">:</span>    
            <span class="k">return</span> <span class="p">(</span><span class="n">cosine_amps</span><span class="p">,</span> <span class="n">sine_amps</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">inverted</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">cosine_amps</span><span class="o">/</span><span class="p">(</span><span class="n">cosine_amps</span><span class="o">+</span><span class="n">sine_amps</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">sine_amps</span><span class="o">/</span><span class="p">(</span><span class="n">cosine_amps</span><span class="o">+</span><span class="n">sine_amps</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span></div></div>
        

<span class="c1"># ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span>
<span class="c1"># ==================================== QSM =====================================</span>
<span class="c1"># ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||</span>

<div class="viewcode-block" id="QSM"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QSM">[docs]</a><span class="k">class</span> <span class="nc">QSM</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    
<div class="viewcode-block" id="QSM.treg_index_X"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QSM.treg_index_X">[docs]</a>    <span class="k">def</span> <span class="nf">treg_index_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="p">:</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">treg</span><span class="p">:</span> <span class="s1">&#39;QuantumRegister&#39;</span><span class="p">,</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Auxilary function for matching control conditions with time indexes.</span>
<span class="sd">        </span>
<span class="sd">        Applies X gates on qubits of the time register whenever the respective </span>
<span class="sd">        bit of the current time index (in binary representation) is 0. As a </span>
<span class="sd">        result, the qubit will be flipped to \|1&gt; and succesfully trigger </span>
<span class="sd">        necessary control conditions of the circuit for this time index.</span>

<span class="sd">        Args:</span>
<span class="sd">            qa: The quantum circuit to be maniputated</span>
<span class="sd">            t: Time index that will be converted to binary form for comparison.</span>
<span class="sd">            treg: Quantum register of the time indexes.</span>
<span class="sd">            print_state: Toggles a simple print of the prepared quantum state to the</span>
<span class="sd">                console, for visualization purposes only. To be used together </span>
<span class="sd">                with all other QSM methods with a &#39;print_state&#39; kwarg.</span>

<span class="sd">        Examples:</span>
<span class="sd">            treg_index_X(qa, 6, treg)</span>
<span class="sd">            (a time register &#39;treg&#39; with, say, 5 qubits in &#39;qa&#39; at instant 6)</span>

<span class="sd">            &#39;t&#39; = 6 == &#39;00110&#39;. *treg_index_X()* applies X gates to qubits 0, 3 and 4</span>
<span class="sd">                (right to left) of register &#39;treg&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t_bitstring</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">treg_qubit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">treg</span><span class="p">):</span>
            <span class="n">t_bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">t_bitstring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_bit</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">t_bit</span><span class="p">:</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">treg_qubit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_state</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(x)|&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">t_bitstring</span><span class="p">):</span>    
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="QSM.omega_t"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QSM.omega_t">[docs]</a>    <span class="k">def</span> <span class="nf">omega_t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qa</span><span class="p">:</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">treg</span><span class="p">:</span> <span class="s1">&#39;QuantumRegister&#39;</span><span class="p">,</span> <span class="n">areg</span><span class="p">:</span> <span class="s1">&#39;QuantumRegister&#39;</span><span class="p">,</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;QSM Value-Setting operation.     </span>
<span class="sd">        </span>
<span class="sd">        Applies a multi-controlled CNOT gate to qubits of amplitude register, </span>
<span class="sd">        controlled by the time register at the respective time index</span>
<span class="sd">        state. In other words. At index &#39;t&#39;, it flipps the amplitude qubits</span>
<span class="sd">        to match the original audio sample bits at the same index. </span>

<span class="sd">        Args:</span>
<span class="sd">            qa: The quantum circuit to be manipulated.</span>
<span class="sd">            t: Time index that will be encoded.</span>
<span class="sd">            a: Quantized sample from original audio to be converted to binary.</span>
<span class="sd">            treg: Time register, &#39;treg&#39;.</span>
<span class="sd">            areg: Amplitude Register, &#39;areg&#39;.</span>
<span class="sd">            print_state: Toggles a simple print of the prepared quantum state to the</span>
<span class="sd">                console, for visualization purposes only. To be used together </span>
<span class="sd">                with all other SQPAM methods with a &#39;print_state&#39; kwarg.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        
        <span class="c1"># Applies the necessary NOT gates at index t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treg_index_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">treg</span><span class="p">)</span>
        <span class="n">astr</span><span class="o">=</span><span class="p">[]</span>
        <span class="c1"># Flips a qubit everytime a_bit==1</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">areg_qubit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">areg</span><span class="p">):</span>
            <span class="n">a_bit</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
            <span class="n">astr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_bit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a_bit</span><span class="p">:</span>
                <span class="n">qa</span><span class="o">.</span><span class="n">mct</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span> <span class="n">areg_qubit</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_state</span><span class="p">:</span>        
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>       
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">astr</span><span class="p">):</span>    
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">treg_index_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qa</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">treg</span><span class="p">,</span> <span class="n">print_state</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="QSM.convert"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QSM.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_audio</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; For the QSM encoding scheme, this function is dummy.</span>
<span class="sd">        </span>
<span class="sd">        QSM expects a quantized signal (N-Bit PCM) as input. </span>
<span class="sd">        No pre-processing is needed after this point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">original_audio</span></div>
        
<div class="viewcode-block" id="QSM.prepare"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QSM.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantized_audio</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">regsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">regnames</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prepares a QSM quantum circuit.</span>

<span class="sd">        Creates a qiskit QuantumCircuit that prepares a Quantum Audio state </span>
<span class="sd">        using QSM (Quantum State Modulation).</span>
<span class="sd">        The quantum circuits used for audio representations typically contain </span>
<span class="sd">        two qubit registers, namely, &#39;treg&#39; (which encodes time/index information) </span>
<span class="sd">        and &#39;areg&#39; (which encodes amplitude information).</span>

<span class="sd">        Args:</span>
<span class="sd">            quantized_audio: Integer Array with the input signal.</span>
<span class="sd">            regsize: The size of both qubit registers in a tuple (treg_size, areg_size). </span>
<span class="sd">                &#39;treg_size&#39; qubits for &#39;treg&#39;; &#39;areg_size&#39; qubits for &#39;areg&#39;. </span>
<span class="sd">            regnames: Label names for &#39;treg&#39; and &#39;areg&#39;, passed as a tuple. For </span>
<span class="sd">                visualization purposes only.</span>
<span class="sd">            print_state: Toggles a simple print of the prepared quantum state to the</span>
<span class="sd">                console, for visualization purposes only.</span>

<span class="sd">        Returns: </span>
<span class="sd">            A qiskit quantum circuit containing specific QSM preparation</span>
<span class="sd">            instructions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">treg_size</span><span class="p">,</span> <span class="n">areg_size</span> <span class="o">=</span> <span class="n">regsize</span>

        <span class="c1"># Time register</span>
        <span class="n">treg</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="n">treg_size</span><span class="p">,</span> <span class="n">regnames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Amplitude register</span>
        <span class="n">areg</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="n">areg_size</span><span class="p">,</span> <span class="n">regnames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Init quantum circuit</span>
        <span class="n">qsm</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">()</span>
        <span class="n">qsm</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">areg</span><span class="p">)</span>
        <span class="n">qsm</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">treg</span><span class="p">)</span>

        <span class="c1"># Hadamard Gate in the Time Register</span>
        <span class="n">qsm</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">treg</span><span class="p">)</span>

        <span class="c1"># Value setting operations</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">quantized_audio</span><span class="p">):</span>        
            <span class="bp">self</span><span class="o">.</span><span class="n">omega_t</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qsm</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">treg</span><span class="p">,</span> <span class="n">areg</span><span class="p">,</span> <span class="n">print_state</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">print_state</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">quantized_audio</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_state</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>  
        <span class="k">return</span> <span class="n">qsm</span></div>
    
<div class="viewcode-block" id="QSM.measure"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QSM.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="p">:</span> <span class="s1">&#39;QuantumCircuit&#39;</span><span class="p">,</span> <span class="n">treg_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">areg_pos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Appends Measurements to a QSM audio circuit</span>
<span class="sd">        </span>
<span class="sd">        From a quantum circuit with registers containing a QSM </span>
<span class="sd">        representation of quantum audio, creates two classical registers with </span>
<span class="sd">        compatible sizes and adds instructions for measuring them.</span>

<span class="sd">        Args:</span>
<span class="sd">            qc: A quantum circuit containing at least 2 quantum registers.</span>
<span class="sd">            treg_pos: Index of the SQPAM (&#39;treg&#39;) register in the circuit. </span>
<span class="sd">                Default is 1</span>
<span class="sd">            areg_pos: Index of the SQPAM (&#39;areg&#39;) register in the circuit. </span>
<span class="sd">                Default is 0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">treg</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">qregs</span><span class="p">[</span><span class="n">treg_pos</span><span class="p">]</span>
        <span class="n">areg</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">qregs</span><span class="p">[</span><span class="n">areg_pos</span><span class="p">]</span>
       
        <span class="n">ctreg</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="n">treg</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;ct&#39;</span><span class="p">)</span>
        <span class="n">careg</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="n">areg</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="s1">&#39;ca&#39;</span><span class="p">)</span>        
        <span class="n">qc</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">careg</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">ctreg</span><span class="p">)</span>
        
        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">treg</span><span class="p">,</span> <span class="n">ctreg</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">areg</span><span class="p">,</span> <span class="n">careg</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="QSM.reconstruct"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QSM.reconstruct">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">treg_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="s1">&#39;Counts&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Builds a digital Audio from qiskit histogram data.</span>

<span class="sd">        Considering the QSM encoding scheme, it uses the histogram data stored </span>
<span class="sd">        in a Counts object (qiskit.result.counts.Counts) to reconstruct an audio</span>
<span class="sd">        signal. It uses the bin labels of the histogram, which contains the</span>
<span class="sd">        measured quantum states in binary form. It converts the binary pairs to </span>
<span class="sd">        (amplitude, index) pairs, building an Array.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            treg_size: Size of the &#39;treg&#39; (time) register.</span>
<span class="sd">            counts: Histogram from a qiskit job result (result.get_counts())</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Digital Audio as a Numpy Array. The signal is in </span>
<span class="sd">            quantized (int) format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">treg_size</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">:</span>
            <span class="p">(</span><span class="n">t_bits</span><span class="p">,</span> <span class="n">a_bits</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t_bits</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># The BitArray function converts binary words into signed integers,</span>
            <span class="c1"># in oposition to the int(a_bit, 2) function.</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">BitArray</span><span class="p">(</span><span class="nb">bin</span><span class="o">=</span><span class="n">a_bits</span><span class="p">)</span><span class="o">.</span><span class="n">int</span>
            <span class="n">audio</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

        <span class="k">return</span> <span class="n">audio</span></div></div>


<span class="c1"># //////////////////////////////////////////////////////////////////////////////</span>
<span class="c1"># ============================ Encoder Selector ================================</span>
<span class="c1"># \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\</span>

<span class="n">AnyEncoder</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;AnyEncoder&#39;</span><span class="p">,</span> <span class="n">QPAM</span><span class="p">,</span> <span class="n">SQPAM</span><span class="p">,</span> <span class="n">QSM</span><span class="p">)</span>

<div class="viewcode-block" id="EncodingScheme"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.EncodingScheme">[docs]</a><span class="k">class</span> <span class="nc">EncodingScheme</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_qa_encoders</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;qpam&quot;</span><span class="p">:</span> <span class="n">QPAM</span><span class="p">,</span> 
            <span class="s2">&quot;sqpam&quot;</span><span class="p">:</span> <span class="n">SQPAM</span><span class="p">,</span>
            <span class="s2">&quot;qsm&quot;</span><span class="p">:</span> <span class="n">QSM</span><span class="p">,</span>
        <span class="p">}</span>
<div class="viewcode-block" id="EncodingScheme.get_encoder"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.EncodingScheme.get_encoder">[docs]</a>    <span class="k">def</span> <span class="nf">get_encoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyEncoder</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns: encoder class associated with name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qa_encoders</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">encoder_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">encoder</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">encoder_name</span><span class="si">}</span><span class="s1">&quot; is not a valid name. Valid representations are: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qa_encoders</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">encoder</span>    </div></div>


<span class="c1"># \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/</span>
<span class="c1"># =========================== Quantum Audio Class ==============================</span>
<span class="c1"># /\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\</span>

<div class="viewcode-block" id="QuantumAudio"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio">[docs]</a><span class="k">class</span> <span class="nc">QuantumAudio</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        
        <span class="c1">#Loads the methods from the specified representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">EncodingScheme</span><span class="p">()</span><span class="o">.</span><span class="n">get_encoder</span><span class="p">(</span><span class="n">encoder_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder_name</span> <span class="o">=</span> <span class="n">encoder_name</span>
        <span class="c1">#The audio part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converted_input</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        
        <span class="c1">#Qiskit part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># qubit size of the time register</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areg_size</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># qubit size of the amplitude register</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">shots</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    
<div class="viewcode-block" id="QuantumAudio.load_input"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio.load_input">[docs]</a>    <span class="k">def</span> <span class="nf">load_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_audio</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span> <span class="n">bit_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumAudio&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Loads an audio file and calculates the qubit requirements.</span>

<span class="sd">        Brings a digital audio signal inside the class for further processing.</span>
<span class="sd">        Audio files should be in numpy.ndarray type and be in the (-1. to 1.)</span>
<span class="sd">        amplitude range. You can also optionally load a quantized audio signal </span>
<span class="sd">        as input (-N to N-1) range, as long as you specify the bit depth of your</span>
<span class="sd">        quantized input &#39;areg_size&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            input_audio: The audio signal to be converted. If not in 32-bit or </span>
<span class="sd">                64-bit float format (&#39;n&#39;-bit integer PCM), specify bit depth.</span>
<span class="sd">            bit_depth: Audio bit depth IF using integer PCM. Ignore otherwise.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns itself for using multiple QuantumAudio methods in one line</span>
<span class="sd">            of code.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; float_audio = [0., -0.25, 0.5 , 0.75,  -0.75  ,  -1.,  0.25]</span>
<span class="sd">            &gt;&gt;&gt; quantum_audio = qa.QuantumAudio(&#39;qpam&#39;).load_input(float_audio)</span>
<span class="sd">            For this input, the QPAM representation will require:</span>
<span class="sd">                    3 qubits for encoding time information and </span>
<span class="sd">                    0 qubits for encoding ampƒ∫itude information.</span>
<span class="sd">            </span>
<span class="sd">            &gt;&gt;&gt; int_3bit_PCM_audio = [0, -1, 2, 3, -3, -4, 1]</span>
<span class="sd">            &gt;&gt;&gt; quantum_audio = qa.QuantumAudio(&#39;qsm&#39;).load_input(int_3bit_PCM_audio, 3)</span>
<span class="sd">            For this input, the QSM representation will require:</span>
<span class="sd">                    3 qubits for encoding time information and </span>
<span class="sd">                    3 qubits for encoding ampƒ∫itude information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_audio</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_audio</span><span class="p">))))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_name</span> <span class="o">==</span> <span class="s1">&#39;qpam&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">areg_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_name</span> <span class="o">==</span> <span class="s1">&#39;sqpam&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">areg_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">areg_size</span> <span class="o">=</span> <span class="n">bit_depth</span>       

        <span class="c1"># Zero Padding</span>
        <span class="n">zp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_audio</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">input_audio</span><span class="p">,</span> <span class="n">zp</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_name</span> <span class="o">==</span><span class="s1">&#39;qsm&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">bit_depth</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;For this input, the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> representation will require:</span><span class="se">\n</span><span class="s2">         </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span><span class="si">}</span><span class="s2"> qubits for encoding time information and </span><span class="se">\n</span><span class="s2">         </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">areg_size</span><span class="si">}</span><span class="s2"> qubits for encoding ampƒ∫itude information.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
        
    <span class="k">def</span> <span class="nf">_convert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumAudio&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Pre-processing step for circuit preparation.</span>
<span class="sd">        </span>
<span class="sd">        Depends on the encoder. Loads the &#39;converted_input&#39; attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns itself for using multiple QuantumAudio methods in one line</span>
<span class="sd">            of code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converted_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
<div class="viewcode-block" id="QuantumAudio.prepare"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tregname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">aregname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">print_state</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumAudio&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Creates a Quantum Circuit that prepares the audio representation.</span>
<span class="sd">        </span>
<span class="sd">        Loads the &#39;circuit&#39; attribute with the preparation circuit, according</span>
<span class="sd">        to the encoding technique used: QPAM, SQPAM or QSM.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns itself for using multiple QuantumAudio methods in one line</span>
<span class="sd">            of code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">converted_input</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">areg_size</span><span class="p">),</span> <span class="p">(</span><span class="n">tregname</span><span class="p">,</span> <span class="n">aregname</span><span class="p">),</span> <span class="n">print_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="QuantumAudio.measure"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio.measure">[docs]</a>    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">treg_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">areg_pos</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumAudio&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Updates quantum circuit by adding measurements in the end.</span>

<span class="sd">        Will add a measurement instruction to the end of each qubit register.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns itself for using multiple QuantumAudio methods in one line</span>
<span class="sd">            of code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">treg_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">additional_args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">treg_pos</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">areg_pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">additional_args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">areg_pos</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="p">,</span> <span class="o">*</span><span class="n">additional_args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
            
<div class="viewcode-block" id="QuantumAudio.run"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">backend_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;aer_simulator&#39;</span><span class="p">,</span> <span class="n">provider</span><span class="o">=</span><span class="n">AerProvider</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumAudio&#39;</span><span class="p">:</span>        
        <span class="sd">&quot;&quot;&quot; Runs the Quantum Circuit in an IBMQ job.</span>

<span class="sd">        Transpiles and runs QuantumAudio.circuit in a qiskit job. Supports IBMQ</span>
<span class="sd">        remote backends.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns itself for using multiple QuantumAudio methods in one line</span>
<span class="sd">            of code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shots</span> <span class="o">=</span> <span class="n">shots</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="n">backend_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">backend_name</span> <span class="o">!=</span> <span class="s1">&#39;aer_simulator&#39;</span><span class="p">:</span>
            <span class="n">circuit</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">circuit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">circuit</span>
            
        <span class="n">job</span> <span class="o">=</span> <span class="n">execute</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">shots</span><span class="o">=</span><span class="n">shots</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backend_name</span> <span class="o">!=</span> <span class="s1">&#39;aer_simulator&#39;</span><span class="p">:</span>
            <span class="n">job_monitor</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">get_counts</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="QuantumAudio.reconstruct_audio"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio.reconstruct_audio">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">additional_kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;QuantumAudio&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Builds an audio signal from a qiskit result histogram.</span>

<span class="sd">        Depending on the chosen encoding technique, reconstructs an audio file</span>
<span class="sd">        using the histogram in QuantumAudio.counts (qiskit.result.Counts)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns itself for using multiple QuantumAudio methods in one line</span>
<span class="sd">            of code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">additional_args</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_name</span> <span class="o">==</span> <span class="s1">&#39;qpam&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder_name</span> <span class="o">==</span> <span class="s1">&#39;sqpam&#39;</span><span class="p">:</span>
            <span class="n">additional_args</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shots</span><span class="p">]</span>        

        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">,</span> <span class="o">*</span><span class="n">additional_args</span><span class="p">,</span> <span class="o">**</span><span class="n">additional_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
        
<div class="viewcode-block" id="QuantumAudio.plot_audio"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio.plot_audio">[docs]</a>    <span class="k">def</span> <span class="nf">plot_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Plots comparisons between the input and output audio files.</span>

<span class="sd">        Uses matplotlib.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span><span class="p">),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>
        <span class="c1">#plt.axis(&#39;off&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">treg_size</span><span class="p">),</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1">#plt.axis(&#39;off&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="QuantumAudio.listen"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.QuantumAudio.listen">[docs]</a>    <span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">44100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Plays the audio file using ipython.display.Audio()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">display</span><span class="p">(</span><span class="n">Audio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">))</span></div></div>


<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<span class="c1"># =========================== Utilitary Functions ==============================</span>
<span class="c1"># ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<div class="viewcode-block" id="requantize_input"><a class="viewcode-back" href="../../quantumaudio.html#quantumaudio.quantumaudio.requantize_input">[docs]</a><span class="k">def</span> <span class="nf">requantize_input</span><span class="p">(</span><span class="n">audio</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">,</span> <span class="n">bit_depth</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Requantizes Array signals and PCM audio signals.</span>

<span class="sd">    Utilitary Function for downsizing the bit depth of an audio file.</span>
<span class="sd">    Very useful for using with the QSM encoder &#39;QuantumAudio(&#39;qsm&#39;)&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Numpy Array) Requantized audio signal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">bit_depth</span><span class="o">-</span><span class="mi">1</span>
    
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-16</span>
    <span class="n">audio_shifted</span> <span class="o">=</span> <span class="p">((</span><span class="n">audio</span><span class="o">+</span><span class="n">eps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">audio_quantized_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">((</span><span class="n">Q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">audio_shifted</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">audio_quantized</span> <span class="o">=</span> <span class="n">audio_quantized_norm</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">audio_quantized</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Paulo Vitor Itabora√≠, ICCMR.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>