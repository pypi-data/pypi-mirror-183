"use strict";(self.webpackChunk_jupyrdf_jupyter_elk=self.webpackChunk_jupyrdf_jupyter_elk||[]).push([[73],{1448:(e,t,l)=>{l.r(t),l.d(t,{ELKLayoutModel:()=>m,ELKTextSizerModel:()=>u,ELKTextSizerView:()=>c});var s=l(4005),n=l.n(s),i=l(1840),o=l(9098),a=l(306),r=l(719),d=l(6486);class u extends o.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:u.model_name,_model_module_version:a.q4,_view_module:a.A1,_view_name:c.view_name,_view_module_version:a.q4,id:String(Math.random()),inlet:null,outlet:null})}initialize(e,t){super.initialize(e,t),a.ZF&&console.warn("ELK Test Sizer Init"),this.on("msg:custom",this.handleMessage,this),a.ZF&&console.warn("ELK Text Done Init")}make_container(){const e=document.createElement("div"),t=this.get("_dom_classes").filter((e=>0===e.indexOf("styled-widget-")))[0];e.classList.add("p-Widget",a.gJ.widget_class,a.gJ.sizer_class,t);const l=this.get("namespaced_css");return e.innerHTML=`<div class="sprotty"><style>${l}</style><svg class="sprotty-graph"><g></g></svg></div>`,e}make_label(e){var t,l;a.ZF&&console.warn("ELK Text Label for text",e);let s=p("text"),n=[a.gJ.label];return(null===(t=e.properties)||void 0===t?void 0:t.cssClasses.length)>0&&(n=n.concat(null===(l=e.properties)||void 0===l?void 0:l.cssClasses.split(" "))),s.classList.add(...n),s.textContent=e.text,a.ZF&&console.warn("ELK Text Label",s),s}handleMessage(e){"run"===e.action&&this.measure()}measure(){var e;const t=null===(e=this.get("inlet"))||void 0===e?void 0:e.get("value");let l=this.get("outlet");if(null==t||null==l)return null;a.ZF&&console.log("Root Node:",t);let s=g(t);a.ZF&&console.warn("ELK Text Sizer Measure",s);const n=this.make_container(),i=n.getElementsByTagName("g")[0],o=p("g");s.forEach((e=>{o.appendChild(this.make_label(e))})),i.appendChild(o),a.ZF&&console.warn("ELK Text Sizer to add node",o),a.ZF&&console.warn("ELK Text Sizer node",i),document.body.prepend(n);let r=Array.from(o.getElementsByTagName("text"));a.ZF&&console.warn("Sized Text"),window.requestAnimationFrame((()=>{this.read_sizes(s,r);let e=Object.assign({},t);e.out=(0,d.random)(),l.set("value",e),l.save_changes(),a.ZF||document.body.removeChild(n)}))}read_sizes(e,t){let l=0;for(let s of t){a.ZF&&console.warn(s.innerHTML);const t=e[l],n=s.getBoundingClientRect();t.width=n.width,t.height=n.height,l++}}}u.model_name="ELKTextSizerModel",u.serializers=Object.assign(Object.assign({},o.DOMWidgetModel.serializers),{inlet:{deserialize:o.unpack_models},outlet:{deserialize:o.unpack_models}});class c extends o.DOMWidgetView{async render(){}}function p(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function g(e){var t,l,s,n;let i=[];if(null==e?void 0:e.labels)for(let o of e.labels)(null===(l=null===(t=null==o?void 0:o.properties)||void 0===t?void 0:t.shape)||void 0===l?void 0:l.width)&&(null===(n=null===(s=null==o?void 0:o.properties)||void 0===s?void 0:s.shape)||void 0===n?void 0:n.height)||i.push(o);for(let t of(null==e?void 0:e.ports)||[])i.push(...g(t));for(let t of(null==e?void 0:e.children)||[])i.push(...g(t));for(let t of(null==e?void 0:e.edges)||[])i.push(...g(t));for(let t of(null==e?void 0:e.labels)||[])i.push(...g(t));return i}c.view_name="ELKTextSizerView";const h=new(n())({workerFactory:()=>(a.ZF&&console.warn("ELK Worker created"),new r.Z)});class m extends o.DOMWidgetModel{constructor(){super(...arguments),this.layoutUpdated=new i.Signal(this)}defaults(){return Object.assign(Object.assign({},super.defaults()),{_view_module:a.A1,_model_name:m.model_name,_model_module_version:a.q4,inlet:null,outlet:null})}initialize(e,t){super.initialize(e,t),this.on("msg:custom",this.handleMessage,this)}ensureElk(){null==this._elk&&(this._elk=h)}handleMessage(e){"run"===e.action&&this.layout()}async layout(){var e;const t=null===(e=this.get("inlet"))||void 0===e?void 0:e.get("value");let l=this.get("outlet");if(null==t||null==l)return null;let s,n=function(e){let t=new Map;return function e(l){t[l.id]=l.properties,delete l.properties,l.children&&l.children.map(e),l.ports&&l.ports.map(e),l.labels&&l.labels.map(e),l.edges&&l.edges.map(e)}(e),t}(t);this.ensureElk();try{s=await this._elk.layout(t),i=n,function e(t){t.properties=i[t.id],t.children&&t.children.map(e),t.ports&&t.ports.map(e),t.labels&&t.labels.map(e),t.edges&&t.edges.map(e)}(s)}catch(e){s={},console.error(e)}var i;return l.set("value",Object.assign({},s)),l.save_changes(),s}}m.model_name="ELKLayoutModel",m.serializers=Object.assign(Object.assign({},o.DOMWidgetModel.serializers),{inlet:{deserialize:o.unpack_models},outlet:{deserialize:o.unpack_models}})}}]);