"use strict";(self.webpackChunk_jupyrdf_jupyter_elk=self.webpackChunk_jupyrdf_jupyter_elk||[]).push([[555],{9965:(e,t,s)=>{s.r(t),s.d(t,{ELKControlModel:()=>je,ELKViewerModel:()=>Pe,ELKViewerView:()=>Re});var o=s(1966),i=s.n(o),n=(s(6218),s(3409)),r=s(1526),l=s(1840),a=s(9098),d=s(6700);const c={IFeedbackActionDispatcher:Symbol.for("IFeedbackActionDispatcher"),IToolFactory:Symbol.for("Factory<Tool>"),IEditConfigProvider:Symbol.for("IEditConfigProvider"),RequestResponseSupport:Symbol.for("RequestResponseSupport"),SelectionService:Symbol.for("SelectionService"),SelectionListener:Symbol.for("SelectionListener"),SModelRootListener:Symbol.for("SModelRootListener"),MouseTool:Symbol.for("MouseTool"),ViewerOptions:Symbol.for("ViewerOptions")};class u extends n.Command{constructor(){super(...arguments),this.priority=0}undo(e){return e.root}redo(e){return e.root}}var h;!function(e){e.DEFAULT="default-mode",e.OVERLAP_FORBIDDEN="overlap-forbidden-mode",e.NODE_CREATION="node-creation-mode",e.EDGE_CREATION_SOURCE="edge-creation-select-source-mode",e.EDGE_CREATION_TARGET="edge-creation-select-target-mode",e.EDGE_RECONNECT="edge-reconnect-select-target-mode",e.OPERATION_NOT_ALLOWED="edge-modification-not-allowed-mode",e.ELEMENT_DELETION="element-deletion-mode",e.MOUSEOVER="mouseover",e.SELECTED="selected"}(h||(h={}));let p=class extends u{constructor(e){super(),this.action=e}execute(e){return function(e,t){if(null!=e.cssClasses&&0!==e.cssClasses.length)for(const s of t)-1!==e.cssClasses.indexOf(s)&&e.cssClasses.splice(e.cssClasses.indexOf(s),1)}(this.action.target,Object.values(h)),this.action.cssClass&&function(e,t){null==e.cssClasses&&(e.cssClasses=[]);for(const s of t)e.cssClasses.indexOf(s)<0&&e.cssClasses.push(s)}(this.action.target,[this.action.cssClass]),e.root}};var g,m;p.KIND="applyCursorCssFeedback",p=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)(),(g=0,m=(0,d.inject)(n.TYPES.Action),function(e,t){m(e,t,g)}),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[class{constructor(e,t){this.target=e,this.cssClass=t,this.kind=p.KIND}}])],p);var f=function(e,t){return function(s,o){t(s,o,e)}};let v=class{constructor(e,t){this.actionDispatcher=e,this.logger=t,this.feedbackEmitters=new Map}registerFeedback(e,t){this.feedbackEmitters.set(e,t),this.dispatch(t,e)}deregisterFeedback(e,t){this.feedbackEmitters.delete(e),this.dispatch(t,e)}dispatch(e,t){this.actionDispatcher().then((t=>t.dispatchAll(e))).then((()=>this.logger.info(this,`Dispatched feedback actions for ${t}`))).catch((e=>this.logger.error(this,"Failed to dispatch feedback actions",e)))}getRegisteredFeedback(){const e=[];return this.feedbackEmitters.forEach(((t,s)=>e.push(...t))),e}getRegisteredFeedbackEmitters(e){const t=[];return this.feedbackEmitters.forEach(((s,o)=>{s.find((t=>t===e))&&t.push(o)})),t}};v=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)(),f(0,(0,d.inject)(n.TYPES.IActionDispatcherProvider)),f(1,(0,d.inject)(n.TYPES.ILogger)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Function,Object])],v);const y=new d.ContainerModule(((e,t,s)=>{e(c.IFeedbackActionDispatcher).to(v).inSingletonScope(),(0,n.configureCommand)({bind:e,isBound:s},p),(0,n.configureCommand)({bind:e,isBound:s},n.MoveCommand),(0,n.configureCommand)({bind:e,isBound:s},n.SelectCommand),(0,n.configureCommand)({bind:e,isBound:s},n.SelectAllCommand),(0,n.configureCommand)({bind:e,isBound:s},n.GetSelectionCommand),e(n.TYPES.IVNodePostprocessor).to(n.LocationPostprocessor),e(n.TYPES.HiddenVNodePostprocessor).to(n.LocationPostprocessor)}));var b=s(306);function w(e,t=""){return null==e||0==e.length?t:e}function E(e){var t;let s=((null===(t=e.properties)||void 0===t?void 0:t.cssClasses)||"").trim();return s?s.split(" "):[]}class S{constructor(){this.nodeIds=new Set,this.edgeIds=new Set,this.portIds=new Set,this.labelIds=new Set,this.sectionIds=new Set,this.symbolsIds=new Map,this.connectors=new Map}transform(e,t,s){const o={type:"graph",id:e.id||"root",children:[],cssClasses:E(e),symbols:this.transformSymbols(t,s)};if(e.children){const t=e.children.map(this.transformElkNode,this);o.children.push(...t)}if(e.edges){const t=e.edges.map(this.transformElkEdge,this);o.children.push(...t)}return o}transformSymbols(e,t){let s=[];for(const o in e.library)s.push(this.transformSymbol(o,e.library[o],t));return{children:s}}transformSymbol(e,t,s){let o=null==t?void 0:t.element,i=[];return o&&(i=[this.transformSymbolElement(o)]),this.symbolsIds[e]=`${s}_${e}`,(t.hasOwnProperty("symbol_offset")||t.hasOwnProperty("path_offset"))&&(this.connectors[e]=t),{type:"symbol",id:e,children:i,position:this.pos(t),size:this.size(t),properties:t.properties}}transformSymbolElement(e){var t,s;e.properties.isSymbol=!0;let o={id:e.id,position:this.pos(e),size:this.size(e),cssClasses:E(e),children:[],properties:e.properties,type:w(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"node")};const i=e.children.map(this.transformSymbolElement,this);return o.children.push(...i),o}transformElkNode(e){var t,s;this.checkAndRememberId(e,this.nodeIds);const o={type:w(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"node"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:E(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.children){const t=e.children.map(this.transformElkNode,this);o.children.push(...t)}if(e.ports){const t=e.ports.map(this.transformElkPort,this);o.children.push(...t)}if(e.labels){const t=e.labels.map(this.transformElkLabel,this);o.children.push(...t)}if(e.edges){const t=e.edges.map(this.transformElkEdge,this);o.children.push(...t)}return o}transformElkPort(e){var t,s;this.checkAndRememberId(e,this.portIds);const o={type:w(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"port"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:E(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);o.children.push(...t)}return o}transformElkLabel(e){var t,s;this.checkAndRememberId(e,this.labelIds);let o={type:w(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"label"),id:e.id,text:e.text,position:this.pos(e),size:this.size(e),cssClasses:E(e),labels:[],properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);o.labels.push(...t)}return o}transformElkEdge(e){var t,s;this.checkAndRememberId(e,this.edgeIds);const o={type:w(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"edge"),id:e.id,sourceId:"",targetId:"",routingPoints:[],children:[],cssClasses:E(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};var i;if(null!=(i=e).source&&null!=i.target?(o.sourceId=e.source,o.targetId=e.target,e.sourcePoint&&o.routingPoints.push(e.sourcePoint),e.bendPoints&&o.routingPoints.push(...e.bendPoints),e.targetPoint&&o.routingPoints.push(e.targetPoint)):function(e){return null!=e.sources&&null!=e.targets}(e)&&(o.sourceId=e.sources[0],o.targetId=e.targets[0],e.sections&&e.sections.forEach((e=>{this.checkAndRememberId(e,this.sectionIds),o.routingPoints.push(e.startPoint),e.bendPoints&&o.routingPoints.push(...e.bendPoints),o.routingPoints.push(e.endPoint)}))),e.junctionPoints&&e.junctionPoints.forEach(((t,s)=>{const i={type:"junction",id:e.id+"_j"+s,position:t};o.children.push(i)})),e.labels){const t=e.labels.map(this.transformElkLabel,this);o.children.push(...t)}return o}pos(e){return{x:e.x||0,y:e.y||0}}size(e){return{width:e.width||0,height:e.height||0}}checkAndRememberId(e,t){if(null==e.id)throw Error("An element is missing an id.");if(t.has(e.id))throw Error("Duplicate id: "+e.id+".");t.add(e.id)}}let x=class extends n.LocalModelSource{async updateLayout(e,t,s){this.elkToSprotty=new S;let o=this.elkToSprotty.transform(e,t,s);await this.updateModel(o)}get root(){return this.factory.root}getById(e){return this.factory.root.index.getById(e)}async doSubmitModel(e,t,s,o){b.ZF&&console.log("doSubmitModel"),super.doSubmitModel(e,t,s,o),o||(o=new n.SModelIndex).add(this.currentRoot),this.index=o}element(){return document.getElementById(this.viewerOptions.baseDiv)}center(e=[],t=!0,s=!1){let o=new n.CenterAction(e,t,s);this.actionDispatcher.dispatch(o)}fit(e=[],t,s,o){let i=new n.FitToScreenAction(e,t,s,o);this.actionDispatcher.dispatch(i)}resize(e){let t=new n.InitializeCanvasBoundsAction(e);this.actionDispatcher.dispatch(t)}async getViewport(){const e=await this.actionDispatcher.request(n.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}};x=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],x);var M=s(2388),k=s(3992);class C extends n.RectangularNode{hasFeature(e){return e!==n.moveFeature&&super.hasFeature(e)}}class _ extends n.RectangularPort{hasFeature(e){return e!==n.moveFeature&&super.hasFeature(e)}}class O extends n.SEdge{hasFeature(e){return e!==n.editFeature&&super.hasFeature(e)}}class j extends n.SNode{hasFeature(e){return e!==n.moveFeature&&e!==n.selectFeature&&e!==n.hoverFeedbackFeature&&super.hasFeature(e)}}class P extends n.SLabel{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1}hasFeature(e){var t;return e!==n.selectFeature&&e!==n.hoverFeedbackFeature?super.hasFeature(e):!0===(null===(t=this.properties)||void 0===t?void 0:t.selectable)||void 0}}P.DEFAULT_FEATURES=[n.selectFeature,n.hoverFeedbackFeature,n.boundsFeature,n.alignFeature,n.layoutableChildFeature,n.edgeLayoutFeature,n.fadeFeature];class R extends n.SNode{hasFeature(e){return e!==n.moveFeature&&super.hasFeature(e)}}class D extends n.ModelRenderer{constructor(e,t,s,o){super(e,t,s),this.viewRegistry=e,this.targetKind=t,this.source=o,this.widgets=new Map}getSelected(){var e;let t=[];if(null===(e=this.source.selectedNodes)||void 0===e?void 0:e.length)for(let e of this.source.selectedNodes){let s=this.source.getById(e.id);t.push(s)}return t}renderJLOverlayControl(e){b.ZF&&console.log("render control overlay");let t=[];if(this.source.control_overlay){let s=this.getSelected();if(0==s.length||!s[0])return t;let o=this.source.control_overlay,i=new C,r=function(e){let[t,s,o,i]=F(e[0]);return e.splice(1,e.length).forEach((e=>{let[n,r,l,a]=F(e);n<t&&(t=n),r>s&&(s=r),l>o&&(o=l),a<i&&(i=a)})),{x:t,y:i,height:s-i,width:o-t}}(s),l={width:0,height:0};i.id=s[0].id+"_entropy",i.type="node:widget",i.position=(0,n.add)(r,{x:r.width,y:0}),i.size=l,i.properties={shape:{use:o.model_id}};let a={vnode:void 0,node:i,widget:o.model_id,visible:!0,html:void 0},d=this.widgetContainer(a,e,!1);void 0!==d&&t.push(d)}return t}renderJLNodeWidgets(e){let t=[];for(let s in this.widgets){let o=this.widgets[s],i=this.widgetContainer(o,e);void 0!==i&&(this.decorate(i,o.node),t.push(i))}return t}widgetContainer(e,t,s=!0){if(!e.visible)return;let o=function(e){var t,s;let o=0,i=0;for(;void 0!==e;)o+=(null===(t=e.bounds)||void 0===t?void 0:t.x)||0,i+=(null===(s=e.bounds)||void 0===s?void 0:s.y)||0,e=null==e?void 0:e.parent;return{x:o,y:i}}(e.node),i={transform:`translate(${o.x}px, ${o.y}px)`};if(s){let t=e.node.bounds;t||(t=(0,n.getAbsoluteBounds)(e.node)),i.width=`${t.width}px`,i.height=`${t.height}px`}let r={};return e.html&&(r={innerHTML:e.html}),(0,M.html)("div",{key:e.node.id,class:{elkcontainer:!0},style:i,props:r,hook:{insert:t=>this.renderContent(t,e)}},[])}async renderContent(e,t,s){var o;if("widget"==(0,n.getSubType)(t.node)){let s,i=t.widget;s="string"==typeof i||i instanceof String?await this.source.widget_manager.get_model(i):i;let n=await this.source.widget_manager.create_view(s,{}),r=(null===(o=t.node.properties.shape)||void 0===o?void 0:o.delay)||0;if(r){let e=this.source.root.zoom||1,t=n.luminoWidget.node;t.style.transform=`scale(${1/e})`,t.style.transformOrigin="top left",setTimeout((()=>{t.style.transform=""}),r)}k.Widget.attach(n.luminoWidget,e.elm)}}async registerJLWidgetNode(e,t,s){this.widgets[t.id]=await this.wrapJLWidget(e,t,s)}async wrapJLWidget(e,t,s){var o,i;let r,l,a=null===(i=null===(o=t.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.use;return"widget"==(0,n.getSubType)(t)?a&&(r=await this.source.widget_manager.get_model(a),l=void 0):(r=void 0,l=a),{vnode:e,node:t,widget:r,visible:s,html:l}}getConnector(e){var t;return null===(t=this.source.elkToSprotty)||void 0===t?void 0:t.connectors[e]}hrefID(e){if(e)return this.source.elkToSprotty.symbolsIds[e]}}class I extends n.SModelFactory{initializeRoot(e,t){return(null==(e=super.initializeRoot(e,t))?void 0:e.symbols)&&(e.symbols.children=t.symbols.children.map((t=>this.createElement(t,e)))),this.root=e,e}}function F(e){let t=(0,n.getAbsoluteBounds)(e),s=t.x,o=t.y,i=t.x+t.width;return[s,t.y+t.height,i,o]}let z=class extends n.UpdateModelCommand{computeAnimation(e,t,s){const o={fades:[]};(0,n.forEachMatch)(t,((t,i)=>{if(void 0!==i.left&&void 0!==i.right)this.updateElement(i.left,i.right,o);else if(void 0!==i.right){const e=i.right;(0,n.isFadeable)(e)&&(e.opacity=0,o.fades.push({element:e,type:"in"}))}else if(i.left instanceof n.SChildElement){const t=i.left;if((0,n.isFadeable)(t)&&void 0!==i.leftParentId&&!function(e,t){const s=t=>t.some((t=>(t=>void 0!==e.index.getById(t.id))(t)||s(t.children)));return s([t])}(e,t)){const r=e.index.getById(i.leftParentId);if(r instanceof n.SParentElement){const e=s.modelFactory.createElement(t);r.add(e),o.fades.push({element:e,type:"out"})}}}}));const i=this.createAnimations(o,e,s);return i.length>=2?new n.CompoundAnimation(e,s,i):1===i.length?i[0]:e}};z=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],z);const T=new d.ContainerModule(((e,t,s)=>{(0,n.configureCommand)({bind:e,isBound:s},z)}));var L=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},N=function(e,t){return function(s,o){t(s,o,e)}};let $=class extends n.ScrollMouseListener{constructor(e){super(),this.model_source=e}mouseDown(e,t){if(null==(0,n.findParentByFeature)(e,n.isMoveable)&&!(e instanceof n.SRoutingHandle))if("node:widget"==e.type)this.lastScrollPosition=void 0;else{const s=(0,n.findParentByFeature)(e,n.isViewport);this.lastScrollPosition=s?{x:t.pageX,y:t.pageY}:void 0}return[]}mouseMove(e,t){if(0===t.buttons)this.mouseUp(e,t);else if(this.lastScrollPosition){const s=(0,n.findParentByFeature)(e,n.isViewport);if(s){const e=(t.pageX-this.lastScrollPosition.x)/s.zoom,o=(t.pageY-this.lastScrollPosition.y)/s.zoom,i={scroll:{x:s.scroll.x-e,y:s.scroll.y-o},zoom:s.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[new n.SetViewportAction(s.id,i,!1)]}}return[]}};$=L([N(0,(0,d.inject)(n.TYPES.ModelSource)),A("design:paramtypes",[x])],$);let V=class extends n.ZoomMouseListener{constructor(e){super(),this.model_source=e}getViewportOffset(e,t){const s=this.model_source.element().getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}};V=L([N(0,(0,d.inject)(n.TYPES.ModelSource)),A("design:paramtypes",[x])],V);const B=new d.ContainerModule(((e,t,s)=>{(0,n.configureCommand)({bind:e,isBound:s},n.CenterCommand),(0,n.configureCommand)({bind:e,isBound:s},n.FitToScreenCommand),(0,n.configureCommand)({bind:e,isBound:s},n.SetViewportCommand),(0,n.configureCommand)({bind:e,isBound:s},n.GetViewportCommand),e(n.TYPES.KeyListener).to(n.CenterKeyboardListener),e(n.TYPES.MouseListener).to($),e(n.TYPES.MouseListener).to(V)}));const K={createElement:M.html};let Y=class{render(e,t){const s=`scale(${e.zoom}) translate(${-e.scroll.x},${-e.scroll.y})`;let o=(0,M.svg)("svg",{class:{"sprotty-graph":!0}},[(0,M.svg)("g",{transform:s},t.renderChildren(e)),(0,M.svg)("g",{class:{elksymbols:!0}},t.renderChildren(e.symbols))]);const i={transform:`scale(${e.zoom}) translateZ(0) translate(${-e.scroll.x}px,${-e.scroll.y}px)`};let n=K.createElement("div",{"class-sprotty-overlay":!0,style:i},t.renderJLNodeWidgets());return K.createElement("div",{"class-sprotty-root":!0},K.createElement("div",{"class-sprotty-overlay":!0},t.renderJLOverlayControl()),o,n)}};Y=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],Y);var U=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};const W={createElement:M.svg};function H(e){return`${e.x},${e.y}`}let J=class extends n.RectangularNodeView{render(e,t){if(!this.isSymbol(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isSymbol(e)||((0,n.setClass)(s,"elknode",!0),(0,n.setClass)(s,"mouseover",e.hoverFeedback),(0,n.setClass)(s,"selected",e.selected)),(0,n.setClass)(s,e.type.replace(":","-"),!0),W.createElement("g",null,s,W.createElement("g",{"class-elkchildren":!0},this.renderChildren(e,t)))}renderMark(e,t){return W.createElement("rect",{x:"0",y:"0",width:e.size.width,height:e.size.height})}renderChildren(e,t){return t.renderChildren(e)}isSymbol(e){var t;return 1==(null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.isSymbol)}};J=U([(0,d.injectable)()],J);let G=class extends J{renderMark(e,t){let s=e.size.width,o=e.size.height;const i={x:s,y:o/2},n={x:0,y:o/2},r={x:s/2,y:o},l=`${H({x:s/2,y:0})} ${H(i)} ${H(r)} ${H(n)}`;return W.createElement("polygon",{points:l})}};G=U([(0,d.injectable)()],G);let q=class extends J{renderMark(e,t){var s,o,i,n;let r=e.size.width/2,l=e.size.height/2,a=null===(o=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.x;null==a&&(a=r);let d=null===(n=null===(i=e.properties)||void 0===i?void 0:i.shape)||void 0===n?void 0:n.y;return null==d&&(d=l),W.createElement("ellipse",{rx:r,ry:l,cx:a,cy:d})}};q=U([(0,d.injectable)()],q);let X=class extends J{renderMark(e,t){var s,o;let i=e.size.width,n=e.size.height;return W.createElement("image",{width:i,height:n,href:null===(o=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use})}};X=U([(0,d.injectable)()],X);let Z=class extends J{renderMark(e,t){var s,o;let i=Number(null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use)||15,n=e.size.width,r=e.size.height;const l=[{x:0,y:0},{x:n-i,y:0},{x:n,y:i},{x:n,y:r},{x:0,y:r}].map(H).join(" ");return W.createElement("polygon",{points:l})}};Z=U([(0,d.injectable)()],Z);let Q=class extends J{renderMark(e,t){var s,o;let i=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use;return W.createElement("path",{d:i})}};Q=U([(0,d.injectable)()],Q);let ee=class extends J{renderMark(e,t){var s,o;let i=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use,r=t.hrefID(i),l=W.createElement("use",{href:"#"+r,width:e.size.width,height:e.size.height});return(0,n.setClass)(l,i,!0),l}};ee=U([(0,d.injectable)()],ee);let te=class extends J{renderMark(e,t){var s,o,i,n,r,l;let a=(null===(o=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.x)||0,d=(null===(n=null===(i=e.properties)||void 0===i?void 0:i.shape)||void 0===n?void 0:n.y)||0;return W.createElement("g",{props:{innerHTML:null===(l=null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.shape)||void 0===l?void 0:l.use},transform:`translate(${a} ${d})`},[])}};te=U([(0,d.injectable)()],te);let se=class extends J{renderMark(e,t){if(e.parent.type==e.type){const t=e.parent.size;return W.createElement("rect",{x:"0",y:"0",width:t.width,height:e.size.height})}return super.renderMark(e,t)}};se=U([(0,d.injectable)()],se);let oe=class extends J{renderMark(e,t){var s,o;let i=(0,M.html)("div",{props:{innerHTML:null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use}},[]);return W.createElement("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.size.height,width:e.size.width,x:0,y:0},i)}};oe=U([(0,d.injectable)()],oe);let ie=class extends J{render(e,t){if(!this.isSymbol(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isSymbol(e)||((0,n.setClass)(s,"elknode",!0),(0,n.setClass)(s,"mouseover",e.hoverFeedback),(0,n.setClass)(s,"selected",e.selected)),(0,n.setClass)(s,e.type,!0),(0,M.svg)("g",{hook:{insert:s=>t.registerJLWidgetNode(s,e,!0),destroy:s=>t.registerJLWidgetNode(s,e,!1),update:(s,o)=>t.registerJLWidgetNode(o,e,this.isVisible(e,t))}},[s,W.createElement("g",{"class-elkchildren":!0},this.renderChildren(e,t))])}};ie=U([(0,d.injectable)()],ie);let ne=class extends n.RectangularNodeView{render(e,t){var s,o;let i,r=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use,l=t.hrefID(r);return l?(i=W.createElement("use",{"class-elkport":!0,width:e.size.width,height:e.size.height,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+l}),(0,n.setClass)(i,r,!0)):i=W.createElement("rect",{"class-elkport":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:e.size.width,height:e.size.height}),W.createElement("g",null,i,t.renderChildren(e))}};ne=U([(0,d.injectable)()],ne);let re=class extends n.ShapeView{render(e,t){var s,o,i,r,l;if(!this.isVisible(e,t))return;let a,d=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use,c=t.hrefID(d);if(c?(a=W.createElement("use",{"class-elklabel":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+c,width:e.size.width,height:e.size.height}),(0,n.setClass)(a,d,!0)):a=W.createElement("text",{"class-elklabel":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},e.text),null===(i=e.labels)||void 0===i?void 0:i.length){let s=e.labels[0],o=null===(l=null===(r=null==s?void 0:s.properties)||void 0===r?void 0:r.shape)||void 0===l?void 0:l.use,i=t.hrefID(o),n=e.size.height,d=this.dimension(s),c=this.dimension(e),u={x:0+s.position.x,y:(n-d.height)/2+s.position.x},h=(null==s?void 0:s.layoutOptions)||{},p=Number(h["org.eclipse.elk.spacing.labelLabel"])||0,g={x:d.width+p,y:(n-c.height)/2};a=W.createElement("g",null,W.createElement("use",{transform:`translate(${u.x} ${u.y})`,"class-elklabel":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+i,width:s.size.width,height:s.size.height}),W.createElement("g",{transform:`translate(${g.x} ${g.y})`},a))}return a}dimension(e){var t,s,o,i;return{width:(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.width)||e.size.width,height:(null===(i=null===(o=null==e?void 0:e.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.height)||e.size.height}}isVisible(e,t){if(!super.isVisible(e,t))return!1;let s,o=e.root.zoom;return s=!e.size.height||o*e.size.height>3,s}};re=U([(0,d.injectable)()],re);var le=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};const ae={createElement:M.svg};let de=class extends n.CircularNodeView{render(e,t){const s=this.getRadius(e);return ae.createElement("g",null,ae.createElement("circle",{"class-elkjunction":!0,r:s}))}getRadius(e){return 2}};de=le([(0,d.injectable)()],de);let ce=class extends n.PolylineEdgeView{render(e,t){const s=this.edgeRouterRegistry.get(e.routerKind).route(e);if(0===s.length)return this.renderDanglingEdge("Cannot compute route",e,t);if(!this.isVisible(e,s,t)){if(0===e.children.length)return;return ae.createElement("g",null,t.renderChildren(e,{route:s}))}return ae.createElement("g",{"class-elkedge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,s,t),this.renderAdditionals(e,s,t),t.renderChildren(e,{route:s}))}renderLine(e,t,s){var o,i,r,l;const a=t[1],d=t[0];let c=(0,n.angleOfPoint)({x:a.x-d.x,y:a.y-d.y});const u=t[t.length-2],h=t[t.length-1];let p=(0,n.angleOfPoint)({x:u.x-h.x,y:u.y-h.y}),g=this.getPathOffset(null===(i=null===(o=null==e?void 0:e.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.start,s,c),m=this.getPathOffset(null===(l=null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.shape)||void 0===l?void 0:l.end,s,p);const f=t[0];let v=`M ${f.x-g.x},${f.y-g.y}`;for(let e=1;e<t.length-1;e++){const s=t[e];v+=` L ${s.x},${s.y}`}const y=t[t.length-1];return v+=` L ${y.x-m.x}, ${y.y-m.y}`,ae.createElement("path",{d:v})}getAnchorOffset(e,t,s){let o=t.getConnector(e);if(null==o?void 0:o.symbol_offset){const e=o.symbol_offset;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}getPathOffset(e,t,s){let o=t.getConnector(e);if(null==o?void 0:o.path_offset){const e=o.path_offset;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}renderAdditionals(e,t,s){var o,i,r,l;let a,d,c,u=[],h=null===(i=null===(o=null==e?void 0:e.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.start,p=null===(l=null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.shape)||void 0===l?void 0:l.end;if(h){const e=t[1],o=t[0];let i=(0,n.angleOfPoint)({x:e.x-o.x,y:e.y-o.y});d=this.getAnchorOffset(h,s,i);let r=o.x-d.x,l=o.y-d.y;a=s.hrefID(h),c=ae.createElement("use",{href:"#"+a,"class-elkedge-start":!0,"class-elkarrow":!0,transform:`rotate(${(0,n.toDegrees)(i)} ${r} ${l}) translate(${r} ${l})`}),(0,n.setClass)(c,h,!0),u.push(c)}if(p){const e=t[t.length-2],o=t[t.length-1];let i=(0,n.angleOfPoint)({x:e.x-o.x,y:e.y-o.y});d=this.getAnchorOffset(p,s,i);let r=o.x-d.x,l=o.y-d.y;a=s.hrefID(p),c=ae.createElement("use",{href:"#"+a,"class-elkedge-end":!0,"class-elkarrow":!0,transform:`rotate(${(0,n.toDegrees)(i)} ${r} ${l}) translate(${r} ${l})`}),(0,n.setClass)(c,p,!0),u.push(c)}return u}};ce=le([(0,d.injectable)()],ce);let ue=class{render(e,t){var s,o;let i=(null===(s=e.position)||void 0===s?void 0:s.x)||0,n=(null===(o=e.position)||void 0===o?void 0:o.y)||0,r=e.size.width||0,l=e.size.height||0,a={class:{[e.id]:!0,elksymbol:!0}};return r&&l&&(a.viewBox=`${i} ${n} ${r} ${l}`),(0,M.svg)("symbol",a,t.renderChildren(e))}};ue=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],ue);class he extends n.SvgExporter{isExported(e){return null!=e.href&&(e.href.endsWith("diagram.css")||e.href.endsWith("sprotty.css"))}}var pe=s(9140);class ge extends n.MouseListener{constructor(){super(...arguments),this.isMouseDown=!1,this.isMouseDrag=!1}mouseDown(e,t){return this.isMouseDown=!0,[]}mouseMove(e,t){return this.isMouseDown&&(this.isMouseDrag=!0),[]}mouseUp(e,t){return this.isMouseDown=!1,this.isMouseDrag?(this.isMouseDrag=!1,this.draggingMouseUp(e,t)):this.nonDraggingMouseUp(e,t)}nonDraggingMouseUp(e,t){return[]}draggingMouseUp(e,t){return[]}}class me extends ge{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}mouseOver(e,t){return[new n.HoverFeedbackAction(e.id,!0)]}mouseOut(e,t){return[new n.HoverFeedbackAction(e.id,!1)]}}let fe=class{constructor(){this.elementTypeId="unknown",this.operationKind="generic"}get id(){return`tool_${this.operationKind}_${this.elementTypeId}`}enable(){}disable(){}dispatchFeedback(e){}};function ve(e){return e.id}fe=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,d.injectable)()],fe);var ye=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},we=function(e,t){return function(s,o){t(s,o,e)}};let Ee=class extends fe{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=n.SelectAction.KIND}enable(){this.selectionToolMouseListener=new Se(this.elementTypeId,this),this.mouseTool.register(this.selectionToolMouseListener)}disable(){this.mouseTool.deregister(this.selectionToolMouseListener)}};Ee=ye([(0,d.injectable)(),we(0,(0,d.inject)(n.MouseTool)),we(1,(0,d.inject)(c.IFeedbackActionDispatcher)),be("design:paramtypes",[Object,Object])],Ee);let Se=class extends me{constructor(e,t){super(e,t),this.elementTypeId=e,this.tool=t}nonDraggingMouseUp(e,t){let s=[],o=[];if(0===t.button&&!function(e){var t;return null===(t=null==e?void 0:e.classList)||void 0===t?void 0:t.contains("jupyter-widgets")}(t.target)){const i=(0,n.findParentByFeature)(e,n.isSelectable);(null!=i||e instanceof n.SModelRoot)&&((0,n.isCtrlOrCmd)(t)||(o=(0,pe.toArray)(e.root.index.all().filter((e=>(0,n.isSelectable)(e)&&e.selected&&!(i instanceof n.SRoutingHandle&&e===i.parent))))),null!=i&&(i.selected?(0,n.isCtrlOrCmd)(t)&&(o=[i]):s=[i]))}return[new n.SelectAction(s.map(ve),o.map(ve))]}decorate(e,t){const s=(0,n.findParentByFeature)(t,n.isSelectable);return null!=s&&(0,n.setClass)(e,"selected",s.selected),e}};Se=ye([(0,d.injectable)(),be("design:paramtypes",[String,Ee])],Se);var xe=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},Me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ke=function(e,t){return function(s,o){t(s,o,e)}};class Ce{constructor(e=[],t=[]){this.expandElementsIDs=e,this.contractElementsIDs=t,this.kind=n.SelectAction.KIND}}Ce.KIND="elementExpand";let _e=class extends fe{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=Ce.KIND}enable(){this.expansionToolMouseListener=new Oe(this.elementTypeId,this),this.mouseTool.register(this.expansionToolMouseListener)}disable(){this.mouseTool.deregister(this.expansionToolMouseListener)}dispatchFeedback(e){this.feedbackDispatcher.registerFeedback(this,e)}};_e=xe([(0,d.injectable)(),ke(0,(0,d.inject)(n.MouseTool)),ke(1,(0,d.inject)(c.IFeedbackActionDispatcher)),Me("design:paramtypes",[Object,Object])],_e);let Oe=class extends ge{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}wheel(e,t){return[]}decorate(e,t){const s=(0,n.findParentByFeature)(t,n.isSelectable);return null!=s&&(0,n.setClass)(e,"selected",s.selected),e}};Oe=xe([(0,d.injectable)(),Me("design:paramtypes",[String,_e])],Oe);class je extends a.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:je.model_name,_model_module_version:b.q4,overlay:null})}}je.model_name="ELKControlModel",je.serializers=Object.assign(Object.assign({},a.DOMWidgetModel.serializers),{overlay:{deserialize:a.unpack_models}});class Pe extends a.DOMWidgetModel{constructor(){super(...arguments),this.layoutUpdated=new l.Signal(this),this.diagramUpdated=new l.Signal(this)}defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:Pe.model_name,_model_module_version:b.q4,_view_module:b.A1,_view_name:Re.view_name,_view_module_version:b.q4,symbols:{},source:null,control_overlay:null})}initialize(e,t){super.initialize(e,t)}}Pe.model_name="ELKViewerModel",Pe.serializers=Object.assign(Object.assign({},a.DOMWidgetModel.serializers),{source:{deserialize:a.unpack_models},selection:{deserialize:a.unpack_models},hover:{deserialize:a.unpack_models},painter:{deserialize:a.unpack_models},zoom:{deserialize:a.unpack_models},pan:{deserialize:a.unpack_models},control_overlay:{deserialize:a.unpack_models}});class Re extends a.DOMWidgetView{constructor(){super(...arguments),this.was_shown=new r.PromiseDelegate,this.wait_for_visible=(e=!1)=>{this.luminoWidget.isVisible?setTimeout(this.wait_for_visible,e?0:300):this.was_shown.resolve()},this.resize=(e=-1,t=-1)=>{if(-1===e||-1===t){const s=this.el.getBoundingClientRect();e=s.width,t=s.height}this.source.resize({width:e,height:t,x:0,y:0})}}initialize(e){super.initialize(e),this.luminoWidget.addClass(b.gJ.widget_class),this.on("change:source",this.on_source_changed,this),this.on_source_changed()}async on_source_changed(){let e=this.model.get("source");e&&(e.on("change:value",this.diagramLayout,this),this.diagramLayout())}async render(){const e=this.el,t=document.createElement("div");this.div_id=t.id=De.next_id(),e.appendChild(t),this.initSprotty().catch(console.warn),this.wait_for_visible(!0)}async initSprotty(){await this.was_shown.promise;const e=((e,t)=>{const s=new d.ContainerModule(((t,s,o,i)=>{t(n.TYPES.ModelSource).to(x).inSingletonScope(),i(n.TYPES.ILogger).to(n.ConsoleLogger).inSingletonScope(),i(n.TYPES.LogLevel).toConstantValue(n.LogLevel.warn),i(n.TYPES.SvgExporter).to(he).inSingletonScope();const r={bind:t,unbind:s,isBound:o,rebind:i};(0,n.configureModelElement)(r,"graph",n.SGraph,Y),(0,n.configureModelElement)(r,"node",C,J),(0,n.configureModelElement)(r,"node:use",C,ee),(0,n.configureModelElement)(r,"node:diamond",C,G),(0,n.configureModelElement)(r,"node:round",C,q),(0,n.configureModelElement)(r,"node:image",C,X),(0,n.configureModelElement)(r,"node:comment",C,Z),(0,n.configureModelElement)(r,"node:path",C,Q),(0,n.configureModelElement)(r,"node:svg",C,te),(0,n.configureModelElement)(r,"node:html",C,ie),(0,n.configureModelElement)(r,"node:widget",C,ie),(0,n.configureModelElement)(r,"node:compartment",C,se),(0,n.configureModelElement)(r,"node:foreignobject",C,oe),(0,n.configureModelElement)(r,"port",_,ne),(0,n.configureModelElement)(r,"edge",O,ce),(0,n.configureModelElement)(r,"label",P,re),(0,n.configureModelElement)(r,"label:icon",P,re),(0,n.configureModelElement)(r,"junction",j,de),(0,n.configureViewerOptions)(r,{needsClientLayout:!1,baseDiv:e}),(0,n.configureCommand)(r,n.HoverFeedbackCommand),(0,n.configureModelElement)(r,"symbol",R,ue),i(n.TYPES.ModelRendererFactory).toFactory((e=>(t,s)=>{const o=e.container.get(n.TYPES.ViewRegistry),i=e.container.get(n.TYPES.ModelSource);return new D(o,t,s,i)})),i(n.TYPES.IModelFactory).to(I).inSingletonScope()})),o=new d.Container;return o.load(n.defaultModule,n.boundsModule,n.moveModule,n.fadeModule,T,n.undoRedoModule,B,n.routingModule,n.exportModule,n.modelSourceModule,n.edgeEditModule,n.labelEditModule,y,s),o})(this.div_id);this.container=e,this.source=e.get(n.TYPES.ModelSource),this.source.diagramWidget=this,this.source.widget_manager=this.model.widget_manager,this.source.factory=e.get(n.TYPES.IModelFactory),this.toolManager=e.get(n.TYPES.IToolManager),this.registry=e.get(n.ActionHandlerRegistry),this.actionDispatcher=e.get(n.TYPES.IActionDispatcher),this.feedbackDispatcher=e.get(c.IFeedbackActionDispatcher),this.model.on("change:selection",this.updateSelectedTool,this),this.model.on("change:hover",this.updateHoverTool,this),this.model.on("change:interaction",this.interaction_mode_changed,this),this.model.on("msg:custom",this.handleMessage,this),this.model.on("change:symbols",this.diagramLayout,this),this.model.on("change:control_overlay",this.updateControlOverlay,this),this.updateSelectedTool(),this.updateHoverTool(),this.updateControlOverlay(),this.touch(),this.registry.register(n.SelectAction.KIND,this),this.registry.register(n.SelectionResult.KIND,this),this.registry.register(n.HoverFeedbackAction.KIND,this),this.registry.register(n.SetModelAction.KIND,this),this.registry.register(n.UpdateModelAction.KIND,this),this.toolManager.registerDefaultTools(e.resolve(Ee),e.resolve(_e)),this.toolManager.enableDefaultTools(),this.diagramLayout().catch((e=>console.warn("ELK Failed initial view render",e))),setTimeout((()=>{this.resize()}),3e3)}updateControlOverlay(){let e=this.model.get("control_overlay");this.source.control_overlay=e}processPhosphorMessage(e){this.processLuminoMessage(e)}processLuminoMessage(e){switch(super.processLuminoMessage(e),e.type){case"resize":const t=e;let{width:s,height:o}=t;this.resize(s,o);break;case"after-show":this.resize()}}handle(e){switch(e.kind){case n.SelectAction.KIND:this.source.getSelection().then((e=>{let t=[],s=[];e.forEach(((e,o)=>{t.push(e.id),s.push(e)}));let o=this.model.get("selection");null!=o&&(o.set("ids",t),o.save_changes(),this.setSelectedNodes(t),this.model.diagramUpdated.emit(void 0))}));break;case n.SelectionResult.KIND:break;case n.HoverFeedbackAction.KIND:let t=e;if(t.mouseIsOver){let e=this.model.get("hover");null!=e&&(e.set("ids",t.mouseoverElement),e.save_changes(),this.model.diagramUpdated.emit(void 0))}break;case n.SetModelAction.KIND:let s=e;const{newRoot:o}=s;o&&(this.currentRoot=o);case n.UpdateModelAction.KIND:}}updateSelectedTool(){let e=this.model.get("selection");null!=e&&e.on("change:ids",this.updateSelected,this)}async updateSelected(){let e=this.model.get("selection");if(null!=e){let t=e.get("ids"),s=e.previous("ids"),o=i()(s,t),r=i()(t,s);await this.actionDispatcher.dispatch(new n.SelectAction(r,o)),this.setSelectedNodes(t),this.model.diagramUpdated.emit(void 0)}}async setSelectedNodes(e){this.source.selectedNodes=e.map((e=>this.source.index.getById(e)))}updateHoverTool(){let e=this.model.get("hover");null!=e&&e.on("change:ids",this.updateHover,this)}async updateHover(){let e=this.model.get("hover");if(null!=e){let t=e.get("ids"),s=e.previous("ids");await this.actionDispatcher.dispatchAll([new n.HoverFeedbackAction(t,!0),new n.HoverFeedbackAction(s,!1)]),this.model.diagramUpdated.emit(void 0)}}async interaction_mode_changed(){}async diagramLayout(){var e;let t=null===(e=this.model.get("source"))||void 0===e?void 0:e.get("value"),s=this.model.get("symbols");if(null==t||null==s||null==this.source)return null;await this.source.updateLayout(t,s,this.div_id),this.model.layoutUpdated.emit(),this.model.diagramUpdated.emit()}normalizeElementIds(e){let t=[];return null!=e&&(t=Array.isArray(e)?e:[e]),t}handleMessage(e){switch(e.action){case"center":this.resize(),this.source.center(this.normalizeElementIds(e.model_id),e.animate,e.retain_zoom);break;case"fit":this.resize(),this.source.fit(this.normalizeElementIds(e.model_id),null==e.padding?0:e.padding,null==e.max_zoom?1/0:e.max_zoom,null==e.animate||e.animate);break;default:console.warn("ELK unhandled message",e)}}}var De;Re.view_name="ELKViewerView",function(e){let t=0;e.next_id=function(){return"sprotty_"+t++}}(De||(De={}))}}]);