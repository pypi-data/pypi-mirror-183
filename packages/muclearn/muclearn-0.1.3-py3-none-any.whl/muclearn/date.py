import datetime
import holidays
import json
import pandas as pd

__seasons = [
    range(80, 172),   # Spring
    range(172, 264),  # Summer
    range(264, 355)   # Fall
]
__de_by_holidays = holidays.country_holidays("DE", subdiv="BY")

# with open("ferien_by.json", "r") as file:
#    __ferien_by = json.load(file, parse_int=True)
    
__ferien_by = {"1946": {"Sommer": ["1946-07-16", "1946-09-02"]}, "1947": {"Sommer": ["1947-07-18", "1947-09-01"]}, "1948": {"Sommer": ["1948-07-15", "1948-08-31"]}, "1949": {"Sommer": ["1949-07-15", "1949-08-31"]}, "1950": {"Sommer": ["1950-07-14", "1950-08-31"]}, "1951": {"Sommer": ["1951-07-18", "1951-09-03"]}, "1952": {"Sommer": ["1952-07-16", "1952-09-02"]}, "1953": {"Sommer": ["1953-07-15", "1953-09-02"]}, "1954": {"Sommer": ["1954-07-14", "1954-08-31"]}, "1955": {"Sommer": ["1955-07-16", "1955-08-31"]}, "1956": {"Sommer": ["1956-07-20", "1956-09-03"]}, "1957": {"Sommer": ["1957-07-19", "1957-09-02"]}, "1958": {"Sommer": ["1958-07-18", "1958-09-01"], "Allerheiligen": ["1958-11-03", "1958-11-03"], "Weihnachten": ["1958-12-24", "1959-01-07"]}, "1959": {"Ostern": ["1959-03-21", "1959-04-06"], "Pfingsten": ["1959-05-16", "1959-05-20"], "Sommer": ["1959-07-16", "1959-09-02"], "Allerheiligen": ["1959-11-03", "1959-11-03"], "Weihnachten": ["1959-12-23", "1960-01-07"]}, "1960": {"Ostern": ["1960-04-09", "1960-04-24"], "Pfingsten": ["1960-06-04", "1960-06-08"], "Sommer": ["1960-07-14", "1960-08-30"], "Allerheiligen": ["1960-10-29", "1960-11-03"], "Weihnachten": ["1960-12-23", "1961-01-09"]}, "1961": {"Ostern": ["1961-03-25", "1961-04-10"], "Pfingsten": ["1961-05-20", "1961-05-28"], "Sommer": ["1961-07-20", "1961-09-04"], "Allerheiligen": ["1961-11-30", "1961-11-02"], "Weihnachten": ["1961-12-22", "1962-01-08"]}, "1962": {"Ostern": ["1962-04-14", "1962-05-02"], "Pfingsten": ["1962-05-09", "1962-05-17"], "Sommer": ["1962-07-19", "1962-09-03"], "Allerheiligen": ["1962-10-31", "1962-11-03"], "Weihnachten": ["1962-12-22", "1963-01-07"]}, "1963": {"Ostern": ["1963-04-06", "1963-04-22"], "Pfingsten": ["1963-06-01", "1963-06-09"], "Sommer": ["1963-07-18", "1963-09-02"], "Allerheiligen": ["1963-10-30", "1963-11-02"], "Weihnachten": ["1963-12-21", "1964-01-07"]}, "1964": {"Ostern": ["1964-03-19", "1964-04-06"], "Pfingsten": ["1964-05-16", "1964-05-24"], "Sommer": ["1964-07-23", "1964-09-08"], "Allerheiligen": ["1964-10-30", "1964-11-02"], "Weihnachten": ["1964-12-23", "1965-01-07"]}, "1965": {"Ostern": ["1965-04-10", "1965-04-26"], "Pfingsten": ["1965-06-05", "1965-06-13"], "Sommer": ["1965-07-21", "1965-09-06"], "Allerheiligen": ["1965-10-30", "1965-11-02"], "Weihnachten": ["1965-12-23", "1966-01-10"]}, "1966": {"Ostern": ["1966-04-02", "1966-04-18"], "Pfingsten": ["1966-05-28", "1966-06-06"], "Sommer": ["1966-07-20", "1966-09-05"], "Allerheiligen": ["1966-10-31", "1966-11-02"], "Weihnachten": ["1966-12-22", "1967-01-09"]}, "1967": {"Ostern": ["1967-03-18", "1967-04-03"], "Pfingsten": ["1967-05-13", "1967-05-22"], "Sommer": ["1967-07-22", "1967-09-06"], "Allerheiligen": ["1967-10-31", "1967-11-02"], "Weihnachten": ["1967-12-21", "1968-01-08"]}, "1968": {"Ostern": ["1968-04-06", "1968-04-22"], "Pfingsten": ["1968-06-01", "1968-06-10"], "Sommer": ["1968-07-24", "1968-09-10"], "Allerheiligen": ["1968-10-31", "1968-11-02"], "Weihnachten": ["1968-12-20", "1969-01-07"]}, "1969": {"Ostern": ["1969-03-29", "1969-04-14"], "Pfingsten": ["1969-05-24", "1969-06-02"], "Sommer": ["1969-07-24", "1969-09-10"], "Allerheiligen": ["1969-10-30", "1969-11-03"], "Weihnachten": ["1969-12-20", "1970-07-07"]}, "1970": {"Ostern": ["1970-03-21", "1970-04-06"], "Pfingsten": ["1970-05-16", "1970-05-25"], "Sommer": ["1970-07-23", "1970-09-09"], "Allerheiligen": ["1970-10-30", "1970-11-03"], "Weihnachten": ["1970-12-23", "1971-01-11"]}, "1971": {"Ostern": ["1971-04-03", "1971-04-19"], "Pfingsten": ["1971-05-29", "1971-06-07"], "Sommer": ["1971-07-22", "1971-09-06"], "Allerheiligen": ["1971-10-30", "1971-11-02"], "Weihnachten": ["1971-12-22", "1972-01-10"]}, "1972": {"Ostern": ["1972-03-25", "1972-04-10"], "Pfingsten": ["1972-05-20", "1972-05-29"], "Sommer": ["1972-08-03", "1972-09-18"], "Allerheiligen": ["1972-10-30", "1972-11-04"], "Weihnachten": ["1972-12-22", "1973-01-08"]}, "1973": {"Ostern": ["1973-04-16", "1973-04-30"], "Pfingsten": ["1973-06-12", "1973-06-23"], "Sommer": ["1973-07-26", "1973-09-12"], "Allerheiligen": ["1973-10-31", "1973-11-02"], "Weihnachten": ["1973-12-22", "1974-01-07"]}, "1974": {"Ostern": ["1974-04-08", "1974-04-20"], "Pfingsten": ["1974-06-04", "1974-06-15"], "Sommer": ["1974-07-31", "1974-09-16"], "Allerheiligen": ["1974-10-31", "1974-10-31"], "Weihnachten": ["1974-12-23", "1975-01-11"]}, "1975": {"Ostern": ["1975-03-24", "1975-04-05"], "Pfingsten": ["1975-05-20", "1975-05-31"], "Sommer": ["1975-07-24", "1975-09-10"], "Allerheiligen": ["1975-10-31", "1975-10-31"], "Weihnachten": ["1975-12-22", "1976-01-09"]}, "1976": {"Ostern": ["1976-04-12", "1976-04-24"], "Pfingsten": ["1976-06-08", "1976-06-19"], "Sommer": ["1976-07-29", "1976-06-15"], "Allerheiligen": ["1976-11-02", "1976-11-02"], "Weihnachten": ["1976-12-23", "1977-01-08"]}, "1977": {"Ostern": ["1977-04-04", "1977-04-16"], "Pfingsten": ["1977-05-31", "1977-06-11"], "Sommer": ["1977-07-28", "1977-09-14"], "Allerheiligen": ["1977-10-31", "1977-11-02"], "Weihnachten": ["1977-12-23", "1978-01-07"]}, "1978": {"Ostern": ["1978-03-20", "1978-04-01"], "Pfingsten": ["1978-05-16", "1978-05-27"], "Sommer": ["1978-07-27", "1978-09-13"], "Allerheiligen": ["1978-10-30", "1978-11-02"], "Weihnachten": ["1978-12-22", "1979-01-08"]}, "1979": {"Ostern": ["1979-04-09", "1979-04-21"], "Pfingsten": ["1979-06-05", "1979-06-16"], "Sommer": ["1979-08-01", "1979-09-17"], "Allerheiligen": ["1979-10-31", "1979-11-02"], "Weihnachten": ["1979-12-21", "1980-01-08"]}, "1980": {"Ostern": ["1980-03-31", "1980-04-12"], "Pfingsten": ["1980-05-27", "1980-06-07"], "Sommer": ["1980-07-31", "1980-09-15"], "Allerheiligen": ["1980-10-30", "1980-10-31"], "Weihnachten": ["1980-12-22", "1981-01-10"]}, "1981": {"Ostern": ["1981-04-13", "1981-04-25"], "Pfingsten": ["1981-06-06", "1981-06-20"], "Sommer": ["1981-07-30", "1981-09-14"], "Allerheiligen": ["1981-10-30", "1981-11-02"], "Weihnachten": ["1981-12-23", "1982-01-11"]}, "1982": {"Ostern": ["1982-04-05", "1982-04-17"], "Pfingsten": ["1982-06-01", "1982-06-12"], "Sommer": ["1982-07-29", "1982-09-13"], "Allerheiligen": ["1982-11-02", "1982-11-02"], "Weihnachten": ["1982-12-23", "1983-01-11"]}, "1983": {"Ostern": ["1983-03-28", "1983-04-09"], "Pfingsten": ["1983-05-24", "1983-06-04"], "Sommer": ["1983-07-28", "1983-09-12"], "Allerheiligen": ["1983-10-31", "1983-11-02"], "Weihnachten": ["1983-12-23", "1984-01-09"]}, "1984": {"Ostern": ["1984-04-16", "1984-04-30"], "Pfingsten": ["1984-06-12", "1984-06-23"], "Sommer": ["1984-08-01", "1984-09-17"], "Allerheiligen": ["1984-10-31", "1984-11-02"], "Weihnachten": ["1984-12-24", "1985-01-08"]}, "1985": {"Ostern": ["1985-04-01", "1985-04-13"], "Pfingsten": ["1985-05-28", "1985-05-08"], "Sommer": ["1985-08-01", "1985-09-16"], "Weihnachten": ["1985-12-23", "1986-01-11"]}, "1986": {"Ostern": ["1986-03-24", "1986-04-05"], "Pfingsten": ["1986-05-20", "1986-05-31"], "Sommer": ["1986-07-31", "1986-09-15"], "Allerheiligen": ["1986-10-31", "1986-10-31"], "Weihnachten": ["1986-12-22", "1987-01-10"]}, "1987": {"Ostern": ["1987-04-13", "1987-04-25"], "Pfingsten": ["1987-06-09", "1987-06-20"], "Sommer": ["1987-07-30", "1987-09-14"], "Allerheiligen": ["1987-11-02", "1987-11-03"], "Weihnachten": ["1987-12-23", "1988-01-09"]}, "1988": {"Ostern": ["1988-03-28", "1988-04-09"], "Pfingsten": ["1988-05-24", "1988-06-04"], "Sommer": ["1988-07-21", "1988-09-05"], "Allerheiligen": ["1988-10-31", "1988-11-04"], "Weihnachten": ["1988-12-27", "1989-01-07"]}, "1989": {"Ostern": ["1989-03-20", "1989-04-01"], "Pfingsten": ["1989-05-16", "1989-05-27"], "Sommer": ["1989-07-27", "1989-09-11"], "Allerheiligen": ["1989-10-30", "1989-11-03"], "Weihnachten": ["1989-12-22", "1990-01-05"]}, "1990": {"Ostern": ["1990-04-09", "1990-04-21"], "Pfingsten": ["1990-06-05", "1990-06-16"], "Sommer": ["1990-07-26", "1990-09-10"], "Allerheiligen": ["1990-10-31", "1990-11-02"], "Weihnachten": ["1990-12-21", "1991-01-07"]}, "1991": {"Ostern": ["1991-03-25", "1991-04-06"], "Pfingsten": ["1991-05-21", "1991-06-01"], "Sommer": ["1991-07-25", "1991-09-09"], "Allerheiligen": ["1991-10-28", "1991-11-02"], "Weihnachten": ["1991-12-23", "1992-01-04"]}, "1992": {"Ostern": ["1992-04-13", "1992-04-25"], "Pfingsten": ["1992-06-09", "1992-06-20"], "Sommer": ["1992-07-30", "1992-09-14"], "Allerheiligen": ["1992-11-02", "1992-11-03"], "Weihnachten": ["1992-12-23", "1993-01-09"]}, "1993": {"Ostern": ["1993-04-05", "1993-04-17"], "Pfingsten": ["1993-06-01", "1993-06-12"], "Sommer": ["1993-07-22", "1993-09-06"], "Allerheiligen": ["1993-11-02", "1993-11-02"], "Weihnachten": ["1993-12-23", "1994-01-08"]}, "1994": {"Ostern": ["1994-03-28", "1994-04-09"], "Pfingsten": ["1994-05-24", "1994-06-04"], "Sommer": ["1994-07-28", "1994-09-12"], "Allerheiligen": ["1994-10-31", "1994-11-04"], "Weihnachten": ["1994-12-27", "1995-01-07"]}, "1995": {"Ostern": ["1995-04-10", "1995-04-22"], "Pfingsten": ["1995-06-06", "1995-06-17"], "Sommer": ["1995-07-27", "1995-09-11"], "Allerheiligen": ["1995-10-30", "1995-11-04"], "Weihnachten": ["1995-12-27", "1996-01-08"]}, "1996": {"Ostern": ["1996-04-01", "1996-04-13"], "Pfingsten": ["1996-05-28", "1996-06-08"], "Sommer": ["1996-08-01", "1996-09-16"], "Allerheiligen": ["1996-10-28", "1996-11-02"], "Weihnachten": ["1996-12-23", "1997-01-04"]}, "1997": {"Ostern": ["1997-03-24", "1997-04-05"], "Pfingsten": ["1997-05-20", "1997-05-31"], "Sommer": ["1997-07-31", "1997-09-15"], "Allerheiligen": ["1997-10-27", "1997-10-31"], "Weihnachten": ["1997-12-23", "1998-01-05"]}, "1998": {"Ostern": ["1998-04-06", "1998-04-18"], "Pfingsten": ["1998-06-02", "1998-06-13"], "Sommer": ["1998-07-30", "1998-09-14"], "Allerheiligen": ["1998-11-02", "1998-11-07"], "Weihnachten": ["1998-12-24", "1999-01-05"]}, "1999": {"Ostern": ["1999-03-29", "1999-04-10"], "Pfingsten": ["1999-05-25", "1999-06-05"], "Sommer": ["1999-07-29", "1999-09-13"], "Allerheiligen": ["1999-11-02", "1999-11-05"], "Weihnachten": ["1999-12-24", "2000-01-07"]}, "2000": {"Ostern": ["2000-04-17", "2000-04-29"], "Pfingsten": ["2000-06-13", "2000-06-24"], "Sommer": ["2000-07-27", "2000-09-11"], "Allerheiligen": ["2000-10-30", "2000-11-04"], "Weihnachten": ["2000-12-27", "2001-01-08"]}, "2001": {"Ostern": ["2001-04-09", "2001-04-21"], "Pfingsten": ["2001-06-05", "2001-06-16"], "Sommer": ["2001-07-26", "2001-09-10"], "Allerheiligen": ["2001-10-29", "2001-11-03"], "Weihnachten": ["2001-12-24", "2002-01-05"]}, "2002": {"Ostern": ["2002-03-25", "2002-04-06"], "Pfingsten": ["2002-05-21", "2002-06-01"], "Sommer": ["2002-08-01", "2002-09-16"], "Allerheiligen": ["2002-10-28", "2002-11-02"], "Weihnachten": ["2002-12-23", "2003-01-04"]}, "2003": {"Ostern": ["2003-04-14", "2003-04-26"], "Pfingsten": ["2003-06-10", "2003-06-21"], "Sommer": ["2003-07-28", "2003-09-08"], "Allerheiligen": ["2003-10-27", "2003-10-31"], "Weihnachten": ["2003-12-24", "2004-01-07"], "Fr\\u00fchjahr": ["2003-03-03", "2003-03-07"]}, "2004": {"Ostern": ["2004-04-05", "2004-04-17"], "Pfingsten": ["2004-06-01", "2004-06-12"], "Sommer": ["2004-08-02", "2004-09-13"], "Allerheiligen": ["2004-11-02", "2004-11-06"], "Weihnachten": ["2004-12-24", "2005-01-04"], "Fr\\u00fchjahr": ["2004-02-23", "2004-02-27"]}, "2005": {"Ostern": ["2005-03-21", "2005-04-02"], "Pfingsten": ["2005-05-17", "2005-05-28"], "Sommer": ["2005-08-01", "2005-09-12"], "Allerheiligen": ["2005-10-31", "2005-11-05"], "Weihnachten": ["2005-12-27", "2006-01-05"], "Fr\\u00fchjahr": ["2005-02-07", "2005-02-11"]}, "2006": {"Ostern": ["2006-04-10", "2006-04-22"], "Pfingsten": ["2006-06-06", "2006-06-17"], "Sommer": ["2006-07-31", "2006-09-11"], "Allerheiligen": ["2006-10-30", "2006-11-04"], "Weihnachten": ["2006-12-27", "2007-01-05"], "Fr\\u00fchjahr": ["2006-02-27", "2006-03-03"]}, "2007": {"Ostern": ["2007-04-02", "2007-04-14"], "Pfingsten": ["2007-05-29", "2007-06-09"], "Sommer": ["2007-07-30", "2007-09-10"], "Allerheiligen": ["2007-10-29", "2007-11-03"], "Weihnachten": ["2007-12-24", "2008-01-05"], "Fr\\u00fchjahr": ["2007-02-19", "2007-02-24"]}, "2008": {"Ostern": ["2008-03-17", "2008-03-29"], "Pfingsten": ["2008-05-13", "2008-05-24"], "Sommer": ["2008-08-04", "2008-09-15"], "Allerheiligen": ["2008-11-03", "2008-11-07"], "Weihnachten": ["2008-12-22", "2009-01-05"], "Fr\\u00fchjahr": ["2008-02-04", "2008-02-09"]}, "2009": {"Ostern": ["2009-04-06", "2009-04-18"], "Pfingsten": ["2009-06-02", "2009-06-13"], "Sommer": ["2009-08-03", "2009-09-14"], "Allerheiligen": ["2009-11-02", "2009-11-07"], "Weihnachten": ["2009-12-24", "2010-01-05"], "Fr\\u00fchjahr": ["2009-02-23", "2009-02-28"]}, "2010": {"Ostern": ["2010-03-29", "2010-04-10"], "Pfingsten": ["2010-05-25", "2010-06-05"], "Sommer": ["2010-08-02", "2010-09-13"], "Allerheiligen": ["2010-11-02", "2010-11-05"], "Weihnachten": ["2010-12-24", "2011-01-07"], "Fr\\u00fchjahr": ["2010-02-15", "2010-02-20"]}, "2011": {"Ostern": ["2011-04-18", "2011-04-30"], "Pfingsten": ["2011-06-14", "2011-06-25"], "Sommer": ["2011-08-01", "2011-09-12"], "Allerheiligen": ["2011-10-31", "2011-11-05"], "Weihnachten": ["2011-12-27", "2012-01-05"], "Fr\\u00fchjahr": ["2011-03-07", "2011-03-11"]}, "2012": {"Ostern": ["2012-04-02", "2012-04-14"], "Pfingsten": ["2012-05-29", "2012-06-09"], "Sommer": ["2012-08-01", "2012-09-12"], "Allerheiligen": ["2012-10-29", "2012-11-03"], "Weihnachten": ["2012-12-24", "2013-01-05"], "Fr\\u00fchjahr": ["2012-02-20", "2012-02-24"]}, "2013": {"Ostern": ["2013-03-25", "2013-04-06"], "Pfingsten": ["2013-05-21", "2013-05-31"], "Sommer": ["2013-07-31", "2013-09-11"], "Allerheiligen": ["2013-10-28", "2013-10-31"], "Weihnachten": ["2013-12-23", "2014-01-04"], "Fr\\u00fchjahr": ["2013-02-11", "2013-02-15"]}, "2014": {"Ostern": ["2014-04-14", "2014-04-26"], "Pfingsten": ["2014-06-10", "2014-06-21"], "Sommer": ["2014-07-30", "2014-09-15"], "Allerheiligen": ["2014-10-27", "2014-10-31"], "Weihnachten": ["2014-12-24", "2015-01-05"], "Fr\\u00fchjahr": ["2014-03-03", "2014-03-07"]}, "2015": {"Ostern": ["2015-03-30", "2015-04-11"], "Pfingsten": ["2015-05-26", "2015-06-05"], "Sommer": ["2015-08-01", "2015-09-14"], "Allerheiligen": ["2015-11-02", "2015-11-07"], "Weihnachten": ["2015-12-28", "2016-01-05"], "Fr\\u00fchjahr": ["2015-02-16", "2015-02-20"]}, "2016": {"Ostern": ["2016-03-21", "2016-04-01"], "Pfingsten": ["2016-05-17", "2016-05-28"], "Sommer": ["2016-07-30", "2016-09-12"], "Allerheiligen": ["2016-11-02", "2016-11-04"], "Weihnachten": ["2016-12-24", "2017-01-05"], "Fr\\u00fchjahr": ["2016-02-08", "2016-02-12"]}, "2017": {"Ostern": ["2017-04-10", "2017-04-22"], "Pfingsten": ["2017-06-06", "2017-06-16"], "Sommer": ["2017-07-29", "2017-09-11"], "Allerheiligen": ["2017-10-30", "2017-11-02"], "Weihnachten": ["2017-12-23", "2018-01-05"], "Fr\\u00fchjahr": ["2017-02-27", "2017-03-03"]}, "2018": {"Ostern": ["2018-03-26", "2018-04-07"], "Pfingsten": ["2018-05-22", "2018-06-02"], "Sommer": ["2018-07-30", "2018-09-10"], "Allerheiligen": ["2018-10-29", "2018-11-02"], "Weihnachten": ["2018-12-22", "2019-01-05"], "Fr\\u00fchjahr": ["2018-02-12", "2018-02-16"]}, "2019": {"Ostern": ["2019-04-15", "2019-04-27"], "Pfingsten": ["2019-06-11", "2019-06-21"], "Sommer": ["2019-07-29", "2019-09-09"], "Allerheiligen": ["2019-10-28", "2019-10-31"], "Weihnachten": ["2019-12-24", "2020-01-04"], "Fr\\u00fchjahr": ["2019-02-04", "2019-02-08"]}, "2020": {"Ostern": ["2020-04-06", "2020-04-18"], "Pfingsten": ["2020-06-02", "2020-06-13"], "Sommer": ["2020-07-27", "2020-09-07"], "Allerheiligen": ["2020-10-31", "2020-11-06"], "Weihnachten": ["2020-12-23", "2021-01-09"], "Fr\\u00fchjahr": ["2020-02-24", "2020-02-28"]}}

def calculate_datetime_features(df, column="datetime", start_year=None):
    """
    Calculates features which can be derived from standard datetime on a dataframe and return it.
    
    Current features are:
    - hour
    - weekday
    - month
    - season
    - year
    - Bavarian holidays (german: "Bayerische Feiertage") including days before (pre_) and after (post_)
    - Bavarian school holidays (german: "Bayerische Schulferien") ()
    
    Keyword arguments:
    column -- the datetime column in the passed dataframe
    """
    datetime_column = df[column]
    if start_year is None:
        start_year = datetime_column.dt.year.min()
    df = df.assign(
        hour = datetime_column.dt.hour,
        weekday = datetime_column.dt.weekday,
        month = datetime_column.dt.month,
        season = datetime_column.dt.dayofyear.apply(__calculate_season),
        year = datetime_column.dt.year - start_year,
        pre_holiday = datetime_column.dt.date.apply(__calculate_holiday, offset=-1),
        holiday = datetime_column.dt.date.apply(__calculate_holiday),
        post_holiday = datetime_column.dt.date.apply(__calculate_holiday, offset=1),
        ferien_by = datetime_column.dt.date.apply(__calculate_ferien),
    )
    return df


def __calculate_season(dayofyear):
    for season, i in zip(__seasons, range(len(__seasons))):
        if dayofyear in season:
            return i
    return 3  # Winter


def __calculate_holiday(date, offset=0):
    return int(date - datetime.timedelta(days=offset) in __de_by_holidays)
        
    
def __calculate_ferien(date):
    year_index = date.year
    if date.month == 1:
        year_index -= 1
    if str(year_index) not in __ferien_by.keys():
        return 0
    for start, end in __ferien_by[str(year_index)].values():
        if date >= datetime.date.fromisoformat(start) and date <= datetime.date.fromisoformat(end):
            return 1
    if date.weekday() == 5:
        before = __calculate_ferien(date + datetime.timedelta(days=2))
        after = __calculate_ferien(date - datetime.timedelta(days=1))
        if before or after:
            return 1
    if date.weekday() == 6:
        before = __calculate_ferien(date + datetime.timedelta(days=1))
        after = __calculate_ferien(date - datetime.timedelta(days=2))
        if before or after:
            return 1
    return 0