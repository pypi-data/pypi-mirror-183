define(["@jupyter-widgets/base"],(e=>(()=>{"use strict";var n,t,o,r,i,s,a,u,c,_,d,l,b,p,f,g,m,v,h,w,x,y,j,k,S,O,V,E,A,F,M,W,q,P,T,D,C,L,N,R,U,I,z,B,J,X,Y,$,G,H,K,Q,Z,ee,ne,te,oe,re,ie,se,ae,ue,ce,_e,de,le={820:(e,n,t)=>{t.r(n),t.d(n,{MODULE_NAME:()=>i,MODULE_VERSION:()=>r,VegaFusionModel:()=>a,VegaFusionView:()=>u});const o=t(147),r=o.version,i=o.name;var s=t(146);class a extends s.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:a.model_name,_model_module:a.model_module,_model_module_version:a.model_module_version,_view_name:a.view_name,_view_module:a.view_module,_view_module_version:a.view_module_version,spec:null,full_vega_spec:null,client_vega_spec:null,server_vega_spec:null,vegafusion_handle:null,verbose:null,debounce_wait:30,debounce_max_wait:60,download_source_link:null,_request_msg:null,_response_msg:null})}}a.serializers=Object.assign(Object.assign({},s.DOMWidgetModel.serializers),{_request_msg:{serialize:e=>e.buffer?new DataView(e.buffer.slice(0)):null}}),a.model_name="VegaFusionModel",a.model_module=i,a.model_module_version=r,a.view_name="VegaFusionView",a.view_module=i,a.view_module_version=r;class u extends s.DOMWidgetView{async render(){const{embedVegaFusion:e}=await t.e(876).then(t.bind(t,876));this.embedVegaFusion=e;const{compile:n}=await t.e(647).then(t.bind(t,647));this.vegalite_compile=n,this.value_changed(),this.model.on("change:spec",this.value_changed,this),this.model.on("change:verbose",this.value_changed,this),this.model.on("change:debounce_wait",this.value_changed,this),this.model.on("change:debounce_max_wait",this.value_changed,this),this.model.on("change:download_source_link",this.value_changed,this),this.model.on("change:_response_msg",(()=>{const e=this.model.get("_response_msg");if(null!==e){this.model.get("verbose")&&(console.log("VegaFusion(js): Received response"),console.log(e.buffer));const n=new Uint8Array(e.buffer);this.vegafusion_handle.receive(n)}}))}value_changed(){let e=this.model.get("spec");if(null!==e){let n,t=JSON.parse(e);if(t.$schema.endsWith("schema/vega/v5.json"))n=e;else{let e=this.vegalite_compile(t);n=JSON.stringify(e.spec,null,2)}let o={verbose:this.model.get("verbose")||!1,debounce_wait:this.model.get("debounce_wait")||30,debounce_max_wait:this.model.get("debounce_max_wait"),download_source_link:this.model.get("download_source_link")};this.vegafusion_handle=this.embedVegaFusion(this.el,n,(e=>{this.model.get("verbose")&&console.log("VegaFusion(js): Send request"),this.model.set("_request_msg",new DataView(e.buffer)),this.touch(),this.model.set("_request_msg",{})}),o),this.model.set("full_vega_spec",n),this.model.set("client_vega_spec",this.vegafusion_handle.client_spec_json()),this.model.set("server_vega_spec",this.vegafusion_handle.server_spec_json()),this.model.set("comm_plan",this.vegafusion_handle.comm_plan_json()),this.touch()}}}window.__webpack_public_path__=document.querySelector("body").getAttribute("data-base-url")+"nbextensions/vegafusion-jupyter/"},146:n=>{n.exports=e},147:e=>{e.exports=JSON.parse('{"name":"vegafusion-jupyter","version":"0.11.0-rc11","description":"Altair Jupyter Widget library that relies on VegaFusion for serverside calculations","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","dist/*.wasm","css/*.css","css/*.scss","images/*.svg"],"homepage":"https://github.com/vegafusion/vegafusion","bugs":{"url":"https://github.com/vegafusion/vegafusion/issues"},"license":"AGPL-3.0-or-later","author":{"name":"VegaFusion Technologies LLC","email":"jon@vegafusion.io"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/jonmmease/vegafusion"},"scripts":{"build:dev":"npm run build:lib && npm run build:nbextension && npm run build:labextension:dev && pip install --force-reinstall --no-deps .","build:prod":"npm run clean && npm run build:lib && npm run build:nbextension && npm run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc && sass scss:css","build:nbextension":"webpack","clean":"npm run clean:lib && npm run clean:dist && npm run clean:nbextension && npm run clean:labextension","clean:dist":"rimraf dist","clean:lib":"rimraf lib","clean:labextension":"rimraf vegafusion_jupyter/labextension","clean:nbextension":"rimraf vegafusion_jupyter/nbextension/* && cp src/nbextension/extension.js vegafusion_jupyter/nbextension/","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"npm run build:prod","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","@jupyterlab/notebook":"^3.0.0 || ^4.0.0","marked":"^4.0.10","vega-lite":"^4.17.0","vegafusion-embed":"../../javascript/vegafusion-embed","vegafusion-wasm":"../../vegafusion-wasm/pkg"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"6.5.1","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","sass":"^1.45.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","svg-inline-loader":"^0.8.2","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.65.0","webpack-cli":"^4.9.1","webpack-require-from":"^1.8.6"},"jupyterlab":{"extension":"lib/plugin","outputDir":"vegafusion_jupyter/labextension/","webpackConfig":"webpack.config.experimental.js","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}},be={};function pe(e){var n=be[e];if(void 0!==n)return n.exports;var t=be[e]={id:e,loaded:!1,exports:{}};return le[e].call(t.exports,t,t.exports,pe),t.loaded=!0,t.exports}return pe.m=le,pe.c=be,n="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",o=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},r=e=>!--e.r&&e(),i=(e,n)=>e?e.push(n):r(n),pe.a=(e,s,a)=>{var u,c,_,d=a&&[],l=e.exports,b=!0,p=!1,f=(e,t,o)=>{p||(p=!0,t.r+=e.length,e.map(((e,r)=>e[n](t,o))),p=!1)},g=new Promise(((e,n)=>{_=n,c=()=>(e(l),o(d),d=0)}));g[t]=l,g[n]=(e,n)=>{if(b)return r(e);u&&f(u,e,n),i(d,e),g.catch(n)},e.exports=g,s((e=>{if(!e)return c();var s,a;u=(e=>e.map((e=>{if(null!==e&&"object"==typeof e){if(e[n])return e;if(e.then){var s=[];e.then((e=>{a[t]=e,o(s),s=0}));var a={};return a[n]=(n,t)=>(i(s,n),e.catch(t)),a}}var u={};return u[n]=e=>r(e),u[t]=e,u})))(e);var _=new Promise(((e,n)=>{(s=()=>e(a=u.map((e=>e[t])))).r=0,f(u,s,n)}));return s.r?_:a})).then(c,_),b=!1},pe.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return pe.d(n,{a:n}),n},pe.d=(e,n)=>{for(var t in n)pe.o(n,t)&&!pe.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},pe.f={},pe.e=e=>Promise.all(Object.keys(pe.f).reduce(((n,t)=>(pe.f[t](e,n),n)),[])),pe.u=e=>e+".index.js",pe.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),pe.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),pe.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),s={},a="vegafusion-jupyter:",pe.l=(e,n,t,o)=>{if(s[e])s[e].push(n);else{var r,i;if(void 0!==t)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var _=u[c];if(_.getAttribute("src")==e||_.getAttribute("data-webpack")==a+t){r=_;break}}r||(i=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,pe.nc&&r.setAttribute("nonce",pe.nc),r.setAttribute("data-webpack",a+t),r.src=e),s[e]=[n];var d=(n,t)=>{r.onerror=r.onload=null,clearTimeout(l);var o=s[e];if(delete s[e],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach((e=>e(t))),n)return n(t)},l=setTimeout(d.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=d.bind(null,r.onerror),r.onload=d.bind(null,r.onload),i&&document.head.appendChild(r)}},pe.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},pe.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),pe.p="",Object.defineProperty(pe,"p",{get:function(){try{if("string"!=typeof __webpack_public_path__)throw new Error("WebpackRequireFrom: '__webpack_public_path__' is not a string or not available at runtime. See https://github.com/agoldis/webpack-require-from#troubleshooting");return __webpack_public_path__}catch(e){return console.error(e),""}},set:function(e){console.warn("WebpackRequireFrom: something is trying to override webpack public path. Ignoring the new value"+e+".")}}),(()=>{var e={179:0};pe.f.j=(n,t)=>{var o=pe.o(e,n)?e[n]:void 0;if(0!==o)if(o)t.push(o[2]);else{var r=new Promise(((t,r)=>o=e[n]=[t,r]));t.push(o[2]=r);var i=pe.p+pe.u(n),s=new Error;pe.l(i,(t=>{if(pe.o(e,n)&&(0!==(o=e[n])&&(e[n]=void 0),o)){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;s.message="Loading chunk "+n+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,o[1](s)}}),"chunk-"+n,n)}};var n=(n,t)=>{var o,r,[i,s,a]=t,u=0;if(i.some((n=>0!==e[n]))){for(o in s)pe.o(s,o)&&(pe.m[o]=s[o]);a&&a(pe)}for(n&&n(t);u<i.length;u++)r=i[u],pe.o(e,r)&&e[r]&&e[r][0](),e[r]=0},t=self.webpackChunkvegafusion_jupyter=self.webpackChunkvegafusion_jupyter||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),ce={},_e={724:function(){return{"./vegafusion_wasm_bg.js":{__wbindgen_object_drop_ref:function(e){return void 0===u&&(u=pe.c[973].exports),u.ug(e)},__wbg_msgreceiver_new:function(e){return void 0===c&&(c=pe.c[973].exports),c.rx(e)},__wbg_log_9bbeec3d99384479:function(e,n){return void 0===_&&(_=pe.c[973].exports),_.Gr(e,n)},__wbg_setDataValue_449bac7a31fcee9a:function(e,n,t,o,r,i){return void 0===d&&(d=pe.c[973].exports),d.b5(e,n,t,o,r,i)},__wbg_setSignalValue_764692e6247f76af:function(e,n,t,o,r,i){return void 0===l&&(l=pe.c[973].exports),l.fR(e,n,t,o,r,i)},__wbg_run_104315dd819297dc:function(e){return void 0===b&&(b=pe.c[973].exports),b.$V(e)},__wbindgen_string_get:function(e,n){return void 0===p&&(p=pe.c[973].exports),p.qt(e,n)},__wbg_toImageURL_abd4753d0f22ed76:function(e,n,t,o){return void 0===f&&(f=pe.c[973].exports),f.To(e,n,t,o)},__wbg_localTimezone_44ff3e09be22dc6f:function(e){return void 0===g&&(g=pe.c[973].exports),g.xv(e)},__wbg_parse_bf4b04e152fc6b40:function(e){return void 0===m&&(m=pe.c[973].exports),m.bX(e)},__wbg_new_9a1b658b9c803399:function(e){return void 0===v&&(v=pe.c[973].exports),v.EB(e)},__wbg_initialize_4d3c2f1d32f15b20:function(e,n){return void 0===h&&(h=pe.c[973].exports),h.Xd(e,n)},__wbg_hover_e276b0abbe48886e:function(e){return void 0===w&&(w=pe.c[973].exports),w.xC(e)},__wbg_setupTooltip_976142ba7370bd0f:function(e){return void 0===x&&(x=pe.c[973].exports),x.Jf(e)},__wbindgen_object_clone_ref:function(e){return void 0===y&&(y=pe.c[973].exports),y.m_(e)},__wbg_addSignalListener_9823b10dfb8707f2:function(e,n,t,o,r,i,s,a,u){return void 0===j&&(j=pe.c[973].exports),j.aK(e,n,t,o,r,i,s,a,u)},__wbg_addDataListener_8ce9cd74a238b2a0:function(e,n,t,o,r,i,s,a,u){return void 0===k&&(k=pe.c[973].exports),k.iO(e,n,t,o,r,i,s,a,u)},__wbg_vegaversion_dd3bbadd88e6ccfe:function(e){return void 0===S&&(S=pe.c[973].exports),S.vI(e)},__wbg_makegrpcsendmessagefn_83d9b7eb68743326:function(e,n,t){return void 0===O&&(O=pe.c[973].exports),O.Vl(e,n,t)},__wbg_new_693216e109162396:function(){return void 0===V&&(V=pe.c[973].exports),V.Ih()},__wbg_stack_0ddaca5d1abfb52f:function(e,n){return void 0===E&&(E=pe.c[973].exports),E.yq(e,n)},__wbg_error_09919627ac0992f5:function(e,n){return void 0===A&&(A=pe.c[973].exports),A.gk(e,n)},__wbg_instanceof_Window_a2a08d3918d7d4d0:function(e){return void 0===F&&(F=pe.c[973].exports),F.bw(e)},__wbg_document_14a383364c173445:function(e){return void 0===M&&(M=pe.c[973].exports),M.BN(e)},__wbg_randomFillSync_64cc7d048f228ca8:function(e,n,t){return void 0===W&&(W=pe.c[973].exports),W.cx(e,n,t)},__wbg_getRandomValues_98117e9a7e993920:function(e,n){return void 0===q&&(q=pe.c[973].exports),q.C2(e,n)},__wbg_process_2f24d6544ea7b200:function(e){return void 0===P&&(P=pe.c[973].exports),P.rY(e)},__wbindgen_is_object:function(e){return void 0===T&&(T=pe.c[973].exports),T.Wl(e)},__wbg_versions_6164651e75405d4a:function(e){return void 0===D&&(D=pe.c[973].exports),D.UE(e)},__wbg_node_4b517d861cbcb3bc:function(e){return void 0===C&&(C=pe.c[973].exports),C.Im(e)},__wbindgen_is_string:function(e){return void 0===L&&(L=pe.c[973].exports),L.eY(e)},__wbg_crypto_98fc271021c7d2ad:function(e){return void 0===N&&(N=pe.c[973].exports),N.Oi(e)},__wbg_msCrypto_a2cdb043d2bfe57f:function(e){return void 0===R&&(R=pe.c[973].exports),R.gl(e)},__wbg_modulerequire_3440a4bcf44437db:function(e,n){return void 0===U&&(U=pe.c[973].exports),U.dS(e,n)},__wbg_newnoargs_fc5356289219b93b:function(e,n){return void 0===I&&(I=pe.c[973].exports),I.QZ(e,n)},__wbg_call_4573f605ca4b5f10:function(e,n){return void 0===z&&(z=pe.c[973].exports),z.VU(e,n)},__wbg_self_ba1ddafe9ea7a3a2:function(){return void 0===B&&(B=pe.c[973].exports),B.DX()},__wbg_window_be3cc430364fd32c:function(){return void 0===J&&(J=pe.c[973].exports),J.xR()},__wbg_globalThis_56d9c9f814daeeee:function(){return void 0===X&&(X=pe.c[973].exports),X.en()},__wbg_global_8c35aeee4ac77f2b:function(){return void 0===Y&&(Y=pe.c[973].exports),Y.aB()},__wbindgen_is_undefined:function(e){return void 0===$&&($=pe.c[973].exports),$.XP(e)},__wbg_call_8e1338b908441bd2:function(e,n,t,o){return void 0===G&&(G=pe.c[973].exports),G.oy(e,n,t,o)},__wbg_buffer_de1150f91b23aa89:function(e){return void 0===H&&(H=pe.c[973].exports),H.$r(e)},__wbg_newwithbyteoffsetandlength_9ca61320599a2c84:function(e,n,t){return void 0===K&&(K=pe.c[973].exports),K.X5(e,n,t)},__wbg_new_97cf52648830a70d:function(e){return void 0===Q&&(Q=pe.c[973].exports),Q.xe(e)},__wbg_set_a0172b213e2469e9:function(e,n,t){return void 0===Z&&(Z=pe.c[973].exports),Z.Rh(e,n,t)},__wbg_length_e09c0b925ab8de5d:function(e){return void 0===ee&&(ee=pe.c[973].exports),ee.uV(e)},__wbg_newwithlength_e833b89f9db02732:function(e){return void 0===ne&&(ne=pe.c[973].exports),ne.Nu(e)},__wbg_subarray_9482ae5cd5cd99d3:function(e,n,t){return void 0===te&&(te=pe.c[973].exports),te.dx(e,n,t)},__wbg_parse_5b823b8686817eb8:function(e,n){return void 0===oe&&(oe=pe.c[973].exports),oe.Cr(e,n)},__wbg_stringify_cf20dc96bee34a66:function(e){return void 0===re&&(re=pe.c[973].exports),re.m5(e)},__wbindgen_debug_string:function(e,n){return void 0===ie&&(ie=pe.c[973].exports),ie.fY(e,n)},__wbindgen_throw:function(e,n){return void 0===se&&(se=pe.c[973].exports),se.Or(e,n)},__wbindgen_memory:function(){return void 0===ae&&(ae=pe.c[973].exports),ae.oH()},__wbindgen_closure_wrapper373:function(e,n,t){return void 0===ue&&(ue=pe.c[973].exports),ue.i6(e,n,t)}}}}},de={594:[724]},pe.w={},pe.f.wasm=function(e,n){(de[e]||[]).forEach((function(t,o){var r=ce[t];if(r)n.push(r);else{var i,s=_e[t](),a=fetch(pe.p+""+{594:{724:"22694c68fe550264308d"}}[e][t]+".module.wasm");i=s&&"function"==typeof s.then&&"function"==typeof WebAssembly.compileStreaming?Promise.all([WebAssembly.compileStreaming(a),s]).then((function(e){return WebAssembly.instantiate(e[0],e[1])})):"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,s):a.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,s)})),n.push(ce[t]=i.then((function(e){return pe.w[t]=(e.instance||e).exports})))}}))},pe(820)})()));