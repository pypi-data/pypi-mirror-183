
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Config and ConfigFile &#8212; confattr v0.5.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_paramlinks.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="confattr package" href="confattr.html" />
    <link rel="prev" title="Introduction and examples" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="confattr.html" title="confattr package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Introduction and examples"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">confattr v0.5.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Config and ConfigFile</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="config-and-configfile">
<h1>Config and ConfigFile<a class="headerlink" href="#config-and-configfile" title="Permalink to this heading">¶</a></h1>
<p>confattr (config attributes) is a python library to make applications configurable.
This library defines the <a class="reference internal" href="confattr.html#confattr.Config" title="confattr.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a> class to create attributes which can be changed in a config file.
It uses the <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#implementing-descriptors">descriptor protocol</a> to return it’s value when used as an instance attribute.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="k">class</span> <span class="nc">Car</span><span class="p">:</span>

	<span class="n">speed_limit</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;traffic-law.speed-limit&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;km/h&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="mi">0</span>

	<span class="k">def</span> <span class="nf">accelerate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">new_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">+</span> <span class="n">value</span>
		<span class="k">if</span> <span class="n">new_speed</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed_limit</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;you are going too fast&#39;</span><span class="p">)</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">new_speed</span>
</pre></div>
</div>
<p>If you want to access the Config object itself you need to access it as a class attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>	<span class="k">def</span> <span class="nf">print_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{key}</span><span class="s1">: </span><span class="si">{val}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">speed_limit</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">speed_limit</span><span class="p">))</span>
</pre></div>
</div>
<p>You load a config file with a <a class="reference internal" href="confattr.html#confattr.ConfigFile" title="confattr.ConfigFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigFile</span></code></a> object.
In order to create an ConfigFile instance you need to provide a callback function which informs the user if the config file contains invalid lines.
This callback function takes two arguments: (1) a <a class="reference internal" href="confattr.html#confattr.NotificationLevel" title="confattr.NotificationLevel"><code class="xref py py-class docutils literal notranslate"><span class="pre">NotificationLevel</span></code></a> which says whether the notification is an error or an information and (2) the message to be presented to the user, either a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#BaseException" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseException</span></code></a>.
When you load a config file with <a class="reference internal" href="confattr.html#confattr.ConfigFile.load" title="confattr.ConfigFile.load"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.load()</span></code></a> all <a class="reference internal" href="confattr.html#confattr.Config" title="confattr.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a> objects are updated automatically.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">ConfigFile</span>
	<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

	<span class="c1"># Print error messages which occurred while loading the config file.</span>
	<span class="c1"># In this easy example it would have been possible to register the callback before calling load</span>
	<span class="c1"># but in the real world the user interface will depend on the values set in the config file.</span>
	<span class="c1"># Therefore the messages are stored until a callback is added.</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">set_ui_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lvl</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

	<span class="n">c1</span> <span class="o">=</span> <span class="n">Car</span><span class="p">()</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;speed_limit: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">c1</span><span class="o">.</span><span class="n">speed_limit</span><span class="p">)</span>
</pre></div>
</div>
<p>Given the following config file (the location of the config file is determined by <a class="reference internal" href="confattr.html#confattr.ConfigFile.iter_config_paths" title="confattr.ConfigFile.iter_config_paths"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.iter_config_paths()</span></code></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">traffic</span><span class="o">-</span><span class="n">law</span><span class="o">.</span><span class="n">speed</span><span class="o">-</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>The script will give the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>speed_limit: 30
</pre></div>
</div>
<p>You can save the current configuration with <a class="reference internal" href="confattr.html#confattr.ConfigFile.save" title="confattr.ConfigFile.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.save()</span></code></a> if you want to write it to the default location
or with <a class="reference internal" href="confattr.html#confattr.ConfigFile.save_file" title="confattr.ConfigFile.save_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.save_file()</span></code></a> if you want to specify the path yourself.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>	<span class="n">filename</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;configuration was written to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>This will write the following file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># traffic-law.speed-limit</span>
<span class="c1"># -----------------------</span>
<span class="c1"># an int in km/h</span>
<span class="nb">set</span> <span class="n">traffic</span><span class="o">-</span><span class="n">law</span><span class="o">.</span><span class="n">speed</span><span class="o">-</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
</section>
<section id="config-file-syntax">
<h1>Config file syntax<a class="headerlink" href="#config-file-syntax" title="Permalink to this heading">¶</a></h1>
<p>I have looked at the config files of different applications trying to come up with a syntax as intuitive as possible.
Two extremes which have heavily inspired me are the config files of <a class="reference external" href="https://www.vim.org/">vim</a> and <a class="reference external" href="https://ranger.github.io/">ranger</a>.
Quoting and inline comments work like in a POSIX shell (except that there is no difference between single quotes and double quotes) as I am using <a class="reference external" href="https://docs.python.org/3/library/shlex.html#shlex.split" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">shlex.split()</span></code></a> to split the lines.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">set</span></code> command has two different forms.
I recommend to <em>not</em> mix them in order to improve readability.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">key1=val1</span> <span class="pre">[key2=val2</span> <span class="pre">...]</span></code>   (inspired by vimrc)</p>
<p><code class="docutils literal notranslate"><span class="pre">set</span></code> takes an arbitrary number of arguments, each argument sets one setting.</p>
<p>Has the advantage that several settings can be changed at once.
This is useful if you want to bind a set command to a key and process that command with <a class="reference internal" href="confattr.html#confattr.ConfigFile.parse_line" title="confattr.ConfigFile.parse_line"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.parse_line()</span></code></a> if the key is pressed.</p>
<p>If the value contains one or more spaces it must be quoted.
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">greeting='hello</span> <span class="pre">world'</span></code> and <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">'greeting=hello</span> <span class="pre">world'</span></code> are equivalent.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">key</span> <span class="pre">[=]</span> <span class="pre">val</span></code>   (inspired by ranger config)</p>
<p><code class="docutils literal notranslate"><span class="pre">set</span></code> takes two arguments, the key and the value.
Optionally a single equals character may be added in between as third argument.</p>
<p>Has the advantage that key and value are separated by one or more spaces which can improve the readability of a config file.</p>
<p>If the value contains one or more spaces it must be quoted:
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">greeting</span> <span class="pre">'hello</span> <span class="pre">world'</span></code> and <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">greeting</span> <span class="pre">=</span> <span class="pre">'hello</span> <span class="pre">world'</span></code> are equivalent.</p>
</li>
</ul>
<p>I recommend to not use spaces in key names so that they don’t need to be wrapped in quotes.</p>
<p>It is possible to include another config file:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">include</span> <span class="pre">filename</span></code></p>
<p>If <code class="docutils literal notranslate"><span class="pre">filename</span></code> is a relative path it is relative to the directory of the config file it appears in.</p>
</li>
</ul>
</section>
<section id="different-values-for-different-objects">
<h1>Different values for different objects<a class="headerlink" href="#different-values-for-different-objects" title="Permalink to this heading">¶</a></h1>
<p>A <a class="reference internal" href="confattr.html#confattr.Config" title="confattr.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a> object always returns the same value, regardless of the owning object it is an attribute of:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="k">class</span> <span class="nc">Car</span><span class="p">:</span>
	<span class="n">speed_limit</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;traffic-law.speed-limit&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;km/h&#39;</span><span class="p">)</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">Car</span><span class="p">()</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">Car</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">speed_limit</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">speed_limit</span><span class="p">)</span>
<span class="n">c2</span><span class="o">.</span><span class="n">speed_limit</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># don&#39;t do this, this is misleading!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">speed_limit</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">speed_limit</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>50 50
30 30
</pre></div>
</div>
<p>If you want to have different values for different objects you need to use <a class="reference internal" href="confattr.html#confattr.MultiConfig" title="confattr.MultiConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiConfig</span></code></a> instead.
This requires the owning object to have a special attribute called <code class="xref py py-attr docutils literal notranslate"><span class="pre">config_id</span></code>.
All objects which have the same <code class="xref py py-attr docutils literal notranslate"><span class="pre">config_id</span></code> share the same value.
All objects which have different <code class="xref py py-attr docutils literal notranslate"><span class="pre">config_id</span></code> can have different values (but don’t need to have different values).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">MultiConfig</span><span class="p">,</span> <span class="n">ConfigId</span><span class="p">,</span> <span class="n">ConfigFile</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
	<span class="n">RED</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
	<span class="n">YELLOW</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
	<span class="n">GREEN</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
	<span class="n">BLUE</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
	<span class="n">WHITE</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
	<span class="n">BLACK</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>


<span class="k">class</span> <span class="nc">Car</span><span class="p">:</span>

	<span class="n">speed_limit</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;traffic-law.speed-limit&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;km/h&#39;</span><span class="p">)</span>
	<span class="n">color</span> <span class="o">=</span> <span class="n">MultiConfig</span><span class="p">(</span><span class="s1">&#39;car.color&#39;</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>

	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_id</span><span class="p">:</span> <span class="n">ConfigId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">config_id</span> <span class="o">=</span> <span class="n">config_id</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

	<span class="n">config_file</span><span class="o">.</span><span class="n">set_ui_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lvl</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

	<span class="n">cars</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">config_id</span> <span class="ow">in</span> <span class="n">MultiConfig</span><span class="o">.</span><span class="n">config_ids</span><span class="p">:</span>
		<span class="n">cars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Car</span><span class="p">(</span><span class="n">config_id</span><span class="p">))</span>
	<span class="n">cars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Car</span><span class="p">(</span><span class="n">ConfigId</span><span class="p">(</span><span class="s1">&#39;another-car&#39;</span><span class="p">)))</span>

	<span class="k">for</span> <span class="n">car</span> <span class="ow">in</span> <span class="n">cars</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;color of </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">car</span><span class="o">.</span><span class="n">config_id</span><span class="p">,</span> <span class="n">car</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>
</pre></div>
</div>
<p>Given the following config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">traffic</span><span class="o">-</span><span class="n">law</span><span class="o">.</span><span class="n">speed</span><span class="o">-</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">30</span>

<span class="p">[</span><span class="n">alices</span><span class="o">-</span><span class="n">car</span><span class="p">]</span>
<span class="nb">set</span> <span class="n">car</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">red</span>

<span class="p">[</span><span class="n">bobs</span><span class="o">-</span><span class="n">car</span><span class="p">]</span>
<span class="nb">set</span> <span class="n">car</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">blue</span>
</pre></div>
</div>
<p>It creates the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>color of alices-car: Color.RED
color of bobs-car: Color.BLUE
color of another-car: Color.BLACK
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">another-car</span></code> gets the default color black as it is not set in the config file.
You can change this default color in the config file by setting it before specifying a config id or after specifying the special config id <code class="docutils literal notranslate"><span class="pre">general</span></code> (<a class="reference internal" href="confattr.html#confattr.Config.default_config_id" title="confattr.Config.default_config_id"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Config.default_config_id</span></code></a>).
Note how this adds <code class="docutils literal notranslate"><span class="pre">general</span></code> to <a class="reference internal" href="confattr.html#confattr.MultiConfig.config_ids" title="confattr.MultiConfig.config_ids"><code class="xref py py-attr docutils literal notranslate"><span class="pre">MultiConfig.config_ids</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">traffic</span><span class="o">-</span><span class="n">law</span><span class="o">.</span><span class="n">speed</span><span class="o">-</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">30</span>
<span class="nb">set</span> <span class="n">car</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">white</span>

<span class="p">[</span><span class="n">alices</span><span class="o">-</span><span class="n">car</span><span class="p">]</span>
<span class="nb">set</span> <span class="n">car</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">red</span>

<span class="p">[</span><span class="n">bobs</span><span class="o">-</span><span class="n">car</span><span class="p">]</span>
<span class="nb">set</span> <span class="n">car</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">blue</span>
</pre></div>
</div>
<p>Creates the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>color of general: Color.WHITE
color of alices-car: Color.RED
color of bobs-car: Color.BLUE
color of another-car: Color.WHITE
</pre></div>
</div>
</section>
<section id="custom-data-types">
<h1>Custom data types<a class="headerlink" href="#custom-data-types" title="Permalink to this heading">¶</a></h1>
<p>It is possible to use custom data types.
You can use that for example to avoid repeating a part of help which applies to several settings:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">ConfigFile</span>

<span class="k">class</span> <span class="nc">Regex</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>

	<span class="n">type_name</span> <span class="o">=</span> <span class="s1">&#39;regular expression&#39;</span>
	<span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;https://docs.python.org/3/library/re.html#regular-expression-syntax&#39;</span>

<span class="k">class</span> <span class="nc">Parser</span><span class="p">:</span>

	<span class="n">re_mount_output</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;udisksctl.mount-output-pattern&#39;</span><span class="p">,</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^.*?(?P&lt;mountpath&gt;/(\S+/)*[^/]+?)\.?$&#39;</span><span class="p">),</span>
		<span class="n">help</span><span class="o">=</span><span class="s1">&#39;a regular expression to parse the output of `udisksctl mount`. Must contain a named group called &quot;mountpath&quot;.&#39;</span><span class="p">)</span>
	<span class="n">re_unlock_output</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;udisksctl.unlock-output-pattern&#39;</span><span class="p">,</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^.*?(?P&lt;unlockpath&gt;/(\S+/)*[^/]+?)\.?$&#39;</span><span class="p">),</span>
		<span class="n">help</span><span class="o">=</span><span class="s1">&#39;a regular expression to parse the output of `udisksctl unlock`. Must contain a named group called &quot;unlockpath&quot;.&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">compile_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		This must be called every time after the config file has been loaded.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reo_mount_output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re_mount_output</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reo_unlock_output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re_unlock_output</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>This exports the following config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data types</span>
<span class="c1"># ----------</span>
<span class="c1"># - regular expression</span>
<span class="c1">#   https://docs.python.org/3/library/re.html#regular-expression-syntax</span>

<span class="c1"># udisksctl.mount-output-pattern</span>
<span class="c1"># ------------------------------</span>
<span class="c1"># a regular expression</span>
<span class="c1"># a regular expression to parse the output of `udisksctl mount`. Must contain a named group called &quot;mountpath&quot;.</span>
<span class="nb">set</span> <span class="n">udisksctl</span><span class="o">.</span><span class="n">mount</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;^.*?(?P&lt;mountpath&gt;/(\S+/)*[^/]+?)\.?$&#39;</span>

<span class="c1"># udisksctl.unlock-output-pattern</span>
<span class="c1"># -------------------------------</span>
<span class="c1"># a regular expression</span>
<span class="c1"># a regular expression to parse the output of `udisksctl unlock`. Must contain a named group called &quot;unlockpath&quot;.</span>
<span class="nb">set</span> <span class="n">udisksctl</span><span class="o">.</span><span class="n">unlock</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;^.*?(?P&lt;unlockpath&gt;/(\S+/)*[^/]+?)\.?$&#39;</span>
</pre></div>
</div>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">__str__()</span></code> must return a string representation suitable for the config file and the constructor must create an equal object if it is passed the return value of <code class="xref py py-meth docutils literal notranslate"><span class="pre">__str__()</span></code>. This is fulfilled by inheriting from <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>.
<code class="xref py py-attr docutils literal notranslate"><span class="pre">type_name</span></code> is a special str attribute which specifies how the type is called in the config file. If it is missing it is derived from the class name.
<code class="xref py py-attr docutils literal notranslate"><span class="pre">help</span></code> is a special str attribute which contains a description which is printed in the config file. If it is missing the doc string is used instead.</p>
<p><a class="reference internal" href="confattr.types.html#module-confattr.types" title="confattr.types"><code class="xref py py-mod docutils literal notranslate"><span class="pre">confattr.types</span></code></a> defines several such types, including the above definition of <code class="xref py py-class docutils literal notranslate"><span class="pre">Regex</span></code>.</p>
<p>For more information on the supported data types see <a class="reference internal" href="confattr.html#confattr.Config" title="confattr.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a>.</p>
</section>
<section id="adding-new-commands-to-the-config-file-syntax">
<h1>Adding new commands to the config file syntax<a class="headerlink" href="#adding-new-commands-to-the-config-file-syntax" title="Permalink to this heading">¶</a></h1>
<p>You can extend this library by defining new commands which can be used in the config file.
All you need to do is subclass <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand" title="confattr.ConfigFileCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigFileCommand</span></code></a> and implement the <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand.run" title="confattr.ConfigFileCommand.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFileCommand.run()</span></code></a> method.
Additionally I recommend to provide a doc string explaining how to use the command in the config file. The doc string is used by <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_help()</span></code> which may be used by an in-app help.
Optionally you can set <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand.name" title="confattr.ConfigFileCommand.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ConfigFileCommand.name</span></code></a> and <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand.aliases" title="confattr.ConfigFileCommand.aliases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ConfigFileCommand.aliases</span></code></a> and implement the <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand.save" title="confattr.ConfigFileCommand.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFileCommand.save()</span></code></a> method.</p>
<p>Alternatively <a class="reference internal" href="confattr.html#confattr.ConfigFileArgparseCommand" title="confattr.ConfigFileArgparseCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigFileArgparseCommand</span></code></a> can be subclassed instead, it aims to make the parsing easier and avoid redundancy in the doc string by using the <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> module.
You must implement <code class="xref py py-meth docutils literal notranslate"><span class="pre">init_parser()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">run_parsed()</span></code>.
Note that <code class="xref py py-meth docutils literal notranslate"><span class="pre">init_parser()</span></code> is a class method.
You should give a doc string describing what the command does.
In contrast to <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand" title="confattr.ConfigFileCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigFileCommand</span></code></a> <a class="reference external" href="https://docs.python.org/3/library/argparse.html#module-argparse" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">argparse</span></code></a> adds usage and the allowed arguments to the output of <a class="reference internal" href="confattr.html#confattr.ConfigFileArgparseCommand.get_help" title="confattr.ConfigFileArgparseCommand.get_help"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFileArgparseCommand.get_help()</span></code></a> automatically.</p>
<p>For example you may want to add a new command to bind keys to whatever kind of command.
The following example assumes <a class="reference external" href="http://urwid.org/">urwid</a> as user interface framework.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
<span class="kn">import</span> <span class="nn">urwid</span>
<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">ConfigFileArgparseCommand</span><span class="p">,</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">Config</span><span class="p">,</span> <span class="n">NotificationLevel</span>


<span class="k">class</span> <span class="nc">Map</span><span class="p">(</span><span class="n">ConfigFileArgparseCommand</span><span class="p">):</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	bind a command to a key</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">init_parser</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;http://urwid.org/manual/userinput.html#keyboard-input&#39;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;any urwid command&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">run_parsed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="c1"># config</span>
	<span class="n">choices</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;choices&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;vanilla&#39;</span><span class="p">,</span> <span class="s1">&#39;strawberry&#39;</span><span class="p">])</span>
	<span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="p">[</span><span class="s1">&#39;enter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;confirm&#39;</span>
	<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

	<span class="c1"># show errors in config</span>
	<span class="n">palette</span> <span class="o">=</span> <span class="p">[(</span><span class="n">NotificationLevel</span><span class="o">.</span><span class="n">ERROR</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;dark red&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)]</span>
	<span class="n">status_bar</span> <span class="o">=</span> <span class="n">urwid</span><span class="o">.</span><span class="n">Pile</span><span class="p">([])</span>
	<span class="k">def</span> <span class="nf">on_config_message</span><span class="p">(</span><span class="n">lvl</span><span class="p">:</span> <span class="n">NotificationLevel</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="s1">&#39;str|BaseException&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">markup</span> <span class="o">=</span> <span class="p">(</span><span class="n">lvl</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
		<span class="n">widget_options_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">urwid</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">markup</span><span class="p">),</span> <span class="n">status_bar</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="s1">&#39;pack&#39;</span><span class="p">))</span>
		<span class="n">status_bar</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">widget_options_tuple</span><span class="p">)</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">set_ui_callback</span><span class="p">(</span><span class="n">on_config_message</span><span class="p">)</span>

	<span class="c1"># a simple example app showing check boxes and printing the user&#39;s choice to stdout</span>
	<span class="k">def</span> <span class="nf">key_handler</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">cmd</span> <span class="o">=</span> <span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;confirm&#39;</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">urwid</span><span class="o">.</span><span class="n">ExitMainLoop</span><span class="p">()</span>
	<span class="n">checkboxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">urwid</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
	<span class="n">frame</span> <span class="o">=</span> <span class="n">urwid</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">urwid</span><span class="o">.</span><span class="n">Filler</span><span class="p">(</span><span class="n">urwid</span><span class="o">.</span><span class="n">Pile</span><span class="p">(</span><span class="n">checkboxes</span><span class="p">)),</span> <span class="n">footer</span><span class="o">=</span><span class="n">status_bar</span><span class="p">)</span>
	<span class="n">urwid</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span> <span class="n">unhandled_input</span><span class="o">=</span><span class="n">key_handler</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">ckb</span> <span class="ow">in</span> <span class="n">checkboxes</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ckb</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">ckb</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Given the following config file it is possible to move the cursor upward and downward with <code class="docutils literal notranslate"><span class="pre">j</span></code> and <code class="docutils literal notranslate"><span class="pre">k</span></code> like in vim:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">j</span> <span class="s1">&#39;cursor down&#39;</span>
<span class="nb">map</span> <span class="n">k</span> <span class="s1">&#39;cursor up&#39;</span>
<span class="nb">map</span> <span class="n">q</span> <span class="s1">&#39;confirm&#39;</span>
</pre></div>
</div>
<p>The help for the newly defined command looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Map</span><span class="o">.</span><span class="n">get_help</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="nb">map</span> <span class="n">key</span> <span class="n">cmd</span>

<span class="n">bind</span> <span class="n">a</span> <span class="n">command</span> <span class="n">to</span> <span class="n">a</span> <span class="n">key</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">key</span>  <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">urwid</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">manual</span><span class="o">/</span><span class="n">userinput</span><span class="o">.</span><span class="n">html</span><span class="c1">#keyboard-input</span>
  <span class="n">cmd</span>  <span class="nb">any</span> <span class="n">urwid</span> <span class="n">command</span>
</pre></div>
</div>
<p>(All subclasses of <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand" title="confattr.ConfigFileCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigFileCommand</span></code></a> are saved in <code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFileCommand.__init_subclass__()</span></code> and can be retrieved with <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand.get_command_types" title="confattr.ConfigFileCommand.get_command_types"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFileCommand.get_command_types()</span></code></a>.
The <a class="reference internal" href="confattr.html#confattr.ConfigFile" title="confattr.ConfigFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigFile</span></code></a> constructor uses that if <code class="xref py py-paramref docutils literal notranslate"><span class="pre">commands</span></code> is not given.)</p>
</section>
<section id="writing-custom-commands-to-the-config-file">
<h1>Writing custom commands to the config file<a class="headerlink" href="#writing-custom-commands-to-the-config-file" title="Permalink to this heading">¶</a></h1>
<p>The previous example has shown how to define new commands so that they can be used in the config file.
Let’s continue that example so that calls to the custom command <code class="docutils literal notranslate"><span class="pre">map</span></code> are written with <a class="reference internal" href="confattr.html#confattr.ConfigFile.save" title="confattr.ConfigFile.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.save()</span></code></a>.</p>
<p>All you need to do for that is implementing the <a class="reference internal" href="confattr.html#confattr.ConfigFileCommand.save" title="confattr.ConfigFileCommand.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFileCommand.save()</span></code></a> method.</p>
<p>Experimental support for type checking <code class="docutils literal notranslate"><span class="pre">**kw</span></code> has been added in <a class="reference external" href="https://mypy-lang.blogspot.com/2022/09/mypy-0981-released.html">mypy 0.981</a>.
<a class="reference internal" href="confattr.html#confattr.SaveKwargs" title="confattr.SaveKwargs"><code class="xref py py-class docutils literal notranslate"><span class="pre">SaveKwargs</span></code></a> depends on <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TypedDict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.TypedDict</span></code></a> and therefore is not available before Python 3.8.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Unpack</span>  <span class="c1"># This will hopefully be replaced by the ** syntax proposed in https://peps.python.org/pep-0692/</span>
	<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">SaveKwargs</span>

<span class="kn">import</span> <span class="nn">urwid</span>
<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">ConfigFileArgparseCommand</span><span class="p">,</span> <span class="n">ConfigFile</span>


<span class="k">class</span> <span class="nc">Map</span><span class="p">(</span><span class="n">ConfigFileArgparseCommand</span><span class="p">):</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	bind a command to a key</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">init_parser</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;http://urwid.org/manual/userinput.html#keyboard-input&#39;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;any urwid command&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">run_parsed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span>

	<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="s1">&#39;Unpack[SaveKwargs]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="o">.</span><span class="n">_command</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">key_cmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
			<span class="n">quoted_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
			<span class="n">quoted_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;map </span><span class="si">{</span><span class="n">quoted_key</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">quoted_cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>However, <code class="xref py py-data docutils literal notranslate"><span class="pre">urwid.command_map</span></code> contains more commands than the example app uses so writing all of them might be confusing.
Therefore let’s add a keyword argument to write only the specified commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="kn">import</span> <span class="nn">urwid</span>
<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">ConfigFileArgparseCommand</span><span class="p">,</span> <span class="n">ConfigFile</span>

<span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Unpack</span>  <span class="c1"># This will hopefully be replaced by the ** syntax proposed in https://peps.python.org/pep-0692/</span>
	<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">SaveKwargs</span>

	<span class="k">class</span> <span class="nc">MapSaveKwargs</span><span class="p">(</span><span class="n">SaveKwargs</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="n">urwid_commands</span><span class="p">:</span> <span class="s1">&#39;Sequence[str]&#39;</span>

<span class="k">class</span> <span class="nc">Map</span><span class="p">(</span><span class="n">ConfigFileArgparseCommand</span><span class="p">):</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	bind a command to a key</span>
<span class="sd">	&#39;&#39;&#39;</span>

	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">init_parser</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;http://urwid.org/manual/userinput.html#keyboard-input&#39;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;cmd&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;any urwid command&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">run_parsed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span>

	<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="s1">&#39;Unpack[MapSaveKwargs]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">commands</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;urwid_commands&#39;</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="o">.</span><span class="n">_command</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
		<span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="o">.</span><span class="n">_command</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">urwid</span><span class="o">.</span><span class="n">command_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">cmd</span><span class="p">:</span>
					<span class="n">quoted_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
					<span class="n">quoted_cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
					<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;map </span><span class="si">{</span><span class="n">quoted_key</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">quoted_cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">urwid_commands</span> <span class="o">=</span> <span class="p">[</span><span class="n">urwid</span><span class="o">.</span><span class="n">CURSOR_UP</span><span class="p">,</span> <span class="n">urwid</span><span class="o">.</span><span class="n">CURSOR_DOWN</span><span class="p">,</span> <span class="n">urwid</span><span class="o">.</span><span class="n">ACTIVATE</span><span class="p">,</span> <span class="s1">&#39;confirm&#39;</span><span class="p">]</span>
	<span class="n">mapkw</span><span class="p">:</span> <span class="s1">&#39;MapSaveKwargs&#39;</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">urwid_commands</span><span class="o">=</span><span class="n">urwid_commands</span><span class="p">)</span>
	<span class="n">kw</span><span class="p">:</span> <span class="s1">&#39;SaveKwargs&#39;</span> <span class="o">=</span> <span class="n">mapkw</span>
	<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces the following config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">up</span> <span class="s1">&#39;cursor up&#39;</span>
<span class="nb">map</span> <span class="n">down</span> <span class="s1">&#39;cursor down&#39;</span>
<span class="nb">map</span> <span class="s1">&#39; &#39;</span> <span class="n">activate</span>
<span class="nb">map</span> <span class="n">enter</span> <span class="n">activate</span>
</pre></div>
</div>
<p>If you don’t care about Python &lt; 3.8 you can import <a class="reference internal" href="confattr.html#confattr.SaveKwargs" title="confattr.SaveKwargs"><code class="xref py py-class docutils literal notranslate"><span class="pre">SaveKwargs</span></code></a> normally and save a line when calling <a class="reference internal" href="confattr.html#confattr.ConfigFile.save" title="confattr.ConfigFile.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.save()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">kw</span><span class="p">:</span> <span class="n">SaveKwargs</span> <span class="o">=</span> <span class="n">MapSaveKwargs</span><span class="p">(</span><span class="n">urwid_commands</span><span class="o">=...</span><span class="p">)</span>
<span class="n">config_file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="customizing-the-config-file-syntax">
<h1>Customizing the config file syntax<a class="headerlink" href="#customizing-the-config-file-syntax" title="Permalink to this heading">¶</a></h1>
<p>If you want to make minor changes to the syntax of the config file you can subclass the corresponding command, i.e. <a class="reference internal" href="confattr.html#confattr.Set" title="confattr.Set"><code class="xref py py-class docutils literal notranslate"><span class="pre">Set</span></code></a> or <a class="reference internal" href="confattr.html#confattr.Include" title="confattr.Include"><code class="xref py py-class docutils literal notranslate"><span class="pre">Include</span></code></a>.</p>
<p>For example if you want to use a <code class="docutils literal notranslate"><span class="pre">key:</span> <span class="pre">value</span></code> syntax you could do the following.</p>
<p>I am setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code> to an empty string (i.e. <code class="xref py py-const docutils literal notranslate"><span class="pre">confattr.DEFAULT_COMMAND</span></code>) to make this the default command which is used if an unknown command is encountered.
This makes it possible to use this command without writing out it’s name in the config file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">Set</span><span class="p">,</span> <span class="n">ParseException</span><span class="p">,</span> <span class="n">ConfigId</span>

<span class="kn">import</span> <span class="nn">typing</span>
<span class="k">if</span> <span class="n">typing</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">ParseSplittedLineKwargs</span><span class="p">,</span> <span class="n">SaveKwargs</span>
	<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Unpack</span>
	<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>


<span class="k">class</span> <span class="nc">SimpleSet</span><span class="p">(</span><span class="n">Set</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

	<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

	<span class="n">SEP</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span>

	<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="s1">&#39;Sequence[str]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="s1">&#39;Unpack[ParseSplittedLineKwargs]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ln</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SEP</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">ParseException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;missing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">SEP</span><span class="si">}</span><span class="s1"> between key and value&#39;</span><span class="p">)</span>
		<span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SEP</span><span class="p">)</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">parse_key_and_set_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">save_config_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">TextIO</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="s1">&#39;Config[object]&#39;</span><span class="p">,</span> <span class="n">config_id</span><span class="p">:</span> <span class="s1">&#39;ConfigId|None&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="s1">&#39;Unpack[SaveKwargs]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
		<span class="c1"># this is called by Set.save</span>
		<span class="k">if</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">write_help</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
		<span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_value</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">config_id</span><span class="p">)</span>
		<span class="c1">#value = self.config_file.quote(value)  # not needed because run uses line instead of cmd</span>
		<span class="n">ln</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">instance</span><span class="o">.</span><span class="n">key</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">SEP</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">ConfigFile</span>
	<span class="n">color</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;favorite color&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
	<span class="n">subject</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;favorite subject&#39;</span><span class="p">,</span> <span class="s1">&#39;math&#39;</span><span class="p">)</span>
	<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
	<span class="n">config_file</span><span class="o">.</span><span class="n">set_ui_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lvl</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">subject</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Then a config file might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">favorite</span> <span class="n">color</span><span class="p">:</span> <span class="n">sky</span> <span class="n">blue</span>
<span class="n">favorite</span> <span class="n">subject</span><span class="p">:</span> <span class="n">computer</span> <span class="n">science</span>
</pre></div>
</div>
<p>Please note that it’s still possible to use the <code class="docutils literal notranslate"><span class="pre">include</span></code> command.
If you want to avoid that use</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">ConfigFileCommand</span><span class="p">,</span> <span class="n">Include</span>
<span class="n">ConfigFileCommand</span><span class="o">.</span><span class="n">delete_command_type</span><span class="p">(</span><span class="n">Include</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to make bigger changes like using JSON you need to subclass <a class="reference internal" href="confattr.html#confattr.ConfigFile" title="confattr.ConfigFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConfigFile</span></code></a>.</p>
</section>
<section id="config-without-classes">
<h1>Config without classes<a class="headerlink" href="#config-without-classes" title="Permalink to this heading">¶</a></h1>
<p>If you want to use <a class="reference internal" href="confattr.html#confattr.Config" title="confattr.Config"><code class="xref py py-class docutils literal notranslate"><span class="pre">Config</span></code></a> objects without custom classes you can access the value via the <code class="xref py py-attr docutils literal notranslate"><span class="pre">Config.value</span></code> attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">confattr</span> <span class="kn">import</span> <span class="n">Config</span><span class="p">,</span> <span class="n">ConfigFile</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;urwid.backend&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">allowed_values</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;curses&#39;</span><span class="p">))</span>

<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="p">(</span><span class="n">appname</span><span class="o">=</span><span class="n">__package__</span><span class="p">)</span>
<span class="n">config_file</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">config_file</span><span class="o">.</span><span class="n">set_ui_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lvl</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>Given the following config file (the location of the config file is determined by <a class="reference internal" href="confattr.html#confattr.ConfigFile.iter_config_paths" title="confattr.ConfigFile.iter_config_paths"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.iter_config_paths()</span></code></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">urwid</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">curses</span>
</pre></div>
</div>
<p>The script will give the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>curses
</pre></div>
</div>
</section>
<section id="environment-variables">
<h1>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this heading">¶</a></h1>
<p>This library is influenced by the following environment variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">XDG_CONFIG_HOME</span></code> defines the base directory relative to which user-specific configuration files should be stored. <a class="footnote-reference brackets" href="#id6" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#id7" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">XDG_CONFIG_DIRS</span></code> defines the preference-ordered set of base directories to search for configuration files in addition to the <code class="docutils literal notranslate"><span class="pre">XDG_CONFIG_HOME</span></code> base directory. The directories in <code class="docutils literal notranslate"><span class="pre">XDG_CONFIG_DIRS</span></code> should be separated with a colon. <a class="footnote-reference brackets" href="#id6" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#id7" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFATTR_FILENAME</span></code>  defines the value of <a class="reference internal" href="confattr.html#confattr.ConfigFile.FILENAME" title="confattr.ConfigFile.FILENAME"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ConfigFile.FILENAME</span></code></a>. <a class="footnote-reference brackets" href="#id7" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></li>
</ul>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id6" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id3">2</a>)</span>
<p>is not queried directly but outsourced to <a class="reference external" href="https://pypi.org/project/platformdirs/">platformdirs</a>, <a class="reference external" href="https://pypi.org/project/xdgappdirs/">xdgappdirs</a> or <a class="reference external" href="https://pypi.org/project/appdirs/">appdirs</a>, see <a class="reference internal" href="confattr.html#confattr.ConfigFile.get_app_dirs" title="confattr.ConfigFile.get_app_dirs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.get_app_dirs()</span></code></a>.
See also <a class="reference external" href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html#variables">https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html#variables</a>.</p>
</aside>
<aside class="footnote brackets" id="id7" role="note">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id4">2</a>,<a role="doc-backlink" href="#id5">3</a>)</span>
<p>influences <a class="reference internal" href="confattr.html#confattr.ConfigFile.iter_config_paths" title="confattr.ConfigFile.iter_config_paths"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ConfigFile.iter_config_paths()</span></code></a></p>
</aside>
</aside>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Config and ConfigFile</a></li>
<li><a class="reference internal" href="#config-file-syntax">Config file syntax</a></li>
<li><a class="reference internal" href="#different-values-for-different-objects">Different values for different objects</a></li>
<li><a class="reference internal" href="#custom-data-types">Custom data types</a></li>
<li><a class="reference internal" href="#adding-new-commands-to-the-config-file-syntax">Adding new commands to the config file syntax</a></li>
<li><a class="reference internal" href="#writing-custom-commands-to-the-config-file">Writing custom commands to the config file</a></li>
<li><a class="reference internal" href="#customizing-the-config-file-syntax">Customizing the config file syntax</a></li>
<li><a class="reference internal" href="#config-without-classes">Config without classes</a></li>
<li><a class="reference internal" href="#environment-variables">Environment variables</a></li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">Introduction and examples</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="confattr.html"
                          title="next chapter">confattr package</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/intro.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="confattr.html" title="confattr package"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Introduction and examples"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">confattr v0.5.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Config and ConfigFile</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, erzo.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>