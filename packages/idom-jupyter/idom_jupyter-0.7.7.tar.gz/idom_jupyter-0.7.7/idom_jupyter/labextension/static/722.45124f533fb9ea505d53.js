/*! For license information please see 722.45124f533fb9ea505d53.js.LICENSE.txt */
"use strict";(self.webpackChunkidom_client_jupyter=self.webpackChunkidom_client_jupyter||[]).push([[722],{619:(e,t,n)=>{n.d(t,{Z:()=>a});var r=function(e,t,n,o){var a;t[0]=0;for(var i=1;i<t.length;i++){var u=t[i++],c=t[i]?(t[0]|=u?1:2,n[t[i++]]):t[++i];3===u?o[0]=c:4===u?o[1]=Object.assign(o[1]||{},c):5===u?(o[1]=o[1]||{})[t[++i]]=c:6===u?o[1][t[++i]]+=c+"":u?(a=e.apply(c,r(e,c,n,["",null])),o.push(a),c[0]?t[0]|=2:(t[i-2]=0,t[i]=a)):o.push(c)}return o},o=new Map;function a(e){var t=o.get(this);return t||(t=new Map,o.set(this,t)),(t=r(this,t.get(e)||(t.set(e,t=function(e){for(var t,n,r=1,o="",a="",i=[0],u=function(e){1===r&&(e||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?i.push(0,e,o):3===r&&(e||o)?(i.push(3,e,o),r=2):2===r&&"..."===o&&e?i.push(4,e,0):2===r&&o&&!e?i.push(5,0,!0,o):r>=5&&((o||!e&&5===r)&&(i.push(r,0,o,n),r=6),e&&(i.push(r,e,0,n),r=6)),o=""},c=0;c<e.length;c++){c&&(1===r&&u(),u(c));for(var _=0;_<e[c].length;_++)t=e[c][_],1===r?"<"===t?(u(),i=[i],r=3):o+=t:4===r?"--"===o&&">"===t?(r=1,o=""):o=t+o[0]:a?t===a?a="":o+=t:'"'===t||"'"===t?a=t:">"===t?(u(),r=1):r&&("="===t?(r=5,n=o,o=""):"/"===t&&(r<5||">"===e[c][_+1])?(u(),3===r&&(i=i[0]),r=i,(i=i[0]).push(2,0,r),r=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(u(),r=2):o+=t),3===r&&"!--"===o&&(r=4,i=i[0])}return u(),i}(e)),t),arguments,[])).length>1?t:t[0]}},28:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>Layout,W:()=>Element});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(271),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),react_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(456),react_dom__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react_dom__WEBPACK_IMPORTED_MODULE_1__),htm__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(619),_json_patch_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(397),_import_source_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(164),_contexts_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(478),_element_utils_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(351);const html=htm__WEBPACK_IMPORTED_MODULE_2__.Z.bind(react__WEBPACK_IMPORTED_MODULE_0___default().createElement);function Layout({saveUpdateHook:e,sendEvent:t,loadImportSource:n}){const[r,o]=(0,_json_patch_js__WEBPACK_IMPORTED_MODULE_3__.g)({});return react__WEBPACK_IMPORTED_MODULE_0___default().useEffect((()=>e(o)),[o]),Object.keys(r).length?html`
    <${_contexts_js__WEBPACK_IMPORTED_MODULE_5__.V.Provider} value=${{sendEvent:t,loadImportSource:n}}>
      <${Element} model=${r} />
    <//>
  `:html`<${react__WEBPACK_IMPORTED_MODULE_0___default().Fragment} />`}function Element({model:e}){return void 0!==e.error?e.error?html`<pre>${e.error}</pre>`:null:"script"==e.tagName?html`<${ScriptElement} model=${e} />`:["input","select","textarea"].includes(e.tagName)?html`<${UserInputElement} model=${e} />`:e.importSource?html`<${ImportedElement} model=${e} />`:html`<${StandardElement} model=${e} />`}function StandardElement({model:e}){const t=react__WEBPACK_IMPORTED_MODULE_0___default().useContext(_contexts_js__WEBPACK_IMPORTED_MODULE_5__.V);let n;return n=""==e.tagName?react__WEBPACK_IMPORTED_MODULE_0___default().Fragment:e.tagName,react__WEBPACK_IMPORTED_MODULE_0___default().createElement(n,(0,_element_utils_js__WEBPACK_IMPORTED_MODULE_6__.R)(e,t.sendEvent),...(0,_element_utils_js__WEBPACK_IMPORTED_MODULE_6__.x)(e,(e=>html`<${Element} key=${e.key} model=${e} />`)))}function UserInputElement({model:e}){const t=react__WEBPACK_IMPORTED_MODULE_0___default().useRef(),n=react__WEBPACK_IMPORTED_MODULE_0___default().useContext(_contexts_js__WEBPACK_IMPORTED_MODULE_5__.V),r=(0,_element_utils_js__WEBPACK_IMPORTED_MODULE_6__.R)(e,n.sendEvent);let o=r.value;delete r.value,react__WEBPACK_IMPORTED_MODULE_0___default().useEffect((()=>{void 0!==o&&(t.current.value=o)}),[t.current,o]);const a=react__WEBPACK_IMPORTED_MODULE_0___default().useState([])[0];a&&(o===a[0]?(a.shift(),o=a[a.length-1]):a.length=0);const i=r.onChange;return"function"==typeof i&&(r.onChange=e=>{a.push(e.target.value),i(e)}),react__WEBPACK_IMPORTED_MODULE_0___default().createElement(e.tagName,{...r,ref:e=>{t.current=e}},...(0,_element_utils_js__WEBPACK_IMPORTED_MODULE_6__.x)(e,(e=>html`<${Element} key=${e.key} model=${e} />`)))}function ScriptElement({model}){const ref=react__WEBPACK_IMPORTED_MODULE_0___default().useRef();return react__WEBPACK_IMPORTED_MODULE_0___default().useEffect((()=>{model?.children?.length>1&&console.error("Too many children for 'script' element.");let scriptContent=model?.children?.[0],scriptElement;if(model.attributes){scriptElement=document.createElement("script");for(const[e,t]of Object.entries(model.attributes))scriptElement.setAttribute(e,t);scriptElement.appendChild(document.createTextNode(scriptContent)),ref.current.appendChild(scriptElement)}else{let scriptResult=eval(scriptContent);if("function"==typeof scriptResult)return scriptResult()}}),[model.key]),html`<div ref=${ref} />`}function ImportedElement({model:e}){react__WEBPACK_IMPORTED_MODULE_0___default().useContext(_contexts_js__WEBPACK_IMPORTED_MODULE_5__.V);const t=e.importSource.fallback,n=(0,_import_source_js__WEBPACK_IMPORTED_MODULE_4__.D)(e.importSource);return n?html`<${_ImportedElement}
      model=${e}
      importSource=${n}
    />`:t?"string"==typeof t?html`<div>${t}</div>`:html`<${StandardElement} model=${t} />`:html`<div />`}function _ImportedElement({model:e,importSource:t}){react__WEBPACK_IMPORTED_MODULE_0___default().useContext(_contexts_js__WEBPACK_IMPORTED_MODULE_5__.V);const n=react__WEBPACK_IMPORTED_MODULE_0___default().useRef(null),r=react__WEBPACK_IMPORTED_MODULE_0___default().useRef(null);return react__WEBPACK_IMPORTED_MODULE_0___default().useEffect((()=>{if(r.current=t.bind(n.current),!t.data.unmountBeforeUpdate)return r.current.unmount}),[]),react__WEBPACK_IMPORTED_MODULE_0___default().useEffect((()=>{if(r.current.render(e),t.data.unmountBeforeUpdate)return r.current.unmount})),html`<div ref=${n} />`}},478:(e,t,n)=>{n.d(t,{V:()=>o});var r=n(271);const o=n.n(r)().createContext({sendEvent:void 0,loadImportSource:void 0})},351:(e,t,n)=>{function r(e){const t={};return e.type in _&&Object.assign(t,_[e.type](e)),t.target=o(e.target),t.currentTarget=e.target===e.currentTarget?t.target:o(e.currentTarget),t.relatedTarget=o(e.relatedTarget),t}function o(e){let t=null;return e&&(t=function(e){return{boundingClientRect:e.getBoundingClientRect()}}(e),e.tagName in u&&u[e.tagName].forEach((n=>Object.assign(t,n(e))))),t}n.d(t,{R:()=>l,x:()=>p});const a={hasValue:e=>({value:e.value}),hasCurrentTime:e=>({currentTime:e.currentTime}),hasFiles:e=>"file"===e?.type?{files:Array.from(e.files).map((e=>({lastModified:e.lastModified,name:e.name,size:e.size,type:e.type})))}:{}},i={hasValue:["BUTTON","INPUT","OPTION","LI","METER","PROGRESS","PARAM","SELECT","TEXTAREA"],hasCurrentTime:["AUDIO","VIDEO"],hasFiles:["INPUT"]},u={};Object.keys(i).forEach((e=>{i[e].forEach((t=>{(u[t]||(u[t]=[])).push(a[e])}))}));const c={clipboard:["copy","cut","paste"],composition:["compositionend","compositionstart","compositionupdate"],keyboard:["keydown","keypress","keyup"],mouse:["click","contextmenu","doubleclick","drag","dragend","dragenter","dragexit","dragleave","dragover","dragstart","drop","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup"],pointer:["pointerdown","pointermove","pointerup","pointercancel","gotpointercapture","lostpointercapture","pointerenter","pointerleave","pointerover","pointerout"],selection:["select"],touch:["touchcancel","touchend","touchmove","touchstart"],ui:["scroll"],wheel:["wheel"],animation:["animationstart","animationend","animationiteration"],transition:["transitionend"]},_={},s=new function(){this.clipboard=e=>({clipboardData:e.clipboardData}),this.composition=e=>({data:e.data}),this.keyboard=e=>({altKey:e.altKey,charCode:e.charCode,ctrlKey:e.ctrlKey,key:e.key,keyCode:e.keyCode,locale:e.locale,location:e.location,metaKey:e.metaKey,repeat:e.repeat,shiftKey:e.shiftKey,which:e.which}),this.mouse=e=>({altKey:e.altKey,button:e.button,buttons:e.buttons,clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,metaKey:e.metaKey,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,shiftKey:e.shiftKey}),this.pointer=e=>({...this.mouse(e),pointerId:e.pointerId,width:e.width,height:e.height,pressure:e.pressure,tiltX:e.tiltX,tiltY:e.tiltY,pointerType:e.pointerType,isPrimary:e.isPrimary}),this.selection=()=>({selectedText:window.getSelection().toString()}),this.touch=e=>({altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey}),this.ui=e=>({detail:e.detail}),this.wheel=e=>({deltaMode:e.deltaMode,deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ}),this.animation=e=>({animationName:e.animationName,pseudoElement:e.pseudoElement,elapsedTime:e.elapsedTime}),this.transition=e=>({propertyName:e.propertyName,pseudoElement:e.pseudoElement,elapsedTime:e.elapsedTime})};function p(e,t){return e.children?e.children.filter((e=>e)).map((e=>{switch(typeof e){case"object":return t(e);case"string":return e}})):[]}function l(e,t){const n=Object.assign({},e.attributes);if(e.eventHandlers)for(const[r,o]of Object.entries(e.eventHandlers))n[r]=d(0,t,o);return n}function d(e,t,n){return function(){const e=Array.from(arguments).map((e=>"object"==typeof e&&e.nativeEvent?(n.preventDefault&&e.preventDefault(),n.stopPropagation&&e.stopPropagation(),r(e)):e));t({data:e,target:n.target})}}Object.keys(c).forEach((e=>{c[e].forEach((t=>{_[t]=s[e]}))}))},164:(e,t,n)=>{n.d(t,{D:()=>u});var r=n(271),o=n.n(r),a=n(478),i=n(351);function u(e){const t=o().useContext(a.V),[n,r]=o().useState(null);return o().useEffect((()=>{let n=!1;return function(e,t){return e.loadImportSource(t.source,t.sourceType).then((n=>{if("function"==typeof n.bind)return{data:t,bind:r=>{t.source,t.sourceType;const o=n.bind(r,e);if("function"==typeof o.create&&"function"==typeof o.render&&"function"==typeof o.unmount)return{render:r=>o.render(c(e,t,n,o,r)),unmount:o.unmount};console.error(`${t.source} returned an impropper binding`)}};console.error(`${t.source} did not export a function 'bind'`)}))}(t,e).then((e=>{n||r(e)})),()=>{n=!0}}),[t,e,r]),n}function c(e,t,n,r,o){let a;if(o.importSource){if(u=t,s=o.importSource,u.source!==s.source||u.sourceType!==s.sourceType)return console.error("Parent element import source "+_(t)+" does not match child's import source "+_(o.importSource)),null;if(!n[o.tagName])return console.error("Module from source "+_(t)+` does not export ${o.tagName}`),null;a=n[o.tagName]}else a=o.tagName;var u,s;return r.create(a,(0,i.R)(o,e.sendEvent),(0,i.x)(o,(o=>c(e,t,n,r,o))))}function _(e){return JSON.stringify({source:e.source,sourceType:e.sourceType})}},722:(e,t,n)=>{n.r(t),n.d(t,{Element:()=>u.W,Layout:()=>u.A,LayoutContext:()=>l.V,LayoutServerInfo:()=>f,mountLayout:()=>c,mountLayoutWithWebSocket:()=>_,mountWithLayoutServer:()=>d});var r=n(271),o=n.n(r),a=n(456),i=n.n(a),u=n(28);function c(e,t){i().render(o().createElement(u.A,t),e)}function _(e,t,n,r){s(e,t,n,r)}function s(e,t,n,r,o={everMounted:!1,reconnectAttempts:0,reconnectTimeoutRange:0}){const a=new WebSocket(t),u=new p;a.onopen=t=>{console.info("IDOM WebSocket connected."),o.everMounted&&i().unmountComponentAtNode(e),function(e){e.everMounted=!0,e.reconnectAttempts=0,e.reconnectTimeoutRange=0}(o),c(e,{loadImportSource:n,saveUpdateHook:u.resolve,sendEvent:e=>a.send(JSON.stringify(e))})},a.onmessage=e=>{const[t,n]=JSON.parse(e.data);u.promise.then((e=>e(t,n)))},a.onclose=a=>{if(!r)return void console.info("IDOM WebSocket connection lost.");const i=function(e,t){const n=Math.floor(Math.random()*t.reconnectTimeoutRange)||1;return t.reconnectTimeoutRange=(t.reconnectTimeoutRange+5)%e,n}(r,o);console.info(`IDOM WebSocket connection lost. Reconnecting in ${i} seconds...`),setTimeout((function(){o.reconnectAttempts++,s(e,t,n,r,o)}),1e3*i)}}function p(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}var l=n(478);function d(e,t,r){_(e,t.path.stream,((e,r)=>n(302)("NAME"==r?t.path.module(e):e).catch((e=>{throw e}))),r)}function f({host:e,port:t,path:n,query:r,secure:o}){const a="ws"+(o?"s":""),i="http"+(o?"s":"");let u=e+":"+t+(n||new URL(document.baseURI).pathname);u.endsWith("/")&&(u=u.slice(0,-1));const c=a+"://"+u,_=i+"://"+u;r=r?"?"+r:"",this.path={stream:c+"/_api/stream"+r,module:e=>_+`/_api/modules/${e}`}}},397:(e,t,n)=>{n.d(t,{g:()=>S});var r={};n.r(r),n.d(r,{JsonPatchError:()=>O,_areEquals:()=>R,applyOperation:()=>T,applyPatch:()=>g,applyReducer:()=>D,deepClone:()=>y,getValueByPointer:()=>P,validate:()=>b,validator:()=>M});var o={};n.r(o),n.d(o,{compare:()=>j,generate:()=>K,observe:()=>U,unobserve:()=>N});var a,i=n(271),u=n.n(i),c=(a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},a(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_=Object.prototype.hasOwnProperty;function s(e,t){return _.call(e,t)}function p(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var o in e)s(e,o)&&r.push(o);return r}function l(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function d(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function f(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function m(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function h(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(h(e[t]))return!0}else if("object"==typeof e)for(var r=p(e),o=r.length,a=0;a<o;a++)if(h(e[r[a]]))return!0;return!1}function E(e,t){var n=[e];for(var r in t){var o="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==o&&n.push(r+": "+o)}return n.join("\n")}var v=function(e){function t(t,n,r,o,a){var i=this.constructor,u=e.call(this,E(t,{name:n,index:r,operation:o,tree:a}))||this;return u.name=n,u.index=r,u.operation=o,u.tree=a,Object.setPrototypeOf(u,i.prototype),u.message=E(t,{name:n,index:r,operation:o,tree:a}),u}return c(t,e),t}(Error),O=v,y=l,w={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=P(n,this.path);r&&(r=l(r));var o=T(n,{op:"remove",path:this.from}).removed;return T(n,{op:"add",path:this.path,value:o}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=P(n,this.from);return T(n,{op:"add",path:this.path,value:l(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:R(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},A={add:function(e,t,n){return d(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:w.move,copy:w.copy,test:w.test,_get:w._get};function P(e,t){if(""==t)return e;var n={op:"_get",path:t};return T(e,n),n.value}function T(e,t,n,r,o,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===o&&(o=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):M(t,0)),""===t.path){var i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=P(e,t.from),"move"===t.op&&(i.removed=e),i;if("test"===t.op){if(i.test=R(e,t.value),!1===i.test)throw new O("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i.newDocument=e,i}if("remove"===t.op)return i.removed=e,i.newDocument=null,i;if("_get"===t.op)return t.value=e,i;if(n)throw new O("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return i}r||(e=l(e));var u=(t.path||"").split("/"),c=e,_=1,s=u.length,p=void 0,f=void 0,h=void 0;for(h="function"==typeof n?n:M;;){if((f=u[_])&&-1!=f.indexOf("~")&&(f=m(f)),o&&("__proto__"==f||"prototype"==f&&_>0&&"constructor"==u[_-1]))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===p&&(void 0===c[f]?p=u.slice(0,_).join("/"):_==s-1&&(p=t.path),void 0!==p&&h(t,0,e,p)),_++,Array.isArray(c)){if("-"===f)f=c.length;else{if(n&&!d(f))throw new O("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);d(f)&&(f=~~f)}if(_>=s){if(n&&"add"===t.op&&f>c.length)throw new O("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(i=A[t.op].call(t,c,f,e)).test)throw new O("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i}}else if(_>=s){if(!1===(i=w[t.op].call(t,c,f,e)).test)throw new O("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return i}if(c=c[f],n&&_<s&&(!c||"object"!=typeof c))throw new O("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}function g(e,t,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=!0),n&&!Array.isArray(t))throw new O("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=l(e));for(var a=new Array(t.length),i=0,u=t.length;i<u;i++)a[i]=T(e,t[i],n,!0,o,i),e=a[i].newDocument;return a.newDocument=e,a}function D(e,t,n){var r=T(e,t);if(!1===r.test)throw new O("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function M(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new O("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!w[e.op])throw new O("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new O("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new O('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new O("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new O("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&h(e.value))throw new O("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var o=e.path.split("/").length,a=r.split("/").length;if(o!==a+1&&o!==a)throw new O("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new O("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var i=b([{op:"_get",path:e.from,value:void 0}],n);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new O("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function b(e,t,n){try{if(!Array.isArray(e))throw new O("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)g(l(t),l(e),n||!0);else{n=n||M;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof O)return e;throw e}}function R(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,o,a=Array.isArray(e),i=Array.isArray(t);if(a&&i){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!R(e[n],t[n]))return!1;return!0}if(a!=i)return!1;var u=Object.keys(e);if((r=u.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(u[n]))return!1;for(n=r;0!=n--;)if(!R(e[o=u[n]],t[o]))return!1;return!0}return e!=e&&t!=t}var I=new WeakMap,C=function(e){this.observers=new Map,this.obj=e},L=function(e,t){this.callback=e,this.observer=t};function N(e,t){t.unobserve()}function U(e,t){var n,r=function(e){return I.get(e)}(e);if(r){var o=function(e,t){return e.observers.get(t)}(r,t);n=o&&o.observer}else r=new C(e),I.set(e,r);if(n)return n;if(n={},r.value=l(e),t){n.callback=t,n.next=null;var a=function(){K(n)},i=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",i),window.addEventListener("keyup",i),window.addEventListener("mousedown",i),window.addEventListener("keydown",i),window.addEventListener("change",i))}return n.patches=[],n.object=e,n.unobserve=function(){K(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",i),window.removeEventListener("keyup",i),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",i),window.removeEventListener("change",i))},r.observers.set(t,new L(t,n)),n}function K(e,t){void 0===t&&(t=!1);var n=I.get(e.object);k(n.value,e.object,e.patches,"",t),e.patches.length&&g(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function k(e,t,n,r,o){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=p(t),i=p(e),u=!1,c=i.length-1;c>=0;c--){var _=e[m=i[c]];if(!s(t,m)||void 0===t[m]&&void 0!==_&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(o&&n.push({op:"test",path:r+"/"+f(m),value:l(_)}),n.push({op:"remove",path:r+"/"+f(m)}),u=!0):(o&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var d=t[m];"object"==typeof _&&null!=_&&"object"==typeof d&&null!=d&&Array.isArray(_)===Array.isArray(d)?k(_,d,n,r+"/"+f(m),o):_!==d&&(o&&n.push({op:"test",path:r+"/"+f(m),value:l(_)}),n.push({op:"replace",path:r+"/"+f(m),value:l(d)}))}}if(u||a.length!=i.length)for(c=0;c<a.length;c++){var m;s(e,m=a[c])||void 0===t[m]||n.push({op:"add",path:r+"/"+f(m),value:l(t[m])})}}}function j(e,t,n){void 0===n&&(n=!1);var r=[];return k(e,t,r,"",n),r}const B=Object.assign({},r,o,{JsonPatchError:v,deepClone:l,escapePathComponent:f,unescapePathComponent:m});function S(e){const t=u().useRef(e),n=function(){const[,e]=u().useState();return u().useCallback((()=>e({})),[])}(),r=u().useCallback(((e,r)=>{e?function(e,t){B.applyPatch(e,t,!1,!0,!0).newDocument}(t.current,[{op:"replace",path:e,value:W(B.getValueByPointer(t.current,e),r)}]):t.current=W(t.current,r),n()}),[t]);return[t.current,r]}function W(e,t){return B.applyPatch(e,t,!1,!1,!0).newDocument}}}]);